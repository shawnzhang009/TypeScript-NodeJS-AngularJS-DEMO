(() => {
    angular.module('mainApp', [
        'app.core',
        'app.layout',
        'app.components',
        'app.widgets'
    ]);

    angular.module('app.core', [
        'ui.router',
        'ui.bootstrap',
        'ui.layout',
        'ngResource',
        'ngCookies',
        'ngAnimate'
    ]);

    angular.module('app.widgets', [
        'app.core'
    ]);

    angular.module('app.components', [
        'app.core',
        'app.widgets'
    ]);

    angular.module('app.layout', [
        'app.core'
    ]);


})();


// Sample: {addr.location:a,addr.number:b} ==> addr%5Blocation%5D=a&addr%5Bnumber%5D=b
const serializeData = (obj, prefix) => {
    const str = [];
    for (let p in obj) {
        if (obj.constructor === Array) {
            console.log(obj);
            var k = prefix ? `${prefix}[${p}]` : p,
                v = obj[p];
            str.push(typeof v == "object" ?
                serializeData(v, k) :
                `${encodeURIComponent(k)}=${encodeURIComponent(v)}`);
        } else if (obj.hasOwnProperty(p)) {
            //   var k = prefix ? prefix + "[" + p + "]" : p, v = obj[p];
            var k = prefix ? `${prefix}.${p}` : p,
                v = obj[p];
            str.push(typeof v == "object" ?
                serializeData(v, k) :
                `${encodeURIComponent(k)}=${encodeURIComponent(v)}`);
        }
    }
    return str.join("&");
};

// Sample: 35% ==> 0.35
const percentToNum = param => {
    param = param.toString().replace('%', '');
    if (param != undefined && isNaN(param) == false) {
        return param * 1000 / 100000;
    } else {
        return '';
    }
};

/**
*  Secure Hash Algorithm (SHA256)
*  http://www.webtoolkit.info/
*  Original code by Angel Marin, Paul Johnston.
**/
const SHA256 = s => {const chrsz = 8;const hexcase = 0;function safe_add(x, y) {const lsw = (x & 0xFFFF) + (y & 0xFFFF);const msw = (x >> 16) + (y >> 16) + (lsw >> 16);return (msw << 16) | (lsw & 0xFFFF);}function S(X, n) {return (X >>> n) | (X << (32 - n));}function R(X, n) {return (X >>> n);}function Ch(x, y, z) {return ((x & y) ^ ((~x) & z));}function Maj(x, y, z) {return ((x & y) ^ (x & z) ^ (y & z));}function Sigma0256(x) {return (S(x, 2) ^ S(x, 13) ^ S(x, 22));}function Sigma1256(x) {return (S(x, 6) ^ S(x, 11) ^ S(x, 25));}function Gamma0256(x) {return (S(x, 7) ^ S(x, 18) ^ R(x, 3));}function Gamma1256(x) {return (S(x, 17) ^ S(x, 19) ^ R(x, 10));}function core_sha256(m, l) {
    const K = new Array(0x428A2F98, 0x71374491, 0xB5C0FBCF, 0xE9B5DBA5, 0x3956C25B, 0x59F111F1, 0x923F82A4, 0xAB1C5ED5, 0xD807AA98, 0x12835B01, 0x243185BE, 0x550C7DC3, 0x72BE5D74, 0x80DEB1FE, 0x9BDC06A7, 0xC19BF174, 0xE49B69C1, 0xEFBE4786, 0xFC19DC6, 0x240CA1CC, 0x2DE92C6F, 0x4A7484AA, 0x5CB0A9DC, 0x76F988DA, 0x983E5152, 0xA831C66D, 0xB00327C8, 0xBF597FC7, 0xC6E00BF3, 0xD5A79147, 0x6CA6351, 0x14292967, 0x27B70A85, 0x2E1B2138, 0x4D2C6DFC, 0x53380D13, 0x650A7354, 0x766A0ABB, 0x81C2C92E, 0x92722C85, 0xA2BFE8A1, 0xA81A664B, 0xC24B8B70, 0xC76C51A3, 0xD192E819, 0xD6990624, 0xF40E3585, 0x106AA070, 0x19A4C116, 0x1E376C08, 0x2748774C, 0x34B0BCB5, 0x391C0CB3, 0x4ED8AA4A, 0x5B9CCA4F, 0x682E6FF3, 0x748F82EE, 0x78A5636F, 0x84C87814, 0x8CC70208, 0x90BEFFFA, 0xA4506CEB, 0xBEF9A3F7, 0xC67178F2);const HASH = new Array(0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19);const W = new Array(64);
    let a;
    let b;
    let c;
    let d;
    let e;
    let f;
    let g;
    let h;
    var i;
    var j;
    let T1, T2;m[l >> 5] |= 0x80 << (24 - l % 32);m[((l + 64 >> 9) << 4) + 15] = l;for (var i = 0; i < m.length; i += 16) {a = HASH[0];b = HASH[1];c = HASH[2];d = HASH[3];e = HASH[4];f = HASH[5];g = HASH[6];h = HASH[7];for (var j = 0; j < 64; j++) {if (j < 16) W[j] = m[j + i];else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);T2 = safe_add(Sigma0256(a), Maj(a, b, c));h = g;g = f;f = e;e = safe_add(d, T1);d = c;c = b;b = a;a = safe_add(T1, T2);}HASH[0] = safe_add(a, HASH[0]);HASH[1] = safe_add(b, HASH[1]);HASH[2] = safe_add(c, HASH[2]);HASH[3] = safe_add(d, HASH[3]);HASH[4] = safe_add(e, HASH[4]);HASH[5] = safe_add(f, HASH[5]);HASH[6] = safe_add(g, HASH[6]);HASH[7] = safe_add(h, HASH[7]);}return HASH;
}function str2binb(str) {const bin = Array();const mask = (1 << chrsz) - 1;for (let i = 0; i < str.length * chrsz; i += chrsz) {bin[i >> 5] |= (str.charCodeAt(i / chrsz) & mask) << (24 - i % 32);}return bin;}function Utf8Encode(string) {string = string.replace(/rn/g, "n");let utftext = "";for (let n = 0; n < string.length; n++) {const c = string.charCodeAt(n);if (c < 128) {utftext += String.fromCharCode(c);} else if ((c > 127) && (c < 2048)) {utftext += String.fromCharCode((c >> 6) | 192);utftext += String.fromCharCode((c & 63) | 128);} else {utftext += String.fromCharCode((c >> 12) | 224);utftext += String.fromCharCode(((c >> 6) & 63) | 128);utftext += String.fromCharCode((c & 63) | 128);}}return utftext;}function binb2hex(binarray) {const hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";let str = "";for (let i = 0; i < binarray.length * 4; i++) {str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) + hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);}return str;}s = Utf8Encode(s);return binb2hex(core_sha256(str2binb(s), s.length * chrsz));};

/**
*  Secure Hash Algorithm (SHA1)
*  http://www.webtoolkit.info/
**/
const SHA1 = msg => {function rotate_left(n, s) {const t4 = ( n<<s ) | (n>>>(32-s));return t4;};function lsb_hex(val) {let str="";let i;let vh;let vl;for( i=0; i<=6; i+=2 ) {vh = (val>>>(i*4+4))&0x0f;vl = (val>>>(i*4))&0x0f;str += vh.toString(16) + vl.toString(16);}return str;};function cvt_hex(val) {let str="";let i;let v;for( i=7; i>=0; i-- ) {v = (val>>>(i*4))&0x0f;str += v.toString(16);}return str;};function Utf8Encode(string) {string = string.replace(/rn/g,"n");let utftext = "";for (let n = 0; n < string.length; n++) {const c = string.charCodeAt(n);if (c < 128) {utftext += String.fromCharCode(c);}else if((c > 127) && (c < 2048)) {utftext += String.fromCharCode((c >> 6) | 192);utftext += String.fromCharCode((c & 63) | 128);}else {utftext += String.fromCharCode((c >> 12) | 224);utftext += String.fromCharCode(((c >> 6) & 63) | 128);utftext += String.fromCharCode((c & 63) | 128);}}return utftext;};let blockstart;let i, j;const W = new Array(80);let H0 = 0x67452301;let H1 = 0xEFCDAB89;let H2 = 0x98BADCFE;let H3 = 0x10325476;let H4 = 0xC3D2E1F0;let A, B, C, D, E;var temp;msg = Utf8Encode(msg);const msg_len = msg.length;const word_array = new Array();for( i=0; i<msg_len-3; i+=4 ) {j = msg.charCodeAt(i)<<24 | msg.charCodeAt(i+1)<<16 |msg.charCodeAt(i+2)<<8 | msg.charCodeAt(i+3);word_array.push(j);}switch( msg_len % 4 ) {case 0:i = 0x080000000;break;case 1:i = msg.charCodeAt(msg_len-1)<<24 | 0x0800000;break;case 2:i = msg.charCodeAt(msg_len-2)<<24 | msg.charCodeAt(msg_len-1)<<16 | 0x08000;break;case 3:i = msg.charCodeAt(msg_len-3)<<24 | msg.charCodeAt(msg_len-2)<<16 | msg.charCodeAt(msg_len-1)<<8 | 0x80;break;}word_array.push(i);while( (word_array.length % 16) != 14 ) word_array.push(0);word_array.push(msg_len>>>29);word_array.push((msg_len<<3)&0x0ffffffff);for ( blockstart=0; blockstart<word_array.length; blockstart+=16 ) {for( i=0; i<16; i++ ) W[i] = word_array[blockstart+i];for( i=16; i<=79; i++ ) W[i] = rotate_left(W[i-3] ^ W[i-8] ^ W[i-14] ^ W[i-16], 1);A = H0;B = H1;C = H2;D = H3;E = H4;for( i= 0; i<=19; i++ ) {temp = (rotate_left(A,5) + ((B&C) | (~B&D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}for( i=20; i<=39; i++ ) {temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}for( i=40; i<=59; i++ ) {temp = (rotate_left(A,5) + ((B&C) | (B&D) | (C&D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}for( i=60; i<=79; i++ ) {temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}H0 = (H0 + A) & 0x0ffffffff;H1 = (H1 + B) & 0x0ffffffff;H2 = (H2 + C) & 0x0ffffffff;H3 = (H3 + D) & 0x0ffffffff;H4 = (H4 + E) & 0x0ffffffff;}var temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);return temp.toLowerCase();};


// Grab the files and set them to our variable
// ========================================================================================
// <input id="fileupload" type="file" class="" name="files[]" data-url="upload.do" multiple>
function prepareUpload(event) {
    const ele = $(this).siblings('.hidden')[0];
    uploadFiles(event.target.files, ele);

    // ele.value = resFileId;
    //
    // try {
    //     var resFileId = uploadFiles(event.target.files);
    //     var ele = $(this).siblings('.hidden')[0].value;
    //     var array = ele == ""? [] : ele.split(',') ;
    // } catch (e) {
    //     console.log(e);
    // } finally {
    //     console.log(array);
    //     array.push(resFileId);
    //     console.log(array);
    //     ele.value = array.join(',')).trigger('input';
    // }

    // ele.val(ele.val().split(',').push(resId).join(',')).trigger('input');

    // $(this).siblings('.hidden').val(uploadFiles(event.target.files)).trigger('input');
}


/**
 * @param files uploading files
 * @param ele element that need to receive response ID
 * @desc Files upload module for test. When received id, using "trigger('input')" make ng-model know
 */
function uploadFiles(files, ele) {
    // Create a formdata object and add the files
    const data = new FormData();
    $.each(files, (key, value) => {
        data.append("files", value);
    });

    console.log(files)

    $.ajax({
        url: 'upload.do',
        type: 'POST',
        data,
        cache: false,
        dataType: 'json',
        processData: false, // Don't process the files
        contentType: false, // Set content type to false as jQuery will tell the server its a query string request
        success(data, textStatus, jqXHR) {
            if (typeof data.error === 'undefined') {
                // Success so call function to process the form
                fileid = data.content.name;
                ele.value = data.content.name;
                $(ele).trigger('input');
                // submitForm(event, data);
            } else {
                // Handle errors here
                console.log(`ERRORS: ${data.error}`);
            }
        },
        error(jqXHR, textStatus, errorThrown) {
            // Handle errors here
            console.log(`ERRORS: ${textStatus}`);
            // STOP LOADING SPINNER
        }
    });
}

/**
 * @author Shawn
 * @desc mainAPP
 */
(() => {
    angular
        .module('app.core')
        // Global
        .constant('WEB_INFO', {
            title: 'Order Management System'
        })

        .constant('AUTH_EVENTS', {
            loginSuccess: 'auth-login-success',
            loginFailed: 'auth-login-failed',
            logoutSuccess: 'auth-logout-success',
            sessionTimeout: 'auth-session-timeout',
            notAuthenticated: 'auth-not-authenticated',
            pageNotFound: 'page-not-found',
            serverError: 'server-error'
        })

        // Do auth when state/url change
        .run(($rootScope, AUTH_EVENTS, AuthService) => {
            $rootScope.$on('$stateChangeStart', (event, next) => {
                if (!AuthService.isAuthenticated()) {
                    $rootScope.$broadcast(AUTH_EVENTS.notAuthenticated);
                } else {
                    $rootScope.currentUser = AuthService.getUsername();
                }
            });
        })
})();

/**
 * @author Shawn
 * @desc The Root Controller of the mainAPP
 */
(() => {
    angular
        .module('app.core')
        .controller('mainCtrl', mainCtrl);

    mainCtrl.$inject = ['$rootScope', '$scope', '$location', '$state', '$window', 'AuthService', 'AUTH_EVENTS', 'CommonService'];

    function mainCtrl(
        $rootScope,
        $scope,
        $location,
        $state,
        $window,
        AuthService,
        AUTH_EVENTS,
        CommonService) {

        if (!AuthService.isAuthenticated()) {
            $location.path('/login');
            console.log(1);
        }

        $rootScope.setCurrentUser = user => {
            $rootScope.currentUser = user;
        };

        // Log out
        $scope.logout = () => {
            $rootScope.currentUser = null;
            $rootScope.$broadcast(AUTH_EVENTS.logoutSuccess);
            console.log('logout success');
            // AuthService.logout().then(function(res) {
            //     if (CommonService.isReqSuccess(res)) {
            //         $rootScope.$broadcast(AUTH_EVENTS.logoutSuccess);
            //         console.log('Log out success');
            //     } else {
            //         CommonService.handleResErr(res);
            //     }
            // }, function(res) {
            //     CommonService.handleHttpErr(res);
            // });
        }

        // Listening
        $scope.$on(AUTH_EVENTS.loginSuccess, (event, data) => {
            console.log("login success");
            $state.go('dashboard.order');
        });

        $scope.$on(AUTH_EVENTS.loginFailed, (event, data) => {
            AuthService.destory();
            console.log("login failed");
            // $location.path('/');
        });

        $scope.$on(AUTH_EVENTS.logoutSuccess, (event, data) => {
            AuthService.destroy();
            console.log("login failed");
            // $location.path('/');
        });

        $scope.$on('method-not-allow', (event, data) => {
            console.log("method not allow");
            // $location.path('/');
        });

        $scope.$on(AUTH_EVENTS.pageNotFound, (event, data) => {
            console.log('404 error');
        });

        $scope.$on(AUTH_EVENTS.serverError, (event, data) => {
            console.log('500 error');
        });

    }
})();

(() => {})();

/**
 * @author Shawn
 * @desc mainAPP
 */
(() => {
    const PROJECTSTATUS = {
        0: "te",
        1: "2",
        2: "3",
        3: "r",
        4: "r",
        5: "fewf",
        6: "feaw"
    };

    /* filters */
    const filters = angular.module('app.core')

    .filter('switch', () => param => {
        if (param == 1 || param == '1') {
            return 'OPEN';
        } else {
            return 'CLOSED';
        }
    })

    // 78 ===> 0.78
    .filter('percent', () => param => {
        if (param != undefined && isNaN(param) == false) {
            return param * 1000 / 100000;
        } else {
            return '';
        }
    })

    .filter('category', () => {
        const obj = CATEGORY;
        return param => obj[param] != undefined ? obj[param] : ""
    })

    .filter('buildcompany', () => {
        const obj = BUILDCOMPANY;
        return param => obj[param] != undefined ? obj[param] : ""
    })

    .filter('projectstatus', () => {
        const obj = PROJECTSTATUS;
        return param => obj[param] != undefined ? obj[param] : ""
    });
})();
/**
 * @author Shawn
 * @desc router of app.core
 */
(() => {
    angular.module('app.core')

        .config(
        ($stateProvider, $httpProvider, $urlRouterProvider, $locationProvider) => {

            // Interceptor of Requests
            $httpProvider.interceptors.push([
                '$injector',
                $injector => $injector.get('AuthInterceptor')
            ]);

            $locationProvider.html5Mode({
                enabled: false,
                requireBase: false
            });

            // For any unmatched url, redirect to /
            $urlRouterProvider.otherwise('/login');


            // loginregister
            $stateProvider

                // main page
                .state('dashboard', {
                    url: '/',
                    templateUrl: 'html/dashboard.html'
                })

                .state("dashboard.order", {
                    url: "order",
                    templateUrl: "js/components/client-order-list/client-order-list.html"
                }).state("dashboard.addClientOrder", {
                    url: "orderadd",
                    templateUrl: "js/components/client-order-add/client-order-add.html"
                }).state("dashboard.demo", {
                    url: "demo",
                    templateUrl: "html/demo.html"
                })

                .state('login', {
                    url: '/login',
                    templateUrl: 'html/login.html'
                }).state('register', {
                    url: '/register',
                    templateUrl: 'html/register.html'
                })

                // User Account
                .state('account', {
                    url: '/account',
                    templateUrl: 'html/account/account.html'
                }).state('account.me', {
                    url: '/me',
                    templateUrl: 'html/account/account.me.html'
                })

                // for test
                .state('test', {
                    url: '/test',
                    templateUrl: 'html/test-angular-ui-bootstrap.html',
                    controller: 'testCtrl'
                })
        }
        );
})();

/**
 * @author Shawn
 * @desc Services of the mainAPP
 */

// For test
const commonTest = true;

(() => {
    angular
        .module('app.core')
        .factory('AuthInterceptor', AuthInterceptor)
        .factory('CommonService', CommonService)
        .factory('AuthService', AuthService)
        .factory('registerService', registerService)
        .factory('userService', userService);

    AuthInterceptor.$inject = ['$rootScope', '$q', '$window', 'AUTH_EVENTS'];
    AuthService.$inject = ['$http', '$rootScope', 'AUTH_EVENTS', '$window', 'CommonService'];
    CommonService.$inject = ['$http'];
    registerService.$inject = ['$http', '$rootScope', 'CommonService'];
    userService.$inject = ['$http', '$rootScope', 'CommonService'];


    // Interceptor
    function AuthInterceptor($rootScope, $q, $window, AUTH_EVENTS) {
        const service = {
            request: requestHandler,
            response: responseHandler,
            responseError: responseErrorHandler
        };
        return service;

        function requestHandler(config) {
            config.headers = config.headers || {};
            if ($window.localStorage.token) {
                config.headers['X-AuthToken'] = $window.localStorage.token;
            }
            return config;
        }

        function responseHandler(response) {
            // console.log(response)
            if (response.status === 401) {
                // handle the case where the user is not authenticated
            }
            return response || $q.when(response);
        }

        function responseErrorHandler(response) {
            // console.log(response);
            $rootScope.$broadcast({
                401: AUTH_EVENTS.notAuthenticated,
                403: AUTH_EVENTS.notAuthorized,
                405: 'method-not-allow',
                419: AUTH_EVENTS.sessionTimeout,
                440: AUTH_EVENTS.sessionTimeout,
                404: AUTH_EVENTS.pageNotFound,
                500: AUTH_EVENTS.serverError
            }[response.status], response);
            return $q.reject(response);
        }
    }

    function AuthService($http, $rootScope, AUTH_EVENTS, $window, CommonService) {

        const service = {};

        let storageTokenTitle = 'token',
            storageUserTitle = 'username';

        // forn user infomation (include token)
        service.createUserInfo = (username, token) => {
            $window.localStorage.setItem(storageUserTitle, username);
            $window.localStorage.setItem(storageTokenTitle, token);
        }
        service.destroy = () => {
            $window.localStorage.removeItem(storageUserTitle);
            $window.localStorage.removeItem(storageTokenTitle);
        }

        // only for Token
        service.createToken = (token) => {
            $window.localStorage.setItem(storageTokenTitle, token);
        };

        service.getToken = () => $window.localStorage.getItem(storageTokenTitle);

        service.removeToken = () => {
            $window.localStorage.removeItem(storageTokenTitle);
        }

        // only for username
        service.getUsername = () => {
            $window.localStorage.getItem(storageUserTitle)
        };

        service.login = user => CommonService.post("login", user);

        service.logout = () => CommonService.post("logout");

        // is session avalid
        service.isAuthenticated = () => {
            console.log(`isAuthenticated: ${!!$window.localStorage.token}`);
            return !!$window.localStorage.token;
        };

        return service;
    }


    function registerService($http, $rootScope, CommonService) {
        const service = {};

        service.register = user => CommonService.post("register", user);

        return service;
    }

    function userService($http, $rootScope, CommonService) {
        const service = {};

        return service;
    }


    // Global Services
    function CommonService($http) {
        // Set Content-Type to form-data which back-end can accept
        // $http.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';

        const urlBackEnd = 'http://lofewfcalhost:8080/ws/';
        // var urlBackEnd = 'http://10.22.16.124:8088/ws/marketorder/getByClientOrderId/';
        const urlMiddleEnd = 'https://ExampleURL.92/';

        // requests status handle
        this.isReqSuccess = res => {
            console.log(res);
            return res.data.errCode == 0 ? true : false;
        };

        // handle Http error
        this.handleHttpErr = res => {
            console.log('Req Error', res);
        };

        // handle response error (base on API)
        this.handleResErr = res => {
            console.log(res);
            if (res.data.errDesc == undefined) {
                console.log('Error without discription');
                console.log(`msg: ${res.errDesc}`);
            } else {
                alert(res.data.errDesc);
                console.log(res.data);
            }
        };

        // post single command to back-end server
        this.post = (command, data) => commonTest ? $http({
            url: `test-data/ws/${command}`,
            method: 'GET'
        }) : $http({
            url: urlBackEnd + command,
            method: 'POST',
            data
        });

        // post multi commands to server
        this.postMulti = () => {

        };

        return this;
    }



})();

(() => {
    angular
        .module('app.components')
        .controller('clientOrderAddCtrl', function($scope, $window) {

            $scope.tabs = [
                { title: 'Dynamic Title 1', content: 'Dynamic content 1' },
                { title: 'Dynamic Title 2', content: 'Dynamic content 2', disabled: true }
            ];

            $scope.model = {
                name: 'Tabs'
            };
        });
})();

(() => {
    angular
        .module('app.components')
        .factory('clientOrder', clientOrder);

    /* @ngInject */
    clientOrder.$inject = ['$resource'];

    function clientOrder($resource) {
        return $resource('ws/clientorder/list', {}, {
            query: {
                method: 'GET',
                params: {},
                isArray: true
            }
        });
    }
})();

(() => {
    angular
        .module('app.components')
        .controller('CoListCtrl', CoListCtrl);

    CoListCtrl.$inject = ['$scope', '$rootScope', 'clientOrder', 'marketOrder'];

    /* @ngInject */
    function CoListCtrl($scope, $rootScope, clientOrder, marketOrder) {

        $scope.selectedClientOrderId = "";

        $scope.selectClientOrder = id => {
            if ($scope.selectedClientOrderId == id) {
                $scope.closeMarketOrderList(id);
            } else {
                $scope.selectedClientOrderId = $scope.selectedClientOrderId == id ? "" : id;
            }
        }

        $scope.closeMarketOrderList = id => {
            $scope.selectedClientOrderId = "";
        }
        
        // init
        clientOrder.query({}, res => {
            $scope.clientOrderItems = res;
        });

    }

})();

(() => {
    angular
        .module('app.components')
        .factory('clientOrder', clientOrder);

    /* @ngInject */
    clientOrder.$inject = ['$resource'];

    function clientOrder($resource) {
        return $resource('ws/clientorder/list', {}, {
            query: {
                method: 'GET',
                params: {},
                isArray: true
            }
        });
    }
})();

(() => {
    angular
        .module('app.components')
        .controller('coPieCtrl', coPieCtrl);

    coPieCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', '$window', '$cookies', '$state', '$interval', 'AUTH_EVENTS', 'CommonService', 'AuthService', 'marketOrder'];

    /* @ngInject */
    function coPieCtrl(
        $scope,
        $rootScope,
        $location,
        $http,
        $window,
        $cookies,
        $state,
        $interval,
        AUTH_EVENTS,
        CommonService,
        AuthService,
        marketOrder) {


        const option = {
            title: {
                text: 'Market Order Pie',
                subtext: '',
                x: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                data: ['NYSE', 'NASDAQ', 'SSE', 'HKSE', 'SGSE']
            },
            series: [
                {
                    name: 'Exchange',
                    type: 'pie',
                    radius: '55%',
                    center: ['50%', '60%'],
                    data: [
                        { value: 335, name: 'NYSE' },
                        { value: 310, name: 'NASDAQ' },
                        { value: 234, name: 'SSE' },
                        { value: 135, name: 'HKSE' },
                        { value: 1548, name: 'SGSE' }
                    ],
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };

        const myChart = echarts.init(document.getElementById('main'));
        myChart.setOption(option);

    }
})();

(() => {
    angular
        .module('app.components')
        .directive('clientOrderPie', clientOrderPie);

    function clientOrderPie() {
        return {
            scope: {
                icon: "@"
            },
            templateUrl: 'js/components/client-order-pie/client-order-pie.html',
            restrict: "E"
        };
    }
})();

(() => {
    angular
        .module('app.components')
        .factory('marketOrder', marketOrder);

    /* @ngInject */
    marketOrder.$inject = ['$resource'];

    function marketOrder($resource) {
        return $resource('ws/marketorder/list/:coId', { coId: '@coId' });
    }
})();

(() => {
    angular
        .module('app.components')
        .controller('LoginCtrl', LoginCtrl);

    LoginCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', '$window', '$cookies', '$state', 'AUTH_EVENTS', 'CommonService', 'AuthService', 'Login'];

    /* @ngInject */
    function LoginCtrl(
        $scope,
        $rootScope,
        $location,
        $http,
        $window,
        $cookies,
        $state,
        AUTH_EVENTS,
        CommonService,
        AuthService,
        Login) {

        // TODO check if user is Login
        if (AuthService.isAuthenticated()) {
            $rootScope.$broadcast(AUTH_EVENTS.loginSuccess);
        }


        $scope.user = {};

        // $scope.alerts = []
        $scope.Alerts = {
            isShow: false,
            alerts: [],
            add(msg) {
                this.isShow = true;
                this.alerts = [];
                this.alerts.push(msg);
            },
            close(index) {
                this.isShow = false;
                this.alerts.splice(index, 1);
            }
        };


        $scope.login = user => {

            Login.login(user, res => {
                if (res.token != undefined && res.token != '') {
                    AuthService.createUserInfo(user.username, res.token);
                    $rootScope.currentUser = user.username;
                    $rootScope.$broadcast(AUTH_EVENTS.loginSuccess);
                    $scope.Alerts.close();
                } else {
                    $scope.Alerts.add({ type: "danger", msg: 'Login failed. Please try again.' });
                }
            }, res => {
                $scope.Alerts.add({ type: "danger", msg: res.data.reason || "Login failed." });
            });

            console.log(user);
        };
    }
})();

(() => {
    angular
        .module('app.components')
        .directive('loginPanel', loginPanel);

    loginPanel.$inject = ['$compile'];
    /* @ngInject */
    function loginPanel($compile) {
        return {
            restrict: 'E',
            scope: '@',
            templateUrl: 'js/components/login-panel/login-panel.html',
            link(scope) {
                // scope.name = "hel"
            }
        };
    }
})();

(() => {
    angular
        .module('app.components')
        .factory('Login', Login);

    /* @ngInject */
    Login.$inject = ['$resource'];

    function Login($resource) {
        return $resource('ws/login', {}, {
            login: {
                method: 'POST',
                params: {},
                isArray: false
            }
        });
    }
})();

(() => {
    angular
        .module('app.components')
        .controller('MoListCtrl', MoListCtrl);

    MoListCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', '$window', '$cookies', '$state', '$interval', 'AUTH_EVENTS', 'CommonService', 'AuthService', 'marketOrder'];

    /* @ngInject */
    function MoListCtrl(
        $scope,
        $rootScope,
        $location,
        $http,
        $window,
        $cookies,
        $state,
        $interval,
        AUTH_EVENTS,
        CommonService,
        AuthService,
        marketOrder) {

        // $interval(() => {
        //     if ($rootScope.selectedClientOrderId != '' && $rootScope.selectedClientOrderId != undefined && AuthService.isAuthenticated()) {
        //         marketOrder.query({ coId: $rootScope.selectedClientOrderId }, res => {
        //             $scope.marketOrderList = res;
        //             console.log(res)
        //         });
        //     }
        // }, 1000);

    }
})();

(() => {
    angular
        .module('app.components')
        .directive('marketOrderList', marketOrderList);

    function marketOrderList() {
        return {
            scope: {
                icon: "@"
            },
            templateUrl: 'js/components/market-order-list/market-order-list.html',
            restrict: "E"
        };
    }
})();

(() => {
    angular
        .module('app.components')
        .factory('marketOrder', marketOrder);

    /* @ngInject */
    marketOrder.$inject = ['$resource'];

    function marketOrder($resource) {
        return $resource('ws/marketorder/list/:coId', { coId: '@coId' });
    }
})();

/**
 * @author Shawn
 * @desc Controllers of the mainAPP
 */
(() => {
    angular
        .module('app.components')
        .controller('testCtrl', testCtrl);

    testCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', 'AUTH_EVENTS', 'AuthService'];


    function testCtrl($scope, $rootScope, $location, $http, AUTH_EVENTS, AuthService) {
        $scope.obj = {
            url: "user/login.do",
            method: "POST",
            data: ""
        };
        $scope.test = obj => {
            const aa = (JSON.parse(obj.data));
            $scope.result = {
                result: "",
                status: "",
                msg: "",
                content: ""
            };
            $http({
                url: obj.url,
                method: obj.method,
                data: serializeData(aa)
            }).then(res => {
                console.log(res);
                $scope.result.result = "Req Success";
                $scope.result = res;
            }, res => {
                console.log(res);
                $scope.result = res;
                $scope.result.result = "Req Fail";
            });
        }
    }
})();

/**
 * @author Shawn
 * @desc Controllers of the mainAPP
 */

(() => {
    angular
        .module('app.components')
        .controller('testCtrl', testCtrl);

    testCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', 'AUTH_EVENTS', 'AuthService'];

    function testCtrl($scope, $rootScope, $location, $http, AUTH_EVENTS, AuthService) {
        $scope.obj = {
            url: "user/login.do",
            method: "POST",
            data: ""
        };
        $scope.test = obj => {
            const aa = (JSON.parse(obj.data));
            $scope.result = {
                result: "",
                status: "",
                msg: "",
                content: ""
            };
            $http({
                url: obj.url,
                method: obj.method,
                data: serializeData(aa)
            }).then(res => {
                console.log(res);
                $scope.result.result = "Req Success";
                $scope.result = res;
            }, res => {
                console.log(res);
                $scope.result = res;
                $scope.result.result = "Req Fail";
            });
        }
    }
})();

/**
 * @author Shawn
 * @desc Controllers of the mainAPP
 */
(() => {
    angular
        .module('app.components')
        .controller('userCtrl', userCtrl);

    userCtrl.$inject = ['$scope', '$rootScope', '$location', 'AUTH_EVENTS', 'AuthService'];
    function userCtrl($scope, $rootScope, $location, AUTH_EVENTS, AuthService) {
        $scope.$on(AUTH_EVENTS.logoutSuccess, (event, data) => {
            $location.path("/");
        });

        if (!AuthService.isAuthenticated()) {
            console.log("user need login");
            $location.path("/login");
        }
    }
})();
(() => {
    angular.module('app.layout')
        // dashboard Sidebar
        .controller("MasterCtrl", MasterCtrl);

    MasterCtrl.$inject = ["$scope", "$cookies"];


    function MasterCtrl($scope, $cookies) {
        /**
         * Sidebar Toggle & Cookies Control
         */
        const mobileView = 992;
        $scope.getWidth = () => window.innerWidth;
        $scope.$watch($scope.getWidth, (newValue, oldValue) => {
            if (newValue >= mobileView) {
                if (angular.isDefined($cookies.get('toggle'))) {
                    $scope.toggle = !$cookies.get('toggle') ? true : false;
                } else {
                    $scope.toggle = false;
                }
            } else {
                $scope.toggle = true;
            }
        });
        $scope.toggleSidebar = () => {
            $scope.toggle = !$scope.toggle;
            $cookies.put('toggle', $scope.toggle);
        };
        window.onresize = () => {
            $scope.$apply();
        };
    }
})();
(() => {
    angular
        .module('app.components')
        .directive('footer', footer);

    function footer() {
        return {
            scope: {
                icon: "@"
            },
            templateUrl: 'js/layout/footer/footer.html',
            restrict: "AE"
        };
    }
})();

(() => {
    angular.module('app.widgets')
        .controller('AlertsCtrl', AlertsCtrl);

    AlertsCtrl.$inject = ['$scope'];
    function AlertsCtrl($scope) {
        $scope.alerts = [{
            type: 'success',
            msg: 'Thanks for visiting! Feel free to create pull requests to improve the dashboard!'
        }, {
                type: 'danger',
                msg: 'Found a bug? Create an issue with as many details as you can.'
            }];

        $scope.addAlert = () => {
            $scope.alerts.push({
                msg: 'Another alert!'
            });
        };

        $scope.closeAlert = index => {
            $scope.alerts.splice(index, 1);
        };
    }
})();
(() => {
    angular
        .module('app.widgets')
        .directive("rdLoading", rdLoading);

    function rdLoading() {
        const d = {
            restrict: "AE",
            template: '<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'
        };
        return d
    }
})();

(() => {
    angular.module('app.widgets')

        // angular-ui progressBar
        .controller('ProgressDemoCtrl', ProgressDemoCtrl);
    ProgressDemoCtrl.$inject = ['$scope'];

    function ProgressDemoCtrl($scope) {
        $scope.max = 200;

        $scope.random = () => {
            const value = Math.floor(Math.random() * 100 + 1);
            let type;

            if (value < 25) {
                type = 'warning';
            } else if (value < 50) {
                type = 'info';
            } else if (value < 75) {
                type = 'success';
            } else {
                type = 'success';
            }

            $scope.showWarning = type === 'danger' || type === 'warning';

            $scope.dynamic = value;
            $scope.type = type;
        };

        $scope.random();
        
        $scope.randomStacked = function() {
            $scope.stacked = [];
            var types = ['success', 'info', 'warning', 'danger'];

            // for (var i = 0, n = Math.floor(Math.random() * 4 + 1); i < n; i++) {
            //     var index = Math.floor(Math.random() * 4);
            //     $scope.stacked.push({
            //         value: Math.floor(Math.random() * 30 + 1),
            //         type: types[index]
            //     });
            // }
        };

        $scope.randomStacked();
    }
})();
(() => {
    angular
        .module('app.widgets')
        // angular-ui Modal
        .controller('ModalDemoCtrl', ModalDemoCtrl);

    ModalDemoCtrl.$inject = ['$scope', '$uibModal', '$log'];
    function ModalDemoCtrl($scope, $uibModal, $log) {
        $scope.items = ['item1', 'item2', 'item3'];
        $scope.animationsEnabled = true;
        $scope.open = size => {
            const modalInstance = $uibModal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'myModalContent.html',
                controller: 'ModalInstanceCtrl',
                size,
                resolve: {
                    items() {
                        return $scope.items;
                    }
                }
            });

            modalInstance.result.then(selectedItem => {
                $scope.selected = selectedItem;
            }, () => {
                $log.info(`Modal dismissed at: ${new Date()}`);
            });
        };
        $scope.toggleAnimation = () => {
            $scope.animationsEnabled = !$scope.animationsEnabled;
        };

    }
})();

(() => {
    angular
        .module('app.widgets')

        // Please note that $uibModalInstance represents a modal window (instance) dependency.
        // It is not the same as the $uibModal service used above.
        // angular-ui Modal
        .controller('ModalInstanceCtrl', ModalInstanceCtrl);

    ModalInstanceCtrl.$inject = ['$scope', '$uibModalInstance', 'items'];
    function ModalInstanceCtrl($scope, $uibModalInstance, items) {
        $scope.items = items;
        $scope.selected = {
            item: $scope.items[0]
        };

        $scope.ok = () => {
            $uibModalInstance.close($scope.selected.item);
        };

        $scope.cancel = () => {
            $uibModalInstance.dismiss('cancel');
        };
    }
})();
(() => {
    angular
        .module('app.widgets')
        .directive('rdWidget', rdWidget);

    function rdWidget() {
        const directive = {
            transclude: true,
            template: '<div class="widget" ng-transclude></div>',
            restrict: 'EA'
        };
        return directive;

        function link(scope, element, attrs) {
            /* */
        }
    }
})();

(() => {
    angular
    .module('app.widgets')
    .directive("rdWidgetBody", rdWidgetBody);

    function rdWidgetBody() {
        const d = {
            requires: "^rdWidget",
            scope: {
                loading: "@?",
                classes: "@?"
            },
            transclude: !0,
            template: '<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',
            restrict: "E"
        };
        return d
    }
})();

(() => {
    angular
    .module('app.widgets')
    .directive("rdWidgetFooter", rdWidgetFooter);

    function rdWidgetFooter() {
        const e = {
            requires: "^rdWidget",
            transclude: !0,
            template: '<div class="widget-footer" ng-transclude></div>',
            restrict: "E"
        };
        return e
    }
})();

(() => {
    angular
        .module('app.widgets')
        .directive("rdWidgetHeader", rdWidgetTitle);


    function rdWidgetTitle() {
        const e = {
            requires: "^rdWidget",
            scope: {
                title: "@",
                icon: "@"
            },
            transclude: !0,
            template: '<div class="widget-header"><i class="fa" ng-class="icon"></i> {{title}} <div class="pull-right" ng-transclude></div></div>',
            restrict: "E"
        };
        return e
    }
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJ0b29sa2l0LmpzIiwiY29yZS9jb3JlLmNvbmZpZy5qcyIsImNvcmUvY29yZS5jb250cm9sbGVycy5qcyIsImNvcmUvY29yZS5kaXJlY3RpdmVzLmpzIiwiY29yZS9jb3JlLmZpbHRlcnMuanMiLCJjb3JlL2NvcmUucm91dGVyLmpzIiwiY29yZS9jb3JlLnNlcnZpY2UuanMiLCJjb21wb25lbnRzL2NsaWVudC1vcmRlci1hZGQvY2xpZW50LW9yZGVyLWFkZC5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9jbGllbnQtb3JkZXItYWRkL2NsaWVudC1vcmRlci1hZGQuc2VydmljZS5qcyIsImNvbXBvbmVudHMvY2xpZW50LW9yZGVyLWxpc3QvY2xpZW50LW9yZGVyLWxpc3QuY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvY2xpZW50LW9yZGVyLWxpc3QvY2xpZW50LW9yZGVyLWxpc3Quc2VydmljZS5qcyIsImNvbXBvbmVudHMvY2xpZW50LW9yZGVyLXBpZS9jbGllbnQtb3JkZXIuY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvY2xpZW50LW9yZGVyLXBpZS9jbGllbnQtb3JkZXIuZGlyZWN0aXZlLmpzIiwiY29tcG9uZW50cy9jbGllbnQtb3JkZXItcGllL2NsaWVudC1vcmRlci5zZXJ2aWNlLmpzIiwiY29tcG9uZW50cy9sb2dpbi1wYW5lbC9sb2dpbi1wYW5lbC5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9sb2dpbi1wYW5lbC9sb2dpbi1wYW5lbC5kaXJlY3RpdmUuanMiLCJjb21wb25lbnRzL2xvZ2luLXBhbmVsL2xvZ2luLXBhbmVsLnNlcnZpY2UuanMiLCJjb21wb25lbnRzL21hcmtldC1vcmRlci1saXN0L21hcmtldC1vcmRlci1saXN0LmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL21hcmtldC1vcmRlci1saXN0L21hcmtldC1vcmRlci1saXN0LmRpcmVjdGl2ZS5qcyIsImNvbXBvbmVudHMvbWFya2V0LW9yZGVyLWxpc3QvbWFya2V0LW9yZGVyLWxpc3Quc2VydmljZS5qcyIsImNvbXBvbmVudHMvcmVnaXN0ZXItcGFuZWwvcmVnaXN0ZXItcGFuZWwuY29udHJvbGxlcnMuanMiLCJjb21wb25lbnRzL3Rlc3QvdGVzdC5jb250cm9sbGVycy5qcyIsImNvbXBvbmVudHMvdXNlci91c2VyLmNvbnRyb2xsZXJzLmpzIiwibGF5b3V0L2Rhc2hib2FyZC9zaWRlYmFyLmNvbnRyb2xsZXIuanMiLCJsYXlvdXQvZm9vdGVyL2Zvb3Rlci5kaXJlY3RpdmUuanMiLCJ3aWRnZXRzL2FsZXJ0cy9hbGVydHMtZGVtby5jb250cm9sbGVyLmpzIiwid2lkZ2V0cy9sb2FkaW5nL2xvYWRpbmcuZGlyZWN0aXZlcy5qcyIsIndpZGdldHMvcHJvZ3Jlc3NiYXIvcHJvZ3Jlc3NiYXItZGVtby5jb250cm9sbGVyLmpzIiwid2lkZ2V0cy9tb2RhbC9tb2RhbC1kZW1vLmNvbnRyb2xsZXIuanMiLCJ3aWRnZXRzL21vZGFsL21vZGFsLWluc3RhbmNlLmNvbnRyb2xsZXIuanMiLCJ3aWRnZXRzL3dpZGdldC93aWRnZXQuZGlyZWN0aXZlcy5qcyIsIndpZGdldHMvd2lkZ2V0LWJvZHkvYm9keS5kaXJlY3RpdmVzLmpzIiwid2lkZ2V0cy93aWRnZXQtZm9vdGVyL2Zvb3Rlci5kaXJlY3RpdmVzLmpzIiwid2lkZ2V0cy93aWRnZXQtaGVhZGVyL2hlYWRlci5kaXJlY3RpdmVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hGQTtBQUNBO0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoKCkgPT4ge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ21haW5BcHAnLCBbXHJcbiAgICAgICAgJ2FwcC5jb3JlJyxcclxuICAgICAgICAnYXBwLmxheW91dCcsXHJcbiAgICAgICAgJ2FwcC5jb21wb25lbnRzJyxcclxuICAgICAgICAnYXBwLndpZGdldHMnXHJcbiAgICBdKTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvcmUnLCBbXHJcbiAgICAgICAgJ3VpLnJvdXRlcicsXHJcbiAgICAgICAgJ3VpLmJvb3RzdHJhcCcsXHJcbiAgICAgICAgJ3VpLmxheW91dCcsXHJcbiAgICAgICAgJ25nUmVzb3VyY2UnLFxyXG4gICAgICAgICduZ0Nvb2tpZXMnLFxyXG4gICAgICAgICduZ0FuaW1hdGUnXHJcbiAgICBdKTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLndpZGdldHMnLCBbXHJcbiAgICAgICAgJ2FwcC5jb3JlJ1xyXG4gICAgXSk7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb21wb25lbnRzJywgW1xyXG4gICAgICAgICdhcHAuY29yZScsXHJcbiAgICAgICAgJ2FwcC53aWRnZXRzJ1xyXG4gICAgXSk7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5sYXlvdXQnLCBbXHJcbiAgICAgICAgJ2FwcC5jb3JlJ1xyXG4gICAgXSk7XHJcblxyXG5cclxufSkoKTtcclxuIiwiXHJcbi8vIFNhbXBsZToge2FkZHIubG9jYXRpb246YSxhZGRyLm51bWJlcjpifSA9PT4gYWRkciU1QmxvY2F0aW9uJTVEPWEmYWRkciU1Qm51bWJlciU1RD1iXHJcbmNvbnN0IHNlcmlhbGl6ZURhdGEgPSAob2JqLCBwcmVmaXgpID0+IHtcclxuICAgIGNvbnN0IHN0ciA9IFtdO1xyXG4gICAgZm9yIChsZXQgcCBpbiBvYmopIHtcclxuICAgICAgICBpZiAob2JqLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhvYmopO1xyXG4gICAgICAgICAgICB2YXIgayA9IHByZWZpeCA/IGAke3ByZWZpeH1bJHtwfV1gIDogcCxcclxuICAgICAgICAgICAgICAgIHYgPSBvYmpbcF07XHJcbiAgICAgICAgICAgIHN0ci5wdXNoKHR5cGVvZiB2ID09IFwib2JqZWN0XCIgP1xyXG4gICAgICAgICAgICAgICAgc2VyaWFsaXplRGF0YSh2LCBrKSA6XHJcbiAgICAgICAgICAgICAgICBgJHtlbmNvZGVVUklDb21wb25lbnQoayl9PSR7ZW5jb2RlVVJJQ29tcG9uZW50KHYpfWApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAob2JqLmhhc093blByb3BlcnR5KHApKSB7XHJcbiAgICAgICAgICAgIC8vICAgdmFyIGsgPSBwcmVmaXggPyBwcmVmaXggKyBcIltcIiArIHAgKyBcIl1cIiA6IHAsIHYgPSBvYmpbcF07XHJcbiAgICAgICAgICAgIHZhciBrID0gcHJlZml4ID8gYCR7cHJlZml4fS4ke3B9YCA6IHAsXHJcbiAgICAgICAgICAgICAgICB2ID0gb2JqW3BdO1xyXG4gICAgICAgICAgICBzdHIucHVzaCh0eXBlb2YgdiA9PSBcIm9iamVjdFwiID9cclxuICAgICAgICAgICAgICAgIHNlcmlhbGl6ZURhdGEodiwgaykgOlxyXG4gICAgICAgICAgICAgICAgYCR7ZW5jb2RlVVJJQ29tcG9uZW50KGspfT0ke2VuY29kZVVSSUNvbXBvbmVudCh2KX1gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3RyLmpvaW4oXCImXCIpO1xyXG59O1xyXG5cclxuLy8gU2FtcGxlOiAzNSUgPT0+IDAuMzVcclxuY29uc3QgcGVyY2VudFRvTnVtID0gcGFyYW0gPT4ge1xyXG4gICAgcGFyYW0gPSBwYXJhbS50b1N0cmluZygpLnJlcGxhY2UoJyUnLCAnJyk7XHJcbiAgICBpZiAocGFyYW0gIT0gdW5kZWZpbmVkICYmIGlzTmFOKHBhcmFtKSA9PSBmYWxzZSkge1xyXG4gICAgICAgIHJldHVybiBwYXJhbSAqIDEwMDAgLyAxMDAwMDA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxufTtcclxuXHJcbi8qKlxyXG4qICBTZWN1cmUgSGFzaCBBbGdvcml0aG0gKFNIQTI1NilcclxuKiAgaHR0cDovL3d3dy53ZWJ0b29sa2l0LmluZm8vXHJcbiogIE9yaWdpbmFsIGNvZGUgYnkgQW5nZWwgTWFyaW4sIFBhdWwgSm9obnN0b24uXHJcbioqL1xyXG5jb25zdCBTSEEyNTYgPSBzID0+IHtjb25zdCBjaHJzeiA9IDg7Y29uc3QgaGV4Y2FzZSA9IDA7ZnVuY3Rpb24gc2FmZV9hZGQoeCwgeSkge2NvbnN0IGxzdyA9ICh4ICYgMHhGRkZGKSArICh5ICYgMHhGRkZGKTtjb25zdCBtc3cgPSAoeCA+PiAxNikgKyAoeSA+PiAxNikgKyAobHN3ID4+IDE2KTtyZXR1cm4gKG1zdyA8PCAxNikgfCAobHN3ICYgMHhGRkZGKTt9ZnVuY3Rpb24gUyhYLCBuKSB7cmV0dXJuIChYID4+PiBuKSB8IChYIDw8ICgzMiAtIG4pKTt9ZnVuY3Rpb24gUihYLCBuKSB7cmV0dXJuIChYID4+PiBuKTt9ZnVuY3Rpb24gQ2goeCwgeSwgeikge3JldHVybiAoKHggJiB5KSBeICgofngpICYgeikpO31mdW5jdGlvbiBNYWooeCwgeSwgeikge3JldHVybiAoKHggJiB5KSBeICh4ICYgeikgXiAoeSAmIHopKTt9ZnVuY3Rpb24gU2lnbWEwMjU2KHgpIHtyZXR1cm4gKFMoeCwgMikgXiBTKHgsIDEzKSBeIFMoeCwgMjIpKTt9ZnVuY3Rpb24gU2lnbWExMjU2KHgpIHtyZXR1cm4gKFMoeCwgNikgXiBTKHgsIDExKSBeIFMoeCwgMjUpKTt9ZnVuY3Rpb24gR2FtbWEwMjU2KHgpIHtyZXR1cm4gKFMoeCwgNykgXiBTKHgsIDE4KSBeIFIoeCwgMykpO31mdW5jdGlvbiBHYW1tYTEyNTYoeCkge3JldHVybiAoUyh4LCAxNykgXiBTKHgsIDE5KSBeIFIoeCwgMTApKTt9ZnVuY3Rpb24gY29yZV9zaGEyNTYobSwgbCkge1xyXG4gICAgY29uc3QgSyA9IG5ldyBBcnJheSgweDQyOEEyRjk4LCAweDcxMzc0NDkxLCAweEI1QzBGQkNGLCAweEU5QjVEQkE1LCAweDM5NTZDMjVCLCAweDU5RjExMUYxLCAweDkyM0Y4MkE0LCAweEFCMUM1RUQ1LCAweEQ4MDdBQTk4LCAweDEyODM1QjAxLCAweDI0MzE4NUJFLCAweDU1MEM3REMzLCAweDcyQkU1RDc0LCAweDgwREVCMUZFLCAweDlCREMwNkE3LCAweEMxOUJGMTc0LCAweEU0OUI2OUMxLCAweEVGQkU0Nzg2LCAweEZDMTlEQzYsIDB4MjQwQ0ExQ0MsIDB4MkRFOTJDNkYsIDB4NEE3NDg0QUEsIDB4NUNCMEE5REMsIDB4NzZGOTg4REEsIDB4OTgzRTUxNTIsIDB4QTgzMUM2NkQsIDB4QjAwMzI3QzgsIDB4QkY1OTdGQzcsIDB4QzZFMDBCRjMsIDB4RDVBNzkxNDcsIDB4NkNBNjM1MSwgMHgxNDI5Mjk2NywgMHgyN0I3MEE4NSwgMHgyRTFCMjEzOCwgMHg0RDJDNkRGQywgMHg1MzM4MEQxMywgMHg2NTBBNzM1NCwgMHg3NjZBMEFCQiwgMHg4MUMyQzkyRSwgMHg5MjcyMkM4NSwgMHhBMkJGRThBMSwgMHhBODFBNjY0QiwgMHhDMjRCOEI3MCwgMHhDNzZDNTFBMywgMHhEMTkyRTgxOSwgMHhENjk5MDYyNCwgMHhGNDBFMzU4NSwgMHgxMDZBQTA3MCwgMHgxOUE0QzExNiwgMHgxRTM3NkMwOCwgMHgyNzQ4Nzc0QywgMHgzNEIwQkNCNSwgMHgzOTFDMENCMywgMHg0RUQ4QUE0QSwgMHg1QjlDQ0E0RiwgMHg2ODJFNkZGMywgMHg3NDhGODJFRSwgMHg3OEE1NjM2RiwgMHg4NEM4NzgxNCwgMHg4Q0M3MDIwOCwgMHg5MEJFRkZGQSwgMHhBNDUwNkNFQiwgMHhCRUY5QTNGNywgMHhDNjcxNzhGMik7Y29uc3QgSEFTSCA9IG5ldyBBcnJheSgweDZBMDlFNjY3LCAweEJCNjdBRTg1LCAweDNDNkVGMzcyLCAweEE1NEZGNTNBLCAweDUxMEU1MjdGLCAweDlCMDU2ODhDLCAweDFGODNEOUFCLCAweDVCRTBDRDE5KTtjb25zdCBXID0gbmV3IEFycmF5KDY0KTtcclxuICAgIGxldCBhO1xyXG4gICAgbGV0IGI7XHJcbiAgICBsZXQgYztcclxuICAgIGxldCBkO1xyXG4gICAgbGV0IGU7XHJcbiAgICBsZXQgZjtcclxuICAgIGxldCBnO1xyXG4gICAgbGV0IGg7XHJcbiAgICB2YXIgaTtcclxuICAgIHZhciBqO1xyXG4gICAgbGV0IFQxLCBUMjttW2wgPj4gNV0gfD0gMHg4MCA8PCAoMjQgLSBsICUgMzIpO21bKChsICsgNjQgPj4gOSkgPDwgNCkgKyAxNV0gPSBsO2ZvciAodmFyIGkgPSAwOyBpIDwgbS5sZW5ndGg7IGkgKz0gMTYpIHthID0gSEFTSFswXTtiID0gSEFTSFsxXTtjID0gSEFTSFsyXTtkID0gSEFTSFszXTtlID0gSEFTSFs0XTtmID0gSEFTSFs1XTtnID0gSEFTSFs2XTtoID0gSEFTSFs3XTtmb3IgKHZhciBqID0gMDsgaiA8IDY0OyBqKyspIHtpZiAoaiA8IDE2KSBXW2pdID0gbVtqICsgaV07ZWxzZSBXW2pdID0gc2FmZV9hZGQoc2FmZV9hZGQoc2FmZV9hZGQoR2FtbWExMjU2KFdbaiAtIDJdKSwgV1tqIC0gN10pLCBHYW1tYTAyNTYoV1tqIC0gMTVdKSksIFdbaiAtIDE2XSk7VDEgPSBzYWZlX2FkZChzYWZlX2FkZChzYWZlX2FkZChzYWZlX2FkZChoLCBTaWdtYTEyNTYoZSkpLCBDaChlLCBmLCBnKSksIEtbal0pLCBXW2pdKTtUMiA9IHNhZmVfYWRkKFNpZ21hMDI1NihhKSwgTWFqKGEsIGIsIGMpKTtoID0gZztnID0gZjtmID0gZTtlID0gc2FmZV9hZGQoZCwgVDEpO2QgPSBjO2MgPSBiO2IgPSBhO2EgPSBzYWZlX2FkZChUMSwgVDIpO31IQVNIWzBdID0gc2FmZV9hZGQoYSwgSEFTSFswXSk7SEFTSFsxXSA9IHNhZmVfYWRkKGIsIEhBU0hbMV0pO0hBU0hbMl0gPSBzYWZlX2FkZChjLCBIQVNIWzJdKTtIQVNIWzNdID0gc2FmZV9hZGQoZCwgSEFTSFszXSk7SEFTSFs0XSA9IHNhZmVfYWRkKGUsIEhBU0hbNF0pO0hBU0hbNV0gPSBzYWZlX2FkZChmLCBIQVNIWzVdKTtIQVNIWzZdID0gc2FmZV9hZGQoZywgSEFTSFs2XSk7SEFTSFs3XSA9IHNhZmVfYWRkKGgsIEhBU0hbN10pO31yZXR1cm4gSEFTSDtcclxufWZ1bmN0aW9uIHN0cjJiaW5iKHN0cikge2NvbnN0IGJpbiA9IEFycmF5KCk7Y29uc3QgbWFzayA9ICgxIDw8IGNocnN6KSAtIDE7Zm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoICogY2hyc3o7IGkgKz0gY2hyc3opIHtiaW5baSA+PiA1XSB8PSAoc3RyLmNoYXJDb2RlQXQoaSAvIGNocnN6KSAmIG1hc2spIDw8ICgyNCAtIGkgJSAzMik7fXJldHVybiBiaW47fWZ1bmN0aW9uIFV0ZjhFbmNvZGUoc3RyaW5nKSB7c3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL3JuL2csIFwiblwiKTtsZXQgdXRmdGV4dCA9IFwiXCI7Zm9yIChsZXQgbiA9IDA7IG4gPCBzdHJpbmcubGVuZ3RoOyBuKyspIHtjb25zdCBjID0gc3RyaW5nLmNoYXJDb2RlQXQobik7aWYgKGMgPCAxMjgpIHt1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7fSBlbHNlIGlmICgoYyA+IDEyNykgJiYgKGMgPCAyMDQ4KSkge3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiA2KSB8IDE5Mik7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjICYgNjMpIHwgMTI4KTt9IGVsc2Uge3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiAxMikgfCAyMjQpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgPj4gNikgJiA2MykgfCAxMjgpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7fX1yZXR1cm4gdXRmdGV4dDt9ZnVuY3Rpb24gYmluYjJoZXgoYmluYXJyYXkpIHtjb25zdCBoZXhfdGFiID0gaGV4Y2FzZSA/IFwiMDEyMzQ1Njc4OUFCQ0RFRlwiIDogXCIwMTIzNDU2Nzg5YWJjZGVmXCI7bGV0IHN0ciA9IFwiXCI7Zm9yIChsZXQgaSA9IDA7IGkgPCBiaW5hcnJheS5sZW5ndGggKiA0OyBpKyspIHtzdHIgKz0gaGV4X3RhYi5jaGFyQXQoKGJpbmFycmF5W2kgPj4gMl0gPj4gKCgzIC0gaSAlIDQpICogOCArIDQpKSAmIDB4RikgKyBoZXhfdGFiLmNoYXJBdCgoYmluYXJyYXlbaSA+PiAyXSA+PiAoKDMgLSBpICUgNCkgKiA4KSkgJiAweEYpO31yZXR1cm4gc3RyO31zID0gVXRmOEVuY29kZShzKTtyZXR1cm4gYmluYjJoZXgoY29yZV9zaGEyNTYoc3RyMmJpbmIocyksIHMubGVuZ3RoICogY2hyc3opKTt9O1xyXG5cclxuLyoqXHJcbiogIFNlY3VyZSBIYXNoIEFsZ29yaXRobSAoU0hBMSlcclxuKiAgaHR0cDovL3d3dy53ZWJ0b29sa2l0LmluZm8vXHJcbioqL1xyXG5jb25zdCBTSEExID0gbXNnID0+IHtmdW5jdGlvbiByb3RhdGVfbGVmdChuLCBzKSB7Y29uc3QgdDQgPSAoIG48PHMgKSB8IChuPj4+KDMyLXMpKTtyZXR1cm4gdDQ7fTtmdW5jdGlvbiBsc2JfaGV4KHZhbCkge2xldCBzdHI9XCJcIjtsZXQgaTtsZXQgdmg7bGV0IHZsO2ZvciggaT0wOyBpPD02OyBpKz0yICkge3ZoID0gKHZhbD4+PihpKjQrNCkpJjB4MGY7dmwgPSAodmFsPj4+KGkqNCkpJjB4MGY7c3RyICs9IHZoLnRvU3RyaW5nKDE2KSArIHZsLnRvU3RyaW5nKDE2KTt9cmV0dXJuIHN0cjt9O2Z1bmN0aW9uIGN2dF9oZXgodmFsKSB7bGV0IHN0cj1cIlwiO2xldCBpO2xldCB2O2ZvciggaT03OyBpPj0wOyBpLS0gKSB7diA9ICh2YWw+Pj4oaSo0KSkmMHgwZjtzdHIgKz0gdi50b1N0cmluZygxNik7fXJldHVybiBzdHI7fTtmdW5jdGlvbiBVdGY4RW5jb2RlKHN0cmluZykge3N0cmluZyA9IHN0cmluZy5yZXBsYWNlKC9ybi9nLFwiblwiKTtsZXQgdXRmdGV4dCA9IFwiXCI7Zm9yIChsZXQgbiA9IDA7IG4gPCBzdHJpbmcubGVuZ3RoOyBuKyspIHtjb25zdCBjID0gc3RyaW5nLmNoYXJDb2RlQXQobik7aWYgKGMgPCAxMjgpIHt1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7fWVsc2UgaWYoKGMgPiAxMjcpICYmIChjIDwgMjA0OCkpIHt1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgPj4gNikgfCAxOTIpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7fWVsc2Uge3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiAxMikgfCAyMjQpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgPj4gNikgJiA2MykgfCAxMjgpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7fX1yZXR1cm4gdXRmdGV4dDt9O2xldCBibG9ja3N0YXJ0O2xldCBpLCBqO2NvbnN0IFcgPSBuZXcgQXJyYXkoODApO2xldCBIMCA9IDB4Njc0NTIzMDE7bGV0IEgxID0gMHhFRkNEQUI4OTtsZXQgSDIgPSAweDk4QkFEQ0ZFO2xldCBIMyA9IDB4MTAzMjU0NzY7bGV0IEg0ID0gMHhDM0QyRTFGMDtsZXQgQSwgQiwgQywgRCwgRTt2YXIgdGVtcDttc2cgPSBVdGY4RW5jb2RlKG1zZyk7Y29uc3QgbXNnX2xlbiA9IG1zZy5sZW5ndGg7Y29uc3Qgd29yZF9hcnJheSA9IG5ldyBBcnJheSgpO2ZvciggaT0wOyBpPG1zZ19sZW4tMzsgaSs9NCApIHtqID0gbXNnLmNoYXJDb2RlQXQoaSk8PDI0IHwgbXNnLmNoYXJDb2RlQXQoaSsxKTw8MTYgfG1zZy5jaGFyQ29kZUF0KGkrMik8PDggfCBtc2cuY2hhckNvZGVBdChpKzMpO3dvcmRfYXJyYXkucHVzaChqKTt9c3dpdGNoKCBtc2dfbGVuICUgNCApIHtjYXNlIDA6aSA9IDB4MDgwMDAwMDAwO2JyZWFrO2Nhc2UgMTppID0gbXNnLmNoYXJDb2RlQXQobXNnX2xlbi0xKTw8MjQgfCAweDA4MDAwMDA7YnJlYWs7Y2FzZSAyOmkgPSBtc2cuY2hhckNvZGVBdChtc2dfbGVuLTIpPDwyNCB8IG1zZy5jaGFyQ29kZUF0KG1zZ19sZW4tMSk8PDE2IHwgMHgwODAwMDticmVhaztjYXNlIDM6aSA9IG1zZy5jaGFyQ29kZUF0KG1zZ19sZW4tMyk8PDI0IHwgbXNnLmNoYXJDb2RlQXQobXNnX2xlbi0yKTw8MTYgfCBtc2cuY2hhckNvZGVBdChtc2dfbGVuLTEpPDw4IHwgMHg4MDticmVhazt9d29yZF9hcnJheS5wdXNoKGkpO3doaWxlKCAod29yZF9hcnJheS5sZW5ndGggJSAxNikgIT0gMTQgKSB3b3JkX2FycmF5LnB1c2goMCk7d29yZF9hcnJheS5wdXNoKG1zZ19sZW4+Pj4yOSk7d29yZF9hcnJheS5wdXNoKChtc2dfbGVuPDwzKSYweDBmZmZmZmZmZik7Zm9yICggYmxvY2tzdGFydD0wOyBibG9ja3N0YXJ0PHdvcmRfYXJyYXkubGVuZ3RoOyBibG9ja3N0YXJ0Kz0xNiApIHtmb3IoIGk9MDsgaTwxNjsgaSsrICkgV1tpXSA9IHdvcmRfYXJyYXlbYmxvY2tzdGFydCtpXTtmb3IoIGk9MTY7IGk8PTc5OyBpKysgKSBXW2ldID0gcm90YXRlX2xlZnQoV1tpLTNdIF4gV1tpLThdIF4gV1tpLTE0XSBeIFdbaS0xNl0sIDEpO0EgPSBIMDtCID0gSDE7QyA9IEgyO0QgPSBIMztFID0gSDQ7Zm9yKCBpPSAwOyBpPD0xOTsgaSsrICkge3RlbXAgPSAocm90YXRlX2xlZnQoQSw1KSArICgoQiZDKSB8ICh+QiZEKSkgKyBFICsgV1tpXSArIDB4NUE4Mjc5OTkpICYgMHgwZmZmZmZmZmY7RSA9IEQ7RCA9IEM7QyA9IHJvdGF0ZV9sZWZ0KEIsMzApO0IgPSBBO0EgPSB0ZW1wO31mb3IoIGk9MjA7IGk8PTM5OyBpKysgKSB7dGVtcCA9IChyb3RhdGVfbGVmdChBLDUpICsgKEIgXiBDIF4gRCkgKyBFICsgV1tpXSArIDB4NkVEOUVCQTEpICYgMHgwZmZmZmZmZmY7RSA9IEQ7RCA9IEM7QyA9IHJvdGF0ZV9sZWZ0KEIsMzApO0IgPSBBO0EgPSB0ZW1wO31mb3IoIGk9NDA7IGk8PTU5OyBpKysgKSB7dGVtcCA9IChyb3RhdGVfbGVmdChBLDUpICsgKChCJkMpIHwgKEImRCkgfCAoQyZEKSkgKyBFICsgV1tpXSArIDB4OEYxQkJDREMpICYgMHgwZmZmZmZmZmY7RSA9IEQ7RCA9IEM7QyA9IHJvdGF0ZV9sZWZ0KEIsMzApO0IgPSBBO0EgPSB0ZW1wO31mb3IoIGk9NjA7IGk8PTc5OyBpKysgKSB7dGVtcCA9IChyb3RhdGVfbGVmdChBLDUpICsgKEIgXiBDIF4gRCkgKyBFICsgV1tpXSArIDB4Q0E2MkMxRDYpICYgMHgwZmZmZmZmZmY7RSA9IEQ7RCA9IEM7QyA9IHJvdGF0ZV9sZWZ0KEIsMzApO0IgPSBBO0EgPSB0ZW1wO31IMCA9IChIMCArIEEpICYgMHgwZmZmZmZmZmY7SDEgPSAoSDEgKyBCKSAmIDB4MGZmZmZmZmZmO0gyID0gKEgyICsgQykgJiAweDBmZmZmZmZmZjtIMyA9IChIMyArIEQpICYgMHgwZmZmZmZmZmY7SDQgPSAoSDQgKyBFKSAmIDB4MGZmZmZmZmZmO312YXIgdGVtcCA9IGN2dF9oZXgoSDApICsgY3Z0X2hleChIMSkgKyBjdnRfaGV4KEgyKSArIGN2dF9oZXgoSDMpICsgY3Z0X2hleChINCk7cmV0dXJuIHRlbXAudG9Mb3dlckNhc2UoKTt9O1xyXG5cclxuXHJcbi8vIEdyYWIgdGhlIGZpbGVzIGFuZCBzZXQgdGhlbSB0byBvdXIgdmFyaWFibGVcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyA8aW5wdXQgaWQ9XCJmaWxldXBsb2FkXCIgdHlwZT1cImZpbGVcIiBjbGFzcz1cIlwiIG5hbWU9XCJmaWxlc1tdXCIgZGF0YS11cmw9XCJ1cGxvYWQuZG9cIiBtdWx0aXBsZT5cclxuZnVuY3Rpb24gcHJlcGFyZVVwbG9hZChldmVudCkge1xyXG4gICAgY29uc3QgZWxlID0gJCh0aGlzKS5zaWJsaW5ncygnLmhpZGRlbicpWzBdO1xyXG4gICAgdXBsb2FkRmlsZXMoZXZlbnQudGFyZ2V0LmZpbGVzLCBlbGUpO1xyXG5cclxuICAgIC8vIGVsZS52YWx1ZSA9IHJlc0ZpbGVJZDtcclxuICAgIC8vXHJcbiAgICAvLyB0cnkge1xyXG4gICAgLy8gICAgIHZhciByZXNGaWxlSWQgPSB1cGxvYWRGaWxlcyhldmVudC50YXJnZXQuZmlsZXMpO1xyXG4gICAgLy8gICAgIHZhciBlbGUgPSAkKHRoaXMpLnNpYmxpbmdzKCcuaGlkZGVuJylbMF0udmFsdWU7XHJcbiAgICAvLyAgICAgdmFyIGFycmF5ID0gZWxlID09IFwiXCI/IFtdIDogZWxlLnNwbGl0KCcsJykgO1xyXG4gICAgLy8gfSBjYXRjaCAoZSkge1xyXG4gICAgLy8gICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgLy8gfSBmaW5hbGx5IHtcclxuICAgIC8vICAgICBjb25zb2xlLmxvZyhhcnJheSk7XHJcbiAgICAvLyAgICAgYXJyYXkucHVzaChyZXNGaWxlSWQpO1xyXG4gICAgLy8gICAgIGNvbnNvbGUubG9nKGFycmF5KTtcclxuICAgIC8vICAgICBlbGUudmFsdWUgPSBhcnJheS5qb2luKCcsJykpLnRyaWdnZXIoJ2lucHV0JztcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBlbGUudmFsKGVsZS52YWwoKS5zcGxpdCgnLCcpLnB1c2gocmVzSWQpLmpvaW4oJywnKSkudHJpZ2dlcignaW5wdXQnKTtcclxuXHJcbiAgICAvLyAkKHRoaXMpLnNpYmxpbmdzKCcuaGlkZGVuJykudmFsKHVwbG9hZEZpbGVzKGV2ZW50LnRhcmdldC5maWxlcykpLnRyaWdnZXIoJ2lucHV0Jyk7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogQHBhcmFtIGZpbGVzIHVwbG9hZGluZyBmaWxlc1xyXG4gKiBAcGFyYW0gZWxlIGVsZW1lbnQgdGhhdCBuZWVkIHRvIHJlY2VpdmUgcmVzcG9uc2UgSURcclxuICogQGRlc2MgRmlsZXMgdXBsb2FkIG1vZHVsZSBmb3IgdGVzdC4gV2hlbiByZWNlaXZlZCBpZCwgdXNpbmcgXCJ0cmlnZ2VyKCdpbnB1dCcpXCIgbWFrZSBuZy1tb2RlbCBrbm93XHJcbiAqL1xyXG5mdW5jdGlvbiB1cGxvYWRGaWxlcyhmaWxlcywgZWxlKSB7XHJcbiAgICAvLyBDcmVhdGUgYSBmb3JtZGF0YSBvYmplY3QgYW5kIGFkZCB0aGUgZmlsZXNcclxuICAgIGNvbnN0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICQuZWFjaChmaWxlcywgKGtleSwgdmFsdWUpID0+IHtcclxuICAgICAgICBkYXRhLmFwcGVuZChcImZpbGVzXCIsIHZhbHVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGZpbGVzKVxyXG5cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAndXBsb2FkLmRvJyxcclxuICAgICAgICB0eXBlOiAnUE9TVCcsXHJcbiAgICAgICAgZGF0YSxcclxuICAgICAgICBjYWNoZTogZmFsc2UsXHJcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsIC8vIERvbid0IHByb2Nlc3MgdGhlIGZpbGVzXHJcbiAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLCAvLyBTZXQgY29udGVudCB0eXBlIHRvIGZhbHNlIGFzIGpRdWVyeSB3aWxsIHRlbGwgdGhlIHNlcnZlciBpdHMgYSBxdWVyeSBzdHJpbmcgcmVxdWVzdFxyXG4gICAgICAgIHN1Y2Nlc3MoZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhLmVycm9yID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgLy8gU3VjY2VzcyBzbyBjYWxsIGZ1bmN0aW9uIHRvIHByb2Nlc3MgdGhlIGZvcm1cclxuICAgICAgICAgICAgICAgIGZpbGVpZCA9IGRhdGEuY29udGVudC5uYW1lO1xyXG4gICAgICAgICAgICAgICAgZWxlLnZhbHVlID0gZGF0YS5jb250ZW50Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICAkKGVsZSkudHJpZ2dlcignaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgIC8vIHN1Ym1pdEZvcm0oZXZlbnQsIGRhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIGVycm9ycyBoZXJlXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRVJST1JTOiAke2RhdGEuZXJyb3J9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xyXG4gICAgICAgICAgICAvLyBIYW5kbGUgZXJyb3JzIGhlcmVcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYEVSUk9SUzogJHt0ZXh0U3RhdHVzfWApO1xyXG4gICAgICAgICAgICAvLyBTVE9QIExPQURJTkcgU1BJTk5FUlxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcbiIsIi8qKlxyXG4gKiBAYXV0aG9yIFNoYXduXHJcbiAqIEBkZXNjIG1haW5BUFBcclxuICovXHJcbigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvcmUnKVxyXG4gICAgICAgIC8vIEdsb2JhbFxyXG4gICAgICAgIC5jb25zdGFudCgnV0VCX0lORk8nLCB7XHJcbiAgICAgICAgICAgIHRpdGxlOiAnT3JkZXIgTWFuYWdlbWVudCBTeXN0ZW0nXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgLmNvbnN0YW50KCdBVVRIX0VWRU5UUycsIHtcclxuICAgICAgICAgICAgbG9naW5TdWNjZXNzOiAnYXV0aC1sb2dpbi1zdWNjZXNzJyxcclxuICAgICAgICAgICAgbG9naW5GYWlsZWQ6ICdhdXRoLWxvZ2luLWZhaWxlZCcsXHJcbiAgICAgICAgICAgIGxvZ291dFN1Y2Nlc3M6ICdhdXRoLWxvZ291dC1zdWNjZXNzJyxcclxuICAgICAgICAgICAgc2Vzc2lvblRpbWVvdXQ6ICdhdXRoLXNlc3Npb24tdGltZW91dCcsXHJcbiAgICAgICAgICAgIG5vdEF1dGhlbnRpY2F0ZWQ6ICdhdXRoLW5vdC1hdXRoZW50aWNhdGVkJyxcclxuICAgICAgICAgICAgcGFnZU5vdEZvdW5kOiAncGFnZS1ub3QtZm91bmQnLFxyXG4gICAgICAgICAgICBzZXJ2ZXJFcnJvcjogJ3NlcnZlci1lcnJvcidcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAvLyBEbyBhdXRoIHdoZW4gc3RhdGUvdXJsIGNoYW5nZVxyXG4gICAgICAgIC5ydW4oKCRyb290U2NvcGUsIEFVVEhfRVZFTlRTLCBBdXRoU2VydmljZSkgPT4ge1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCAoZXZlbnQsIG5leHQpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoQVVUSF9FVkVOVFMubm90QXV0aGVudGljYXRlZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSBBdXRoU2VydmljZS5nZXRVc2VybmFtZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG59KSgpO1xyXG4iLCIvKipcclxuICogQGF1dGhvciBTaGF3blxyXG4gKiBAZGVzYyBUaGUgUm9vdCBDb250cm9sbGVyIG9mIHRoZSBtYWluQVBQXHJcbiAqL1xyXG4oKCkgPT4ge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb3JlJylcclxuICAgICAgICAuY29udHJvbGxlcignbWFpbkN0cmwnLCBtYWluQ3RybCk7XHJcblxyXG4gICAgbWFpbkN0cmwuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJGxvY2F0aW9uJywgJyRzdGF0ZScsICckd2luZG93JywgJ0F1dGhTZXJ2aWNlJywgJ0FVVEhfRVZFTlRTJywgJ0NvbW1vblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ3RybChcclxuICAgICAgICAkcm9vdFNjb3BlLFxyXG4gICAgICAgICRzY29wZSxcclxuICAgICAgICAkbG9jYXRpb24sXHJcbiAgICAgICAgJHN0YXRlLFxyXG4gICAgICAgICR3aW5kb3csXHJcbiAgICAgICAgQXV0aFNlcnZpY2UsXHJcbiAgICAgICAgQVVUSF9FVkVOVFMsXHJcbiAgICAgICAgQ29tbW9uU2VydmljZSkge1xyXG5cclxuICAgICAgICBpZiAoIUF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coMSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLnNldEN1cnJlbnRVc2VyID0gdXNlciA9PiB7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIExvZyBvdXRcclxuICAgICAgICAkc2NvcGUubG9nb3V0ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gbnVsbDtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KEFVVEhfRVZFTlRTLmxvZ291dFN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbG9nb3V0IHN1Y2Nlc3MnKTtcclxuICAgICAgICAgICAgLy8gQXV0aFNlcnZpY2UubG9nb3V0KCkudGhlbihmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgLy8gICAgIGlmIChDb21tb25TZXJ2aWNlLmlzUmVxU3VjY2VzcyhyZXMpKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KEFVVEhfRVZFTlRTLmxvZ291dFN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCdMb2cgb3V0IHN1Y2Nlc3MnKTtcclxuICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgQ29tbW9uU2VydmljZS5oYW5kbGVSZXNFcnIocmVzKTtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgIC8vICAgICBDb21tb25TZXJ2aWNlLmhhbmRsZUh0dHBFcnIocmVzKTtcclxuICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMaXN0ZW5pbmdcclxuICAgICAgICAkc2NvcGUuJG9uKEFVVEhfRVZFTlRTLmxvZ2luU3VjY2VzcywgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibG9naW4gc3VjY2Vzc1wiKTtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdkYXNoYm9hcmQub3JkZXInKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbihBVVRIX0VWRU5UUy5sb2dpbkZhaWxlZCwgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmRlc3RvcnkoKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2dpbiBmYWlsZWRcIik7XHJcbiAgICAgICAgICAgIC8vICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oQVVUSF9FVkVOVFMubG9nb3V0U3VjY2VzcywgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2dpbiBmYWlsZWRcIik7XHJcbiAgICAgICAgICAgIC8vICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ21ldGhvZC1ub3QtYWxsb3cnLCAoZXZlbnQsIGRhdGEpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJtZXRob2Qgbm90IGFsbG93XCIpO1xyXG4gICAgICAgICAgICAvLyAkbG9jYXRpb24ucGF0aCgnLycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKEFVVEhfRVZFTlRTLnBhZ2VOb3RGb3VuZCwgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCc0MDQgZXJyb3InKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbihBVVRIX0VWRU5UUy5zZXJ2ZXJFcnJvciwgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCc1MDAgZXJyb3InKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7fSkoKTtcclxuIiwiLyoqXHJcbiAqIEBhdXRob3IgU2hhd25cclxuICogQGRlc2MgbWFpbkFQUFxyXG4gKi9cclxuKCgpID0+IHtcclxuICAgIGNvbnN0IFBST0pFQ1RTVEFUVVMgPSB7XHJcbiAgICAgICAgMDogXCJ0ZVwiLFxyXG4gICAgICAgIDE6IFwiMlwiLFxyXG4gICAgICAgIDI6IFwiM1wiLFxyXG4gICAgICAgIDM6IFwiclwiLFxyXG4gICAgICAgIDQ6IFwiclwiLFxyXG4gICAgICAgIDU6IFwiZmV3ZlwiLFxyXG4gICAgICAgIDY6IFwiZmVhd1wiXHJcbiAgICB9O1xyXG5cclxuICAgIC8qIGZpbHRlcnMgKi9cclxuICAgIGNvbnN0IGZpbHRlcnMgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvcmUnKVxyXG5cclxuICAgIC5maWx0ZXIoJ3N3aXRjaCcsICgpID0+IHBhcmFtID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT0gMSB8fCBwYXJhbSA9PSAnMScpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdPUEVOJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJ0NMT1NFRCc7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAvLyA3OCA9PT0+IDAuNzhcclxuICAgIC5maWx0ZXIoJ3BlcmNlbnQnLCAoKSA9PiBwYXJhbSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcmFtICE9IHVuZGVmaW5lZCAmJiBpc05hTihwYXJhbSkgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBhcmFtICogMTAwMCAvIDEwMDAwMDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAuZmlsdGVyKCdjYXRlZ29yeScsICgpID0+IHtcclxuICAgICAgICBjb25zdCBvYmogPSBDQVRFR09SWTtcclxuICAgICAgICByZXR1cm4gcGFyYW0gPT4gb2JqW3BhcmFtXSAhPSB1bmRlZmluZWQgPyBvYmpbcGFyYW1dIDogXCJcIlxyXG4gICAgfSlcclxuXHJcbiAgICAuZmlsdGVyKCdidWlsZGNvbXBhbnknLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gQlVJTERDT01QQU5ZO1xyXG4gICAgICAgIHJldHVybiBwYXJhbSA9PiBvYmpbcGFyYW1dICE9IHVuZGVmaW5lZCA/IG9ialtwYXJhbV0gOiBcIlwiXHJcbiAgICB9KVxyXG5cclxuICAgIC5maWx0ZXIoJ3Byb2plY3RzdGF0dXMnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gUFJPSkVDVFNUQVRVUztcclxuICAgICAgICByZXR1cm4gcGFyYW0gPT4gb2JqW3BhcmFtXSAhPSB1bmRlZmluZWQgPyBvYmpbcGFyYW1dIDogXCJcIlxyXG4gICAgfSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIEBhdXRob3IgU2hhd25cclxuICogQGRlc2Mgcm91dGVyIG9mIGFwcC5jb3JlXHJcbiAqL1xyXG4oKCkgPT4ge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJylcclxuXHJcbiAgICAgICAgLmNvbmZpZyhcclxuICAgICAgICAoJHN0YXRlUHJvdmlkZXIsICRodHRwUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpID0+IHtcclxuXHJcbiAgICAgICAgICAgIC8vIEludGVyY2VwdG9yIG9mIFJlcXVlc3RzXHJcbiAgICAgICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goW1xyXG4gICAgICAgICAgICAgICAgJyRpbmplY3RvcicsXHJcbiAgICAgICAgICAgICAgICAkaW5qZWN0b3IgPT4gJGluamVjdG9yLmdldCgnQXV0aEludGVyY2VwdG9yJylcclxuICAgICAgICAgICAgXSk7XHJcblxyXG4gICAgICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUoe1xyXG4gICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICByZXF1aXJlQmFzZTogZmFsc2VcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBGb3IgYW55IHVubWF0Y2hlZCB1cmwsIHJlZGlyZWN0IHRvIC9cclxuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2xvZ2luJyk7XHJcblxyXG5cclxuICAgICAgICAgICAgLy8gbG9naW5yZWdpc3RlclxyXG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxyXG5cclxuICAgICAgICAgICAgICAgIC8vIG1haW4gcGFnZVxyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdkYXNoYm9hcmQnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnLycsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdodG1sL2Rhc2hib2FyZC5odG1sJ1xyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJkYXNoYm9hcmQub3JkZXJcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJvcmRlclwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImpzL2NvbXBvbmVudHMvY2xpZW50LW9yZGVyLWxpc3QvY2xpZW50LW9yZGVyLWxpc3QuaHRtbFwiXHJcbiAgICAgICAgICAgICAgICB9KS5zdGF0ZShcImRhc2hib2FyZC5hZGRDbGllbnRPcmRlclwiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIm9yZGVyYWRkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwianMvY29tcG9uZW50cy9jbGllbnQtb3JkZXItYWRkL2NsaWVudC1vcmRlci1hZGQuaHRtbFwiXHJcbiAgICAgICAgICAgICAgICB9KS5zdGF0ZShcImRhc2hib2FyZC5kZW1vXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiZGVtb1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImh0bWwvZGVtby5odG1sXCJcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnaHRtbC9sb2dpbi5odG1sJ1xyXG4gICAgICAgICAgICAgICAgfSkuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9yZWdpc3RlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdodG1sL3JlZ2lzdGVyLmh0bWwnXHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFVzZXIgQWNjb3VudFxyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhY2NvdW50Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9hY2NvdW50JyxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2h0bWwvYWNjb3VudC9hY2NvdW50Lmh0bWwnXHJcbiAgICAgICAgICAgICAgICB9KS5zdGF0ZSgnYWNjb3VudC5tZScsIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvbWUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnaHRtbC9hY2NvdW50L2FjY291bnQubWUuaHRtbCdcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgLy8gZm9yIHRlc3RcclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndGVzdCcsIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvdGVzdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdodG1sL3Rlc3QtYW5ndWxhci11aS1ib290c3RyYXAuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3Rlc3RDdHJsJ1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgKTtcclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIEBhdXRob3IgU2hhd25cclxuICogQGRlc2MgU2VydmljZXMgb2YgdGhlIG1haW5BUFBcclxuICovXHJcblxyXG4vLyBGb3IgdGVzdFxyXG5jb25zdCBjb21tb25UZXN0ID0gdHJ1ZTtcclxuXHJcbigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvcmUnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdBdXRoSW50ZXJjZXB0b3InLCBBdXRoSW50ZXJjZXB0b3IpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0NvbW1vblNlcnZpY2UnLCBDb21tb25TZXJ2aWNlKVxyXG4gICAgICAgIC5mYWN0b3J5KCdBdXRoU2VydmljZScsIEF1dGhTZXJ2aWNlKVxyXG4gICAgICAgIC5mYWN0b3J5KCdyZWdpc3RlclNlcnZpY2UnLCByZWdpc3RlclNlcnZpY2UpXHJcbiAgICAgICAgLmZhY3RvcnkoJ3VzZXJTZXJ2aWNlJywgdXNlclNlcnZpY2UpO1xyXG5cclxuICAgIEF1dGhJbnRlcmNlcHRvci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJyRxJywgJyR3aW5kb3cnLCAnQVVUSF9FVkVOVFMnXTtcclxuICAgIEF1dGhTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRyb290U2NvcGUnLCAnQVVUSF9FVkVOVFMnLCAnJHdpbmRvdycsICdDb21tb25TZXJ2aWNlJ107XHJcbiAgICBDb21tb25TZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJ107XHJcbiAgICByZWdpc3RlclNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHJvb3RTY29wZScsICdDb21tb25TZXJ2aWNlJ107XHJcbiAgICB1c2VyU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcm9vdFNjb3BlJywgJ0NvbW1vblNlcnZpY2UnXTtcclxuXHJcblxyXG4gICAgLy8gSW50ZXJjZXB0b3JcclxuICAgIGZ1bmN0aW9uIEF1dGhJbnRlcmNlcHRvcigkcm9vdFNjb3BlLCAkcSwgJHdpbmRvdywgQVVUSF9FVkVOVFMpIHtcclxuICAgICAgICBjb25zdCBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICByZXF1ZXN0OiByZXF1ZXN0SGFuZGxlcixcclxuICAgICAgICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlSGFuZGxlcixcclxuICAgICAgICAgICAgcmVzcG9uc2VFcnJvcjogcmVzcG9uc2VFcnJvckhhbmRsZXJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXF1ZXN0SGFuZGxlcihjb25maWcpIHtcclxuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgaWYgKCR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snWC1BdXRoVG9rZW4nXSA9ICR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjb25maWc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNwb25zZUhhbmRsZXIocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xyXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzcG9uc2VFcnJvckhhbmRsZXIocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3Qoe1xyXG4gICAgICAgICAgICAgICAgNDAxOiBBVVRIX0VWRU5UUy5ub3RBdXRoZW50aWNhdGVkLFxyXG4gICAgICAgICAgICAgICAgNDAzOiBBVVRIX0VWRU5UUy5ub3RBdXRob3JpemVkLFxyXG4gICAgICAgICAgICAgICAgNDA1OiAnbWV0aG9kLW5vdC1hbGxvdycsXHJcbiAgICAgICAgICAgICAgICA0MTk6IEFVVEhfRVZFTlRTLnNlc3Npb25UaW1lb3V0LFxyXG4gICAgICAgICAgICAgICAgNDQwOiBBVVRIX0VWRU5UUy5zZXNzaW9uVGltZW91dCxcclxuICAgICAgICAgICAgICAgIDQwNDogQVVUSF9FVkVOVFMucGFnZU5vdEZvdW5kLFxyXG4gICAgICAgICAgICAgICAgNTAwOiBBVVRIX0VWRU5UUy5zZXJ2ZXJFcnJvclxyXG4gICAgICAgICAgICB9W3Jlc3BvbnNlLnN0YXR1c10sIHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIEF1dGhTZXJ2aWNlKCRodHRwLCAkcm9vdFNjb3BlLCBBVVRIX0VWRU5UUywgJHdpbmRvdywgQ29tbW9uU2VydmljZSkge1xyXG5cclxuICAgICAgICBjb25zdCBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIGxldCBzdG9yYWdlVG9rZW5UaXRsZSA9ICd0b2tlbicsXHJcbiAgICAgICAgICAgIHN0b3JhZ2VVc2VyVGl0bGUgPSAndXNlcm5hbWUnO1xyXG5cclxuICAgICAgICAvLyBmb3JuIHVzZXIgaW5mb21hdGlvbiAoaW5jbHVkZSB0b2tlbilcclxuICAgICAgICBzZXJ2aWNlLmNyZWF0ZVVzZXJJbmZvID0gKHVzZXJuYW1lLCB0b2tlbikgPT4ge1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKHN0b3JhZ2VVc2VyVGl0bGUsIHVzZXJuYW1lKTtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yYWdlVG9rZW5UaXRsZSwgdG9rZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZXJ2aWNlLmRlc3Ryb3kgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oc3RvcmFnZVVzZXJUaXRsZSk7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oc3RvcmFnZVRva2VuVGl0bGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gb25seSBmb3IgVG9rZW5cclxuICAgICAgICBzZXJ2aWNlLmNyZWF0ZVRva2VuID0gKHRva2VuKSA9PiB7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oc3RvcmFnZVRva2VuVGl0bGUsIHRva2VuKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzZXJ2aWNlLmdldFRva2VuID0gKCkgPT4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShzdG9yYWdlVG9rZW5UaXRsZSk7XHJcblxyXG4gICAgICAgIHNlcnZpY2UucmVtb3ZlVG9rZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oc3RvcmFnZVRva2VuVGl0bGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gb25seSBmb3IgdXNlcm5hbWVcclxuICAgICAgICBzZXJ2aWNlLmdldFVzZXJuYW1lID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VVc2VyVGl0bGUpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2VydmljZS5sb2dpbiA9IHVzZXIgPT4gQ29tbW9uU2VydmljZS5wb3N0KFwibG9naW5cIiwgdXNlcik7XHJcblxyXG4gICAgICAgIHNlcnZpY2UubG9nb3V0ID0gKCkgPT4gQ29tbW9uU2VydmljZS5wb3N0KFwibG9nb3V0XCIpO1xyXG5cclxuICAgICAgICAvLyBpcyBzZXNzaW9uIGF2YWxpZFxyXG4gICAgICAgIHNlcnZpY2UuaXNBdXRoZW50aWNhdGVkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgaXNBdXRoZW50aWNhdGVkOiAkeyEhJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW59YCk7XHJcbiAgICAgICAgICAgIHJldHVybiAhISR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBmdW5jdGlvbiByZWdpc3RlclNlcnZpY2UoJGh0dHAsICRyb290U2NvcGUsIENvbW1vblNlcnZpY2UpIHtcclxuICAgICAgICBjb25zdCBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIHNlcnZpY2UucmVnaXN0ZXIgPSB1c2VyID0+IENvbW1vblNlcnZpY2UucG9zdChcInJlZ2lzdGVyXCIsIHVzZXIpO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB1c2VyU2VydmljZSgkaHR0cCwgJHJvb3RTY29wZSwgQ29tbW9uU2VydmljZSkge1xyXG4gICAgICAgIGNvbnN0IHNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vIEdsb2JhbCBTZXJ2aWNlc1xyXG4gICAgZnVuY3Rpb24gQ29tbW9uU2VydmljZSgkaHR0cCkge1xyXG4gICAgICAgIC8vIFNldCBDb250ZW50LVR5cGUgdG8gZm9ybS1kYXRhIHdoaWNoIGJhY2stZW5kIGNhbiBhY2NlcHRcclxuICAgICAgICAvLyAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLnBvc3RbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDtjaGFyc2V0PXV0Zi04JztcclxuXHJcbiAgICAgICAgY29uc3QgdXJsQmFja0VuZCA9ICdodHRwOi8vbG9mZXdmY2FsaG9zdDo4MDgwL3dzLyc7XHJcbiAgICAgICAgLy8gdmFyIHVybEJhY2tFbmQgPSAnaHR0cDovLzEwLjIyLjE2LjEyNDo4MDg4L3dzL21hcmtldG9yZGVyL2dldEJ5Q2xpZW50T3JkZXJJZC8nO1xyXG4gICAgICAgIGNvbnN0IHVybE1pZGRsZUVuZCA9ICdodHRwczovL0V4YW1wbGVVUkwuOTIvJztcclxuXHJcbiAgICAgICAgLy8gcmVxdWVzdHMgc3RhdHVzIGhhbmRsZVxyXG4gICAgICAgIHRoaXMuaXNSZXFTdWNjZXNzID0gcmVzID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5kYXRhLmVyckNvZGUgPT0gMCA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBoYW5kbGUgSHR0cCBlcnJvclxyXG4gICAgICAgIHRoaXMuaGFuZGxlSHR0cEVyciA9IHJlcyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXEgRXJyb3InLCByZXMpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGhhbmRsZSByZXNwb25zZSBlcnJvciAoYmFzZSBvbiBBUEkpXHJcbiAgICAgICAgdGhpcy5oYW5kbGVSZXNFcnIgPSByZXMgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgICAgICBpZiAocmVzLmRhdGEuZXJyRGVzYyA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciB3aXRob3V0IGRpc2NyaXB0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgbXNnOiAke3Jlcy5lcnJEZXNjfWApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQocmVzLmRhdGEuZXJyRGVzYyk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBwb3N0IHNpbmdsZSBjb21tYW5kIHRvIGJhY2stZW5kIHNlcnZlclxyXG4gICAgICAgIHRoaXMucG9zdCA9IChjb21tYW5kLCBkYXRhKSA9PiBjb21tb25UZXN0ID8gJGh0dHAoe1xyXG4gICAgICAgICAgICB1cmw6IGB0ZXN0LWRhdGEvd3MvJHtjb21tYW5kfWAsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCdcclxuICAgICAgICB9KSA6ICRodHRwKHtcclxuICAgICAgICAgICAgdXJsOiB1cmxCYWNrRW5kICsgY29tbWFuZCxcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIGRhdGFcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gcG9zdCBtdWx0aSBjb21tYW5kcyB0byBzZXJ2ZXJcclxuICAgICAgICB0aGlzLnBvc3RNdWx0aSA9ICgpID0+IHtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdjbGllbnRPcmRlckFkZEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICR3aW5kb3cpIHtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS50YWJzID0gW1xyXG4gICAgICAgICAgICAgICAgeyB0aXRsZTogJ0R5bmFtaWMgVGl0bGUgMScsIGNvbnRlbnQ6ICdEeW5hbWljIGNvbnRlbnQgMScgfSxcclxuICAgICAgICAgICAgICAgIHsgdGl0bGU6ICdEeW5hbWljIFRpdGxlIDInLCBjb250ZW50OiAnRHluYW1pYyBjb250ZW50IDInLCBkaXNhYmxlZDogdHJ1ZSB9XHJcbiAgICAgICAgICAgIF07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUubW9kZWwgPSB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnVGFicydcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxufSkoKTtcclxuIiwiKCgpID0+IHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmZhY3RvcnkoJ2NsaWVudE9yZGVyJywgY2xpZW50T3JkZXIpO1xyXG5cclxuICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgY2xpZW50T3JkZXIuJGluamVjdCA9IFsnJHJlc291cmNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gY2xpZW50T3JkZXIoJHJlc291cmNlKSB7XHJcbiAgICAgICAgcmV0dXJuICRyZXNvdXJjZSgnd3MvY2xpZW50b3JkZXIvbGlzdCcsIHt9LCB7XHJcbiAgICAgICAgICAgIHF1ZXJ5OiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7fSxcclxuICAgICAgICAgICAgICAgIGlzQXJyYXk6IHRydWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoKCkgPT4ge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb21wb25lbnRzJylcclxuICAgICAgICAuY29udHJvbGxlcignQ29MaXN0Q3RybCcsIENvTGlzdEN0cmwpO1xyXG5cclxuICAgIENvTGlzdEN0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnY2xpZW50T3JkZXInLCAnbWFya2V0T3JkZXInXTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIENvTGlzdEN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCBjbGllbnRPcmRlciwgbWFya2V0T3JkZXIpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkQ2xpZW50T3JkZXJJZCA9IFwiXCI7XHJcblxyXG4gICAgICAgICRzY29wZS5zZWxlY3RDbGllbnRPcmRlciA9IGlkID0+IHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZENsaWVudE9yZGVySWQgPT0gaWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jbG9zZU1hcmtldE9yZGVyTGlzdChpZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRDbGllbnRPcmRlcklkID0gJHNjb3BlLnNlbGVjdGVkQ2xpZW50T3JkZXJJZCA9PSBpZCA/IFwiXCIgOiBpZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLmNsb3NlTWFya2V0T3JkZXJMaXN0ID0gaWQgPT4ge1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRDbGllbnRPcmRlcklkID0gXCJcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gaW5pdFxyXG4gICAgICAgIGNsaWVudE9yZGVyLnF1ZXJ5KHt9LCByZXMgPT4ge1xyXG4gICAgICAgICAgICAkc2NvcGUuY2xpZW50T3JkZXJJdGVtcyA9IHJlcztcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoKCkgPT4ge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb21wb25lbnRzJylcclxuICAgICAgICAuZmFjdG9yeSgnY2xpZW50T3JkZXInLCBjbGllbnRPcmRlcik7XHJcblxyXG4gICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICBjbGllbnRPcmRlci4kaW5qZWN0ID0gWyckcmVzb3VyY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjbGllbnRPcmRlcigkcmVzb3VyY2UpIHtcclxuICAgICAgICByZXR1cm4gJHJlc291cmNlKCd3cy9jbGllbnRvcmRlci9saXN0Jywge30sIHtcclxuICAgICAgICAgICAgcXVlcnk6IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHt9LFxyXG4gICAgICAgICAgICAgICAgaXNBcnJheTogdHJ1ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdjb1BpZUN0cmwnLCBjb1BpZUN0cmwpO1xyXG5cclxuICAgIGNvUGllQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCAnJHdpbmRvdycsICckY29va2llcycsICckc3RhdGUnLCAnJGludGVydmFsJywgJ0FVVEhfRVZFTlRTJywgJ0NvbW1vblNlcnZpY2UnLCAnQXV0aFNlcnZpY2UnLCAnbWFya2V0T3JkZXInXTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIGNvUGllQ3RybChcclxuICAgICAgICAkc2NvcGUsXHJcbiAgICAgICAgJHJvb3RTY29wZSxcclxuICAgICAgICAkbG9jYXRpb24sXHJcbiAgICAgICAgJGh0dHAsXHJcbiAgICAgICAgJHdpbmRvdyxcclxuICAgICAgICAkY29va2llcyxcclxuICAgICAgICAkc3RhdGUsXHJcbiAgICAgICAgJGludGVydmFsLFxyXG4gICAgICAgIEFVVEhfRVZFTlRTLFxyXG4gICAgICAgIENvbW1vblNlcnZpY2UsXHJcbiAgICAgICAgQXV0aFNlcnZpY2UsXHJcbiAgICAgICAgbWFya2V0T3JkZXIpIHtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IG9wdGlvbiA9IHtcclxuICAgICAgICAgICAgdGl0bGU6IHtcclxuICAgICAgICAgICAgICAgIHRleHQ6ICdNYXJrZXQgT3JkZXIgUGllJyxcclxuICAgICAgICAgICAgICAgIHN1YnRleHQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgeDogJ2NlbnRlcidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9vbHRpcDoge1xyXG4gICAgICAgICAgICAgICAgdHJpZ2dlcjogJ2l0ZW0nLFxyXG4gICAgICAgICAgICAgICAgZm9ybWF0dGVyOiBcInthfSA8YnIvPntifSA6IHtjfSAoe2R9JSlcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsZWdlbmQ6IHtcclxuICAgICAgICAgICAgICAgIG9yaWVudDogJ3ZlcnRpY2FsJyxcclxuICAgICAgICAgICAgICAgIGxlZnQ6ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IFsnTllTRScsICdOQVNEQVEnLCAnU1NFJywgJ0hLU0UnLCAnU0dTRSddXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNlcmllczogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdFeGNoYW5nZScsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3BpZScsXHJcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiAnNTUlJyxcclxuICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IFsnNTAlJywgJzYwJSddLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogMzM1LCBuYW1lOiAnTllTRScgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogMzEwLCBuYW1lOiAnTkFTREFRJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHZhbHVlOiAyMzQsIG5hbWU6ICdTU0UnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdmFsdWU6IDEzNSwgbmFtZTogJ0hLU0UnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdmFsdWU6IDE1NDgsIG5hbWU6ICdTR1NFJyB9XHJcbiAgICAgICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgICAgICBpdGVtU3R5bGU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW1waGFzaXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYWRvd0JsdXI6IDEwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93T2Zmc2V0WDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYWRvd0NvbG9yOiAncmdiYSgwLCAwLCAwLCAwLjUpJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgbXlDaGFydCA9IGVjaGFydHMuaW5pdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpKTtcclxuICAgICAgICBteUNoYXJ0LnNldE9wdGlvbihvcHRpb24pO1xyXG5cclxuICAgIH1cclxufSkoKTtcclxuIiwiKCgpID0+IHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnY2xpZW50T3JkZXJQaWUnLCBjbGllbnRPcmRlclBpZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gY2xpZW50T3JkZXJQaWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGljb246IFwiQFwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnanMvY29tcG9uZW50cy9jbGllbnQtb3JkZXItcGllL2NsaWVudC1vcmRlci1waWUuaHRtbCcsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIlxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdtYXJrZXRPcmRlcicsIG1hcmtldE9yZGVyKTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIG1hcmtldE9yZGVyLiRpbmplY3QgPSBbJyRyZXNvdXJjZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1hcmtldE9yZGVyKCRyZXNvdXJjZSkge1xyXG4gICAgICAgIHJldHVybiAkcmVzb3VyY2UoJ3dzL21hcmtldG9yZGVyL2xpc3QvOmNvSWQnLCB7IGNvSWQ6ICdAY29JZCcgfSk7XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBMb2dpbkN0cmwpO1xyXG5cclxuICAgIExvZ2luQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCAnJHdpbmRvdycsICckY29va2llcycsICckc3RhdGUnLCAnQVVUSF9FVkVOVFMnLCAnQ29tbW9uU2VydmljZScsICdBdXRoU2VydmljZScsICdMb2dpbiddO1xyXG5cclxuICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgZnVuY3Rpb24gTG9naW5DdHJsKFxyXG4gICAgICAgICRzY29wZSxcclxuICAgICAgICAkcm9vdFNjb3BlLFxyXG4gICAgICAgICRsb2NhdGlvbixcclxuICAgICAgICAkaHR0cCxcclxuICAgICAgICAkd2luZG93LFxyXG4gICAgICAgICRjb29raWVzLFxyXG4gICAgICAgICRzdGF0ZSxcclxuICAgICAgICBBVVRIX0VWRU5UUyxcclxuICAgICAgICBDb21tb25TZXJ2aWNlLFxyXG4gICAgICAgIEF1dGhTZXJ2aWNlLFxyXG4gICAgICAgIExvZ2luKSB7XHJcblxyXG4gICAgICAgIC8vIFRPRE8gY2hlY2sgaWYgdXNlciBpcyBMb2dpblxyXG4gICAgICAgIGlmIChBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoQVVUSF9FVkVOVFMubG9naW5TdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAkc2NvcGUudXNlciA9IHt9O1xyXG5cclxuICAgICAgICAvLyAkc2NvcGUuYWxlcnRzID0gW11cclxuICAgICAgICAkc2NvcGUuQWxlcnRzID0ge1xyXG4gICAgICAgICAgICBpc1Nob3c6IGZhbHNlLFxyXG4gICAgICAgICAgICBhbGVydHM6IFtdLFxyXG4gICAgICAgICAgICBhZGQobXNnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFsZXJ0cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hbGVydHMucHVzaChtc2cpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjbG9zZShpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWxlcnRzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLmxvZ2luID0gdXNlciA9PiB7XHJcblxyXG4gICAgICAgICAgICBMb2dpbi5sb2dpbih1c2VyLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy50b2tlbiAhPSB1bmRlZmluZWQgJiYgcmVzLnRva2VuICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgQXV0aFNlcnZpY2UuY3JlYXRlVXNlckluZm8odXNlci51c2VybmFtZSwgcmVzLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlci51c2VybmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoQVVUSF9FVkVOVFMubG9naW5TdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuQWxlcnRzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5BbGVydHMuYWRkKHsgdHlwZTogXCJkYW5nZXJcIiwgbXNnOiAnTG9naW4gZmFpbGVkLiBQbGVhc2UgdHJ5IGFnYWluLicgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuQWxlcnRzLmFkZCh7IHR5cGU6IFwiZGFuZ2VyXCIsIG1zZzogcmVzLmRhdGEucmVhc29uIHx8IFwiTG9naW4gZmFpbGVkLlwiIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2xvZ2luUGFuZWwnLCBsb2dpblBhbmVsKTtcclxuXHJcbiAgICBsb2dpblBhbmVsLiRpbmplY3QgPSBbJyRjb21waWxlJ107XHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIGxvZ2luUGFuZWwoJGNvbXBpbGUpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZTogJ0AnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL2NvbXBvbmVudHMvbG9naW4tcGFuZWwvbG9naW4tcGFuZWwuaHRtbCcsXHJcbiAgICAgICAgICAgIGxpbmsoc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHNjb3BlLm5hbWUgPSBcImhlbFwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoKCkgPT4ge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb21wb25lbnRzJylcclxuICAgICAgICAuZmFjdG9yeSgnTG9naW4nLCBMb2dpbik7XHJcblxyXG4gICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICBMb2dpbi4kaW5qZWN0ID0gWyckcmVzb3VyY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBMb2dpbigkcmVzb3VyY2UpIHtcclxuICAgICAgICByZXR1cm4gJHJlc291cmNlKCd3cy9sb2dpbicsIHt9LCB7XHJcbiAgICAgICAgICAgIGxvZ2luOiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgIHBhcmFtczoge30sXHJcbiAgICAgICAgICAgICAgICBpc0FycmF5OiBmYWxzZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdNb0xpc3RDdHJsJywgTW9MaXN0Q3RybCk7XHJcblxyXG4gICAgTW9MaXN0Q3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCAnJHdpbmRvdycsICckY29va2llcycsICckc3RhdGUnLCAnJGludGVydmFsJywgJ0FVVEhfRVZFTlRTJywgJ0NvbW1vblNlcnZpY2UnLCAnQXV0aFNlcnZpY2UnLCAnbWFya2V0T3JkZXInXTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIE1vTGlzdEN0cmwoXHJcbiAgICAgICAgJHNjb3BlLFxyXG4gICAgICAgICRyb290U2NvcGUsXHJcbiAgICAgICAgJGxvY2F0aW9uLFxyXG4gICAgICAgICRodHRwLFxyXG4gICAgICAgICR3aW5kb3csXHJcbiAgICAgICAgJGNvb2tpZXMsXHJcbiAgICAgICAgJHN0YXRlLFxyXG4gICAgICAgICRpbnRlcnZhbCxcclxuICAgICAgICBBVVRIX0VWRU5UUyxcclxuICAgICAgICBDb21tb25TZXJ2aWNlLFxyXG4gICAgICAgIEF1dGhTZXJ2aWNlLFxyXG4gICAgICAgIG1hcmtldE9yZGVyKSB7XHJcblxyXG4gICAgICAgIC8vICRpbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgLy8gICAgIGlmICgkcm9vdFNjb3BlLnNlbGVjdGVkQ2xpZW50T3JkZXJJZCAhPSAnJyAmJiAkcm9vdFNjb3BlLnNlbGVjdGVkQ2xpZW50T3JkZXJJZCAhPSB1bmRlZmluZWQgJiYgQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpIHtcclxuICAgICAgICAvLyAgICAgICAgIG1hcmtldE9yZGVyLnF1ZXJ5KHsgY29JZDogJHJvb3RTY29wZS5zZWxlY3RlZENsaWVudE9yZGVySWQgfSwgcmVzID0+IHtcclxuICAgICAgICAvLyAgICAgICAgICAgICAkc2NvcGUubWFya2V0T3JkZXJMaXN0ID0gcmVzO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcylcclxuICAgICAgICAvLyAgICAgICAgIH0pO1xyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gfSwgMTAwMCk7XHJcblxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoKCkgPT4ge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb21wb25lbnRzJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdtYXJrZXRPcmRlckxpc3QnLCBtYXJrZXRPcmRlckxpc3QpO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1hcmtldE9yZGVyTGlzdCgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgaWNvbjogXCJAXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdqcy9jb21wb25lbnRzL21hcmtldC1vcmRlci1saXN0L21hcmtldC1vcmRlci1saXN0Lmh0bWwnLFxyXG4gICAgICAgICAgICByZXN0cmljdDogXCJFXCJcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoKCkgPT4ge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb21wb25lbnRzJylcclxuICAgICAgICAuZmFjdG9yeSgnbWFya2V0T3JkZXInLCBtYXJrZXRPcmRlcik7XHJcblxyXG4gICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICBtYXJrZXRPcmRlci4kaW5qZWN0ID0gWyckcmVzb3VyY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYXJrZXRPcmRlcigkcmVzb3VyY2UpIHtcclxuICAgICAgICByZXR1cm4gJHJlc291cmNlKCd3cy9tYXJrZXRvcmRlci9saXN0Lzpjb0lkJywgeyBjb0lkOiAnQGNvSWQnIH0pO1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIvKipcclxuICogQGF1dGhvciBTaGF3blxyXG4gKiBAZGVzYyBDb250cm9sbGVycyBvZiB0aGUgbWFpbkFQUFxyXG4gKi9cclxuKCgpID0+IHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3Rlc3RDdHJsJywgdGVzdEN0cmwpO1xyXG5cclxuICAgIHRlc3RDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckaHR0cCcsICdBVVRIX0VWRU5UUycsICdBdXRoU2VydmljZSddO1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiB0ZXN0Q3RybCgkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJGh0dHAsIEFVVEhfRVZFTlRTLCBBdXRoU2VydmljZSkge1xyXG4gICAgICAgICRzY29wZS5vYmogPSB7XHJcbiAgICAgICAgICAgIHVybDogXCJ1c2VyL2xvZ2luLmRvXCIsXHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIGRhdGE6IFwiXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS50ZXN0ID0gb2JqID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYWEgPSAoSlNPTi5wYXJzZShvYmouZGF0YSkpO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0ge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0OiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgbXNnOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgY29udGVudDogXCJcIlxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICB1cmw6IG9iai51cmwsXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6IG9iai5tZXRob2QsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBzZXJpYWxpemVEYXRhKGFhKVxyXG4gICAgICAgICAgICB9KS50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc3VsdC5yZXN1bHQgPSBcIlJlcSBTdWNjZXNzXCI7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0gcmVzO1xyXG4gICAgICAgICAgICB9LCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSByZXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0LnJlc3VsdCA9IFwiUmVxIEZhaWxcIjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIvKipcclxuICogQGF1dGhvciBTaGF3blxyXG4gKiBAZGVzYyBDb250cm9sbGVycyBvZiB0aGUgbWFpbkFQUFxyXG4gKi9cclxuXHJcbigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCd0ZXN0Q3RybCcsIHRlc3RDdHJsKTtcclxuXHJcbiAgICB0ZXN0Q3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCAnQVVUSF9FVkVOVFMnLCAnQXV0aFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiB0ZXN0Q3RybCgkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJGh0dHAsIEFVVEhfRVZFTlRTLCBBdXRoU2VydmljZSkge1xyXG4gICAgICAgICRzY29wZS5vYmogPSB7XHJcbiAgICAgICAgICAgIHVybDogXCJ1c2VyL2xvZ2luLmRvXCIsXHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIGRhdGE6IFwiXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS50ZXN0ID0gb2JqID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYWEgPSAoSlNPTi5wYXJzZShvYmouZGF0YSkpO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0ge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0OiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgbXNnOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgY29udGVudDogXCJcIlxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICB1cmw6IG9iai51cmwsXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6IG9iai5tZXRob2QsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBzZXJpYWxpemVEYXRhKGFhKVxyXG4gICAgICAgICAgICB9KS50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc3VsdC5yZXN1bHQgPSBcIlJlcSBTdWNjZXNzXCI7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0gcmVzO1xyXG4gICAgICAgICAgICB9LCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSByZXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0LnJlc3VsdCA9IFwiUmVxIEZhaWxcIjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIvKipcclxuICogQGF1dGhvciBTaGF3blxyXG4gKiBAZGVzYyBDb250cm9sbGVycyBvZiB0aGUgbWFpbkFQUFxyXG4gKi9cclxuKCgpID0+IHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3VzZXJDdHJsJywgdXNlckN0cmwpO1xyXG5cclxuICAgIHVzZXJDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICdBVVRIX0VWRU5UUycsICdBdXRoU2VydmljZSddO1xyXG4gICAgZnVuY3Rpb24gdXNlckN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIEFVVEhfRVZFTlRTLCBBdXRoU2VydmljZSkge1xyXG4gICAgICAgICRzY29wZS4kb24oQVVUSF9FVkVOVFMubG9nb3V0U3VjY2VzcywgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL1wiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKCFBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInVzZXIgbmVlZCBsb2dpblwiKTtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmxheW91dCcpXHJcbiAgICAgICAgLy8gZGFzaGJvYXJkIFNpZGViYXJcclxuICAgICAgICAuY29udHJvbGxlcihcIk1hc3RlckN0cmxcIiwgTWFzdGVyQ3RybCk7XHJcblxyXG4gICAgTWFzdGVyQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGNvb2tpZXNcIl07XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIE1hc3RlckN0cmwoJHNjb3BlLCAkY29va2llcykge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNpZGViYXIgVG9nZ2xlICYgQ29va2llcyBDb250cm9sXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY29uc3QgbW9iaWxlVmlldyA9IDk5MjtcclxuICAgICAgICAkc2NvcGUuZ2V0V2lkdGggPSAoKSA9PiB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCRzY29wZS5nZXRXaWR0aCwgKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAobmV3VmFsdWUgPj0gbW9iaWxlVmlldykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKCRjb29raWVzLmdldCgndG9nZ2xlJykpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZSA9ICEkY29va2llcy5nZXQoJ3RvZ2dsZScpID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG9nZ2xlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudG9nZ2xlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICRzY29wZS50b2dnbGVTaWRlYmFyID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlID0gISRzY29wZS50b2dnbGU7XHJcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgndG9nZ2xlJywgJHNjb3BlLnRvZ2dsZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB3aW5kb3cub25yZXNpemUgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpOyIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2Zvb3RlcicsIGZvb3Rlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gZm9vdGVyKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBpY29uOiBcIkBcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL2xheW91dC9mb290ZXIvZm9vdGVyLmh0bWwnLFxyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBRVwiXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcclxuIiwiKCgpID0+IHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAud2lkZ2V0cycpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0FsZXJ0c0N0cmwnLCBBbGVydHNDdHJsKTtcclxuXHJcbiAgICBBbGVydHNDdHJsLiRpbmplY3QgPSBbJyRzY29wZSddO1xyXG4gICAgZnVuY3Rpb24gQWxlcnRzQ3RybCgkc2NvcGUpIHtcclxuICAgICAgICAkc2NvcGUuYWxlcnRzID0gW3tcclxuICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgICAgICBtc2c6ICdUaGFua3MgZm9yIHZpc2l0aW5nISBGZWVsIGZyZWUgdG8gY3JlYXRlIHB1bGwgcmVxdWVzdHMgdG8gaW1wcm92ZSB0aGUgZGFzaGJvYXJkISdcclxuICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnZGFuZ2VyJyxcclxuICAgICAgICAgICAgICAgIG1zZzogJ0ZvdW5kIGEgYnVnPyBDcmVhdGUgYW4gaXNzdWUgd2l0aCBhcyBtYW55IGRldGFpbHMgYXMgeW91IGNhbi4nXHJcbiAgICAgICAgICAgIH1dO1xyXG5cclxuICAgICAgICAkc2NvcGUuYWRkQWxlcnQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICRzY29wZS5hbGVydHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBtc2c6ICdBbm90aGVyIGFsZXJ0ISdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmNsb3NlQWxlcnQgPSBpbmRleCA9PiB7XHJcbiAgICAgICAgICAgICRzY29wZS5hbGVydHMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpOyIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoXCJyZExvYWRpbmdcIiwgcmRMb2FkaW5nKTtcclxuXHJcbiAgICBmdW5jdGlvbiByZExvYWRpbmcoKSB7XHJcbiAgICAgICAgY29uc3QgZCA9IHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiQUVcIixcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwibG9hZGluZ1wiPjxkaXYgY2xhc3M9XCJkb3VibGUtYm91bmNlMVwiPjwvZGl2PjxkaXYgY2xhc3M9XCJkb3VibGUtYm91bmNlMlwiPjwvZGl2PjwvZGl2PidcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG5cclxuICAgICAgICAvLyBhbmd1bGFyLXVpIHByb2dyZXNzQmFyXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1Byb2dyZXNzRGVtb0N0cmwnLCBQcm9ncmVzc0RlbW9DdHJsKTtcclxuICAgIFByb2dyZXNzRGVtb0N0cmwuJGluamVjdCA9IFsnJHNjb3BlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gUHJvZ3Jlc3NEZW1vQ3RybCgkc2NvcGUpIHtcclxuICAgICAgICAkc2NvcGUubWF4ID0gMjAwO1xyXG5cclxuICAgICAgICAkc2NvcGUucmFuZG9tID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCArIDEpO1xyXG4gICAgICAgICAgICBsZXQgdHlwZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA8IDI1KSB7XHJcbiAgICAgICAgICAgICAgICB0eXBlID0gJ3dhcm5pbmcnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgNTApIHtcclxuICAgICAgICAgICAgICAgIHR5cGUgPSAnaW5mbyc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPCA3NSkge1xyXG4gICAgICAgICAgICAgICAgdHlwZSA9ICdzdWNjZXNzJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHR5cGUgPSAnc3VjY2Vzcyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zaG93V2FybmluZyA9IHR5cGUgPT09ICdkYW5nZXInIHx8IHR5cGUgPT09ICd3YXJuaW5nJztcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5keW5hbWljID0gdmFsdWU7XHJcbiAgICAgICAgICAgICRzY29wZS50eXBlID0gdHlwZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUucmFuZG9tKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgJHNjb3BlLnJhbmRvbVN0YWNrZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnN0YWNrZWQgPSBbXTtcclxuICAgICAgICAgICAgdmFyIHR5cGVzID0gWydzdWNjZXNzJywgJ2luZm8nLCAnd2FybmluZycsICdkYW5nZXInXTtcclxuXHJcbiAgICAgICAgICAgIC8vIGZvciAodmFyIGkgPSAwLCBuID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNCArIDEpOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIC8vICAgICB2YXIgaW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KTtcclxuICAgICAgICAgICAgLy8gICAgICRzY29wZS5zdGFja2VkLnB1c2goe1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHZhbHVlOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzMCArIDEpLFxyXG4gICAgICAgICAgICAvLyAgICAgICAgIHR5cGU6IHR5cGVzW2luZGV4XVxyXG4gICAgICAgICAgICAvLyAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUucmFuZG9tU3RhY2tlZCgpO1xyXG4gICAgfVxyXG59KSgpOyIsIigoKSA9PiB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG4gICAgICAgIC8vIGFuZ3VsYXItdWkgTW9kYWxcclxuICAgICAgICAuY29udHJvbGxlcignTW9kYWxEZW1vQ3RybCcsIE1vZGFsRGVtb0N0cmwpO1xyXG5cclxuICAgIE1vZGFsRGVtb0N0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJyR1aWJNb2RhbCcsICckbG9nJ107XHJcbiAgICBmdW5jdGlvbiBNb2RhbERlbW9DdHJsKCRzY29wZSwgJHVpYk1vZGFsLCAkbG9nKSB7XHJcbiAgICAgICAgJHNjb3BlLml0ZW1zID0gWydpdGVtMScsICdpdGVtMicsICdpdGVtMyddO1xyXG4gICAgICAgICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgJHNjb3BlLm9wZW4gPSBzaXplID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdteU1vZGFsQ29udGVudC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNb2RhbEluc3RhbmNlQ3RybCcsXHJcbiAgICAgICAgICAgICAgICBzaXplLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKHNlbGVjdGVkSXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07XHJcbiAgICAgICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgICAgICAgICRsb2cuaW5mbyhgTW9kYWwgZGlzbWlzc2VkIGF0OiAke25ldyBEYXRlKCl9YCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnRvZ2dsZUFuaW1hdGlvbiA9ICgpID0+IHtcclxuICAgICAgICAgICAgJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkID0gISRzY29wZS5hbmltYXRpb25zRW5hYmxlZDtcclxuICAgICAgICB9O1xyXG5cclxuICAgIH1cclxufSkoKTtcclxuIiwiKCgpID0+IHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAud2lkZ2V0cycpXHJcblxyXG4gICAgICAgIC8vIFBsZWFzZSBub3RlIHRoYXQgJHVpYk1vZGFsSW5zdGFuY2UgcmVwcmVzZW50cyBhIG1vZGFsIHdpbmRvdyAoaW5zdGFuY2UpIGRlcGVuZGVuY3kuXHJcbiAgICAgICAgLy8gSXQgaXMgbm90IHRoZSBzYW1lIGFzIHRoZSAkdWliTW9kYWwgc2VydmljZSB1c2VkIGFib3ZlLlxyXG4gICAgICAgIC8vIGFuZ3VsYXItdWkgTW9kYWxcclxuICAgICAgICAuY29udHJvbGxlcignTW9kYWxJbnN0YW5jZUN0cmwnLCBNb2RhbEluc3RhbmNlQ3RybCk7XHJcblxyXG4gICAgTW9kYWxJbnN0YW5jZUN0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2l0ZW1zJ107XHJcbiAgICBmdW5jdGlvbiBNb2RhbEluc3RhbmNlQ3RybCgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBpdGVtcykge1xyXG4gICAgICAgICRzY29wZS5pdGVtcyA9IGl0ZW1zO1xyXG4gICAgICAgICRzY29wZS5zZWxlY3RlZCA9IHtcclxuICAgICAgICAgICAgaXRlbTogJHNjb3BlLml0ZW1zWzBdXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLm9rID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuc2VsZWN0ZWQuaXRlbSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmNhbmNlbCA9ICgpID0+IHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTsiLCIoKCkgPT4ge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC53aWRnZXRzJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdyZFdpZGdldCcsIHJkV2lkZ2V0KTtcclxuXHJcbiAgICBmdW5jdGlvbiByZFdpZGdldCgpIHtcclxuICAgICAgICBjb25zdCBkaXJlY3RpdmUgPSB7XHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIndpZGdldFwiIG5nLXRyYW5zY2x1ZGU+PC9kaXY+JyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQSdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIC8qICovXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoKCkgPT4ge1xyXG4gICAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG4gICAgLmRpcmVjdGl2ZShcInJkV2lkZ2V0Qm9keVwiLCByZFdpZGdldEJvZHkpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHJkV2lkZ2V0Qm9keSgpIHtcclxuICAgICAgICBjb25zdCBkID0ge1xyXG4gICAgICAgICAgICByZXF1aXJlczogXCJecmRXaWRnZXRcIixcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGxvYWRpbmc6IFwiQD9cIixcclxuICAgICAgICAgICAgICAgIGNsYXNzZXM6IFwiQD9cIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiAhMCxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwid2lkZ2V0LWJvZHlcIiBuZy1jbGFzcz1cImNsYXNzZXNcIj48cmQtbG9hZGluZyBuZy1zaG93PVwibG9hZGluZ1wiPjwvcmQtbG9hZGluZz48ZGl2IG5nLWhpZGU9XCJsb2FkaW5nXCIgY2xhc3M9XCJ3aWRnZXQtY29udGVudFwiIG5nLXRyYW5zY2x1ZGU+PC9kaXY+PC9kaXY+JyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiRVwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZFxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoKCkgPT4ge1xyXG4gICAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG4gICAgLmRpcmVjdGl2ZShcInJkV2lkZ2V0Rm9vdGVyXCIsIHJkV2lkZ2V0Rm9vdGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiByZFdpZGdldEZvb3RlcigpIHtcclxuICAgICAgICBjb25zdCBlID0ge1xyXG4gICAgICAgICAgICByZXF1aXJlczogXCJecmRXaWRnZXRcIixcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogITAsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIndpZGdldC1mb290ZXJcIiBuZy10cmFuc2NsdWRlPjwvZGl2PicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGVcclxuICAgIH1cclxufSkoKTtcclxuIiwiKCgpID0+IHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAud2lkZ2V0cycpXHJcbiAgICAgICAgLmRpcmVjdGl2ZShcInJkV2lkZ2V0SGVhZGVyXCIsIHJkV2lkZ2V0VGl0bGUpO1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiByZFdpZGdldFRpdGxlKCkge1xyXG4gICAgICAgIGNvbnN0IGUgPSB7XHJcbiAgICAgICAgICAgIHJlcXVpcmVzOiBcIl5yZFdpZGdldFwiLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiQFwiLFxyXG4gICAgICAgICAgICAgICAgaWNvbjogXCJAXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogITAsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIndpZGdldC1oZWFkZXJcIj48aSBjbGFzcz1cImZhXCIgbmctY2xhc3M9XCJpY29uXCI+PC9pPiB7e3RpdGxlfX0gPGRpdiBjbGFzcz1cInB1bGwtcmlnaHRcIiBuZy10cmFuc2NsdWRlPjwvZGl2PjwvZGl2PicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGVcclxuICAgIH1cclxufSkoKTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
