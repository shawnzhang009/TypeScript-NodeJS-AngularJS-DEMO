(function() {
    'use strict';

    angular.module('mainApp', [
        'app.core',
        'app.layout',
        'app.components',
        'app.widgets'
    ]);

    angular.module('app.core', [
        'ui.router',
        'ui.bootstrap',
        'ui.layout',
        'ngResource',
        'ngCookies',
        'ngAnimate'
    ]);

    angular.module('app.widgets', [
        'app.core'
    ]);

    angular.module('app.components', [
        'app.core',
        'app.widgets'
    ]);

})();


// Sample: {addr.location:a,addr.number:b} ==> addr%5Blocation%5D=a&addr%5Bnumber%5D=b
serializeData = function(obj, prefix) {
    var str = [];
    for (var p in obj) {
        if (obj.constructor === Array) {
            console.log(obj);
            var k = prefix ? prefix + "[" + p + "]" : p,
                v = obj[p];
            str.push(typeof v == "object" ?
                serializeData(v, k) :
                encodeURIComponent(k) + "=" + encodeURIComponent(v));
        } else if (obj.hasOwnProperty(p)) {
            //   var k = prefix ? prefix + "[" + p + "]" : p, v = obj[p];
            var k = prefix ? prefix + "." + p : p,
                v = obj[p];
            str.push(typeof v == "object" ?
                serializeData(v, k) :
                encodeURIComponent(k) + "=" + encodeURIComponent(v));
        }
    }
    return str.join("&");
}

// Sample: 35% ==> 0.35
percentToNum = function(param) {
    param = param.toString().replace('%', '');
    if (param != undefined && isNaN(param) == false) {
        return param * 1000 / 100000;
    } else {
        return '';
    }
}

/**
*  Secure Hash Algorithm (SHA256)
*  http://www.webtoolkit.info/
*  Original code by Angel Marin, Paul Johnston.
**/
var SHA256 = function(s) {var chrsz = 8;var hexcase = 0;function safe_add(x, y) {var lsw = (x & 0xFFFF) + (y & 0xFFFF);var msw = (x >> 16) + (y >> 16) + (lsw >> 16);return (msw << 16) | (lsw & 0xFFFF);}function S(X, n) {return (X >>> n) | (X << (32 - n));}function R(X, n) {return (X >>> n);}function Ch(x, y, z) {return ((x & y) ^ ((~x) & z));}function Maj(x, y, z) {return ((x & y) ^ (x & z) ^ (y & z));}function Sigma0256(x) {return (S(x, 2) ^ S(x, 13) ^ S(x, 22));}function Sigma1256(x) {return (S(x, 6) ^ S(x, 11) ^ S(x, 25));}function Gamma0256(x) {return (S(x, 7) ^ S(x, 18) ^ R(x, 3));}function Gamma1256(x) {return (S(x, 17) ^ S(x, 19) ^ R(x, 10));}function core_sha256(m, l) {var K = new Array(0x428A2F98, 0x71374491, 0xB5C0FBCF, 0xE9B5DBA5, 0x3956C25B, 0x59F111F1, 0x923F82A4, 0xAB1C5ED5, 0xD807AA98, 0x12835B01, 0x243185BE, 0x550C7DC3, 0x72BE5D74, 0x80DEB1FE, 0x9BDC06A7, 0xC19BF174, 0xE49B69C1, 0xEFBE4786, 0xFC19DC6, 0x240CA1CC, 0x2DE92C6F, 0x4A7484AA, 0x5CB0A9DC, 0x76F988DA, 0x983E5152, 0xA831C66D, 0xB00327C8, 0xBF597FC7, 0xC6E00BF3, 0xD5A79147, 0x6CA6351, 0x14292967, 0x27B70A85, 0x2E1B2138, 0x4D2C6DFC, 0x53380D13, 0x650A7354, 0x766A0ABB, 0x81C2C92E, 0x92722C85, 0xA2BFE8A1, 0xA81A664B, 0xC24B8B70, 0xC76C51A3, 0xD192E819, 0xD6990624, 0xF40E3585, 0x106AA070, 0x19A4C116, 0x1E376C08, 0x2748774C, 0x34B0BCB5, 0x391C0CB3, 0x4ED8AA4A, 0x5B9CCA4F, 0x682E6FF3, 0x748F82EE, 0x78A5636F, 0x84C87814, 0x8CC70208, 0x90BEFFFA, 0xA4506CEB, 0xBEF9A3F7, 0xC67178F2);var HASH = new Array(0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19);var W = new Array(64);var a, b, c, d, e, f, g, h, i, j;var T1, T2;m[l >> 5] |= 0x80 << (24 - l % 32);m[((l + 64 >> 9) << 4) + 15] = l;for (var i = 0; i < m.length; i += 16) {a = HASH[0];b = HASH[1];c = HASH[2];d = HASH[3];e = HASH[4];f = HASH[5];g = HASH[6];h = HASH[7];for (var j = 0; j < 64; j++) {if (j < 16) W[j] = m[j + i];else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);T2 = safe_add(Sigma0256(a), Maj(a, b, c));h = g;g = f;f = e;e = safe_add(d, T1);d = c;c = b;b = a;a = safe_add(T1, T2);}HASH[0] = safe_add(a, HASH[0]);HASH[1] = safe_add(b, HASH[1]);HASH[2] = safe_add(c, HASH[2]);HASH[3] = safe_add(d, HASH[3]);HASH[4] = safe_add(e, HASH[4]);HASH[5] = safe_add(f, HASH[5]);HASH[6] = safe_add(g, HASH[6]);HASH[7] = safe_add(h, HASH[7]);}return HASH;}function str2binb(str) {var bin = Array();var mask = (1 << chrsz) - 1;for (var i = 0; i < str.length * chrsz; i += chrsz) {bin[i >> 5] |= (str.charCodeAt(i / chrsz) & mask) << (24 - i % 32);}return bin;}function Utf8Encode(string) {string = string.replace(/rn/g, "n");var utftext = "";for (var n = 0; n < string.length; n++) {var c = string.charCodeAt(n);if (c < 128) {utftext += String.fromCharCode(c);} else if ((c > 127) && (c < 2048)) {utftext += String.fromCharCode((c >> 6) | 192);utftext += String.fromCharCode((c & 63) | 128);} else {utftext += String.fromCharCode((c >> 12) | 224);utftext += String.fromCharCode(((c >> 6) & 63) | 128);utftext += String.fromCharCode((c & 63) | 128);}}return utftext;}function binb2hex(binarray) {var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";var str = "";for (var i = 0; i < binarray.length * 4; i++) {str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) + hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);}return str;}s = Utf8Encode(s);return binb2hex(core_sha256(str2binb(s), s.length * chrsz));}

/**
*  Secure Hash Algorithm (SHA1)
*  http://www.webtoolkit.info/
**/
var SHA1 = function(msg) {function rotate_left(n,s) {var t4 = ( n<<s ) | (n>>>(32-s));return t4;};function lsb_hex(val) {var str="";var i;var vh;var vl;for( i=0; i<=6; i+=2 ) {vh = (val>>>(i*4+4))&0x0f;vl = (val>>>(i*4))&0x0f;str += vh.toString(16) + vl.toString(16);}return str;};function cvt_hex(val) {var str="";var i;var v;for( i=7; i>=0; i-- ) {v = (val>>>(i*4))&0x0f;str += v.toString(16);}return str;};function Utf8Encode(string) {string = string.replace(/rn/g,"n");var utftext = "";for (var n = 0; n < string.length; n++) {var c = string.charCodeAt(n);if (c < 128) {utftext += String.fromCharCode(c);}else if((c > 127) && (c < 2048)) {utftext += String.fromCharCode((c >> 6) | 192);utftext += String.fromCharCode((c & 63) | 128);}else {utftext += String.fromCharCode((c >> 12) | 224);utftext += String.fromCharCode(((c >> 6) & 63) | 128);utftext += String.fromCharCode((c & 63) | 128);}}return utftext;};var blockstart;var i, j;var W = new Array(80);var H0 = 0x67452301;var H1 = 0xEFCDAB89;var H2 = 0x98BADCFE;var H3 = 0x10325476;var H4 = 0xC3D2E1F0;var A, B, C, D, E;var temp;msg = Utf8Encode(msg);var msg_len = msg.length;var word_array = new Array();for( i=0; i<msg_len-3; i+=4 ) {j = msg.charCodeAt(i)<<24 | msg.charCodeAt(i+1)<<16 |msg.charCodeAt(i+2)<<8 | msg.charCodeAt(i+3);word_array.push( j );}switch( msg_len % 4 ) {case 0:i = 0x080000000;break;case 1:i = msg.charCodeAt(msg_len-1)<<24 | 0x0800000;break;case 2:i = msg.charCodeAt(msg_len-2)<<24 | msg.charCodeAt(msg_len-1)<<16 | 0x08000;break;case 3:i = msg.charCodeAt(msg_len-3)<<24 | msg.charCodeAt(msg_len-2)<<16 | msg.charCodeAt(msg_len-1)<<8 | 0x80;break;}word_array.push( i );while( (word_array.length % 16) != 14 ) word_array.push( 0 );word_array.push( msg_len>>>29 );word_array.push( (msg_len<<3)&0x0ffffffff );for ( blockstart=0; blockstart<word_array.length; blockstart+=16 ) {for( i=0; i<16; i++ ) W[i] = word_array[blockstart+i];for( i=16; i<=79; i++ ) W[i] = rotate_left(W[i-3] ^ W[i-8] ^ W[i-14] ^ W[i-16], 1);A = H0;B = H1;C = H2;D = H3;E = H4;for( i= 0; i<=19; i++ ) {temp = (rotate_left(A,5) + ((B&C) | (~B&D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}for( i=20; i<=39; i++ ) {temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}for( i=40; i<=59; i++ ) {temp = (rotate_left(A,5) + ((B&C) | (B&D) | (C&D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}for( i=60; i<=79; i++ ) {temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}H0 = (H0 + A) & 0x0ffffffff;H1 = (H1 + B) & 0x0ffffffff;H2 = (H2 + C) & 0x0ffffffff;H3 = (H3 + D) & 0x0ffffffff;H4 = (H4 + E) & 0x0ffffffff;}var temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);return temp.toLowerCase();}


// Grab the files and set them to our variable
// ========================================================================================
// <input id="fileupload" type="file" class="" name="files[]" data-url="upload.do" multiple>
function prepareUpload(event) {
    var ele = $(this).siblings('.hidden')[0];
    uploadFiles(event.target.files, ele);

    // ele.value = resFileId;
    //
    // try {
    //     var resFileId = uploadFiles(event.target.files);
    //     var ele = $(this).siblings('.hidden')[0].value;
    //     var array = ele == ""? [] : ele.split(',') ;
    // } catch (e) {
    //     console.log(e);
    // } finally {
    //     console.log(array);
    //     array.push(resFileId);
    //     console.log(array);
    //     ele.value = array.join(',')).trigger('input';
    // }

    // ele.val(ele.val().split(',').push(resId).join(',')).trigger('input');

    // $(this).siblings('.hidden').val(uploadFiles(event.target.files)).trigger('input');
}


/**
 * @param files 需要上传的文件
 * @param ele 上传成功后接收返回文件ID的元素
 * @desc 文件上传模块, 设置返回id后，使用trigger('input')使ng-model能收到值
 */
function uploadFiles(files, ele) {
    // Create a formdata object and add the files
    var data = new FormData();
    $.each(files, function(key, value) {
        data.append("files", value);
    });

    console.log(files)

    $.ajax({
        url: 'upload.do',
        type: 'POST',
        data: data,
        cache: false,
        dataType: 'json',
        processData: false, // Don't process the files
        contentType: false, // Set content type to false as jQuery will tell the server its a query string request
        success: function(data, textStatus, jqXHR) {
            if (typeof data.error === 'undefined') {
                // Success so call function to process the form
                fileid = data.content.name;
                ele.value = data.content.name;
                $(ele).trigger('input');
                // submitForm(event, data);
            } else {
                // Handle errors here
                console.log('ERRORS: ' + data.error);
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // Handle errors here
            console.log('ERRORS: ' + textStatus);
            // STOP LOADING SPINNER
        }
    });
}


/**
 * @author Shawn
 * @desc mainAPP
 */
(function() {
    'use strict';

    angular
        .module('app.core')
        // Global
        .constant('WEB_INFO', {
            title: 'Order Management System'
        })

        .constant('AUTH_EVENTS', {
            loginSuccess: 'auth-login-success',
            loginFailed: 'auth-login-failed',
            logoutSuccess: 'auth-logout-success',
            sessionTimeout: 'auth-session-timeout',
            notAuthenticated: 'auth-not-authenticated',
            pageNotFound: 'page-not-found',
            serverError: 'server-error'
        })

        // Do auth when state/url change
        .run(function($rootScope, AUTH_EVENTS, AuthService, Session) {
            $rootScope.$on('$stateChangeStart', function(event, next) {
                if (!AuthService.isAuthenticated()) {
                    $rootScope.$broadcast(AUTH_EVENTS.notAuthenticated);
                } else {
                    $rootScope.currentUser = Session.getUserName();
                }
            });
        })

})();

/**
 * @author Shawn
 * @desc The Root Controller of the mainAPP
 */
(function() {
    'use strict';

    angular
        .module('app.core')
        .controller('mainCtrl', mainCtrl);

    mainCtrl.$inject = ['$rootScope', '$scope', '$location', '$state', '$window', 'AuthService', 'AUTH_EVENTS', 'CommonService', 'Session'];

    function mainCtrl($rootScope, $scope, $location, $state, $window, AuthService, AUTH_EVENTS, CommonService, Session) {

        // if (!$window.sessionStorage.token) {
        //     $location.path('/login');
        //     console.log(1);
        // }

        // for test

        // $rootScope.moList = [];

        // $scope.orderItems = [];
        // for (var i = 0; i < 30; i++) {
        //     $scope.orderItems[i] = i;
        // }

        $rootScope.setCurrentUser = function(user) {
            $rootScope.currentUser = user;
        };

        // Log out
        $scope.logout = function() {
            // $window.sessionStorage.token = '';
            // Session.destroy();
            $rootScope.currentUser = null;
            $rootScope.$broadcast(AUTH_EVENTS.logoutSuccess);
            console.log('logout success');
            // AuthService.logout().then(function(res) {
            //     if (CommonService.isReqSuccess(res)) {
            //         $rootScope.$broadcast(AUTH_EVENTS.logoutSuccess);
            //         console.log('Log out success');
            //     } else {
            //         CommonService.handleResErr(res);
            //     }
            // }, function(res) {
            //     CommonService.handleHttpErr(res);
            // });
        }

        // Listening
        $scope.$on(AUTH_EVENTS.loginSuccess, function(event, data) {
            console.log("login success");
            $state.go('home.order');
        });

        $scope.$on(AUTH_EVENTS.loginFailed, function(event, data) {
            $window.sessionStorage.token = '';
            console.log("login failed");
            // $location.path('/');
        });

        $scope.$on(AUTH_EVENTS.logoutSuccess, function(event, data) {
            console.log('remove token');
            $window.sessionStorage.removeItem('token');
            console.log("login failed");
            // $location.path('/');
        });

        $scope.$on('method-not-allow', function(event, data) {
            console.log("method not allow");
            // $location.path('/');
        });

        $scope.$on(AUTH_EVENTS.pageNotFound, function(event, data) {
            console.log('404 error');
        });

        $scope.$on(AUTH_EVENTS.serverError, function(event, data) {
            console.log('500 error');
        });

    }
})();

(function() {
    'use strict';


})();

/**
 * @author Shawn
 * @desc mainAPP
 */
(function() {
    'use strict';
const PROJECTSTATUS = {
    0: "te",
    1: "2",
    2: "3",
    3: "r",
    4: "r",
    5: "fewf",
    6: "feaw"
};

/* filters */
var filters = angular.module('app.core')

.filter('switch', function() {
    return function(param) {
        if (param == 1 || param == '1') {
            return 'OPEN';
        } else {
            return 'CLOSED';
        }
    }
})

// 78 ===> 0.78
.filter('percent', function() {
    return function(param) {
        if (param != undefined && isNaN(param) == false) {
            return param * 1000 / 100000;
        } else {
            return '';
        }
    }
})

.filter('category', function() {
    var obj = CATEGORY;
    return function(param) {
        return obj[param] != undefined ? obj[param] : "";
    }
})

.filter('buildcompany', function() {
    var obj = BUILDCOMPANY;
    return function(param) {
        return obj[param] != undefined ? obj[param] : "";
    }
})

.filter('projectstatus', function() {
    var obj = PROJECTSTATUS;
    return function(param) {
        return obj[param] != undefined ? obj[param] : "";
    }
})
})();

/**
 * @author Shawn
 * @desc router of app.core
 */
(function() {
    'use strict';

    angular.module('app.core')

        .config(function($stateProvider, $httpProvider, $urlRouterProvider, $locationProvider) {

            // Interceptor of Requests
            $httpProvider.interceptors.push([
                '$injector',
                function($injector) {
                    return $injector.get('AuthInterceptor');
                }
            ]);

            $locationProvider.html5Mode({
                enabled: false,
                requireBase: false
            });

            // For any unmatched url, redirect to /
            $urlRouterProvider.otherwise('/login');


            // loginregister
            $stateProvider

                // main page
                .state('home', {
                    url: '/',
                    templateUrl: 'html/dashboard.html'
                })

                .state("home.dash1", {
                    url: "dash1",
                    templateUrl: "html/rdash/dashboard.html"
                }).state("home.order", {
                    url: "order",
                    templateUrl: "js/components/client-order-list/client-order-list.html"
                }).state("home.dash2", {
                    url: "dash2",
                    templateUrl: "html/rdash/tables.html"
                })

                .state('login', {
                    url: '/login',
                    templateUrl: 'html/login.html'
                }).state('register', {
                    url: '/register',
                    templateUrl: 'html/register.html'
                })

                // User Account
                .state('account', {
                    url: '/account',
                    templateUrl: 'html/account/account.html'
                }).state('account.me', {
                    url: '/me',
                    templateUrl: 'html/account/account.me.html'
                })

                // for test
                .state('test', {
                    url: '/test',
                    templateUrl: 'html/test-angular-ui-bootstrap.html',
                    controller: 'testCtrl'
                })
        });
})();

/**
 * @author Shawn
 * @desc Services of the mainAPP
 */

// For test
var commonTest = true;

(function() {
    'use strict';

    angular
        .module('app.core')
        .factory('AuthInterceptor', AuthInterceptor)
        .factory('Session', Session)
        .factory('CommonService', CommonService)
        .factory('AuthService', AuthService)
        .factory('registerService', registerService)
        .factory('userService', userService);

    Session.$inject = ['$cookies', '$window'];
    AuthInterceptor.$inject = ['$rootScope', '$q', '$window', 'AUTH_EVENTS'];
    AuthService.$inject = ['$http', '$rootScope', 'AUTH_EVENTS', '$window', 'CommonService'];
    CommonService.$inject = ['$http', 'Session'];
    registerService.$inject = ['$http', '$rootScope', 'CommonService'];
    userService.$inject = ['$http', '$rootScope', 'Session', 'CommonService'];


    function AuthInterceptor($rootScope, $q, $window, AUTH_EVENTS) {
        var service = {
            request: requestHandler,
            response: responseHandler,
            responseError: responseErrorHandler
        };
        return service;

        function requestHandler(config) {
            config.headers = config.headers || {};
            if ($window.sessionStorage.token) {
                config.headers['X-AuthToken'] = $window.sessionStorage.token;
            }
            return config;
        }

        function responseHandler(response) {
            // console.log(response)
            if (response.status === 401) {
                // handle the case where the user is not authenticated
            }
            return response || $q.when(response);
        }

        function responseErrorHandler(response) {
            // console.log(response);
            $rootScope.$broadcast({
                401: AUTH_EVENTS.notAuthenticated,
                403: AUTH_EVENTS.notAuthorized,
                405: 'method-not-allow',
                419: AUTH_EVENTS.sessionTimeout,
                440: AUTH_EVENTS.sessionTimeout,
                404: AUTH_EVENTS.pageNotFound,
                500: AUTH_EVENTS.serverError
            }[response.status], response);
            return $q.reject(response);
        }
    }


    function Session($cookies, $window) {
        var aName = "USERID";
        var bName = "SID";

        this.create = function(sessionId, userId) {
            $cookies.put(aName, userId);
            $cookies.put(bName, sessionId);
        }
        // this.create = function(sessionId, userId) {
        //     document.cookie = aName + '=' + userId;
        //     document.cookie = bName + '=' + sessionId;
        //     this.id = sessionId;
        //     this.userId = userId;
        // };

        this.get = function(name) {
            return $cookies.getObject(name);
            // if (document.cookie.length > 0) {
            //     var start = document.cookie.indexOf(name + "=");
            //     if (start != -1) {
            //         start = start + name.length + 1;
            //         var end = document.cookie.indexOf(";", start);
            //         if (end == -1) end = document.cookie.length;
            //         return unescape(document.cookie.substring(start, end));
            //     }
            // }
            // return "";
        };
        this.getUserName = function() {
            return this.get(aName);
        };
        this.getSessionId = function() {
            return this.get(bName);
        };
        this.getObj = function() {
            return {
                'accountname': this.get(aName),
                'sessionid': this.get(bName)
            }
        };
        this.destroy = function() {
            $window.sessionStorage.removeItem('token');
            // document.cookie = aName + '=';
            // document.cookie = bName + '=';
            // this.id = null;
            // this.userId = null;
        };
        return this;
    }


    // Global Services
    function CommonService($http, Session) {
        // Set Content-Type to form-data which back-end can accept
        // $http.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';

        var urlBackEnd = 'http://lofewfcalhost:8080/ws/';
        // var urlBackEnd = 'http://10.22.16.124:8088/ws/marketorder/getByClientOrderId/';
        var urlMiddleEnd = 'https://ExampleURL.92/';

        // requests status handle
        this.isReqSuccess = function(res) {
            console.log(res);
            return res.data.errCode == 0 ? true : false;
        };

        // handle Http error
        this.handleHttpErr = function(res) {
            console.log('Req Error', res);
        };

        // handle response error (base on API)
        this.handleResErr = function(res) {
            console.log(res);
            if (res.data.errDesc == undefined) {
                console.log('Error without discription');
                console.log('msg: ' + res.errDesc);
            } else {
                alert(res.data.errDesc);
                console.log(res.data);
            }
        };

        // post single command to back-end server
        this.post = function(command, data) {
            // Request parameters structure
            // var data111 = $.extend({
            //     "command": command
            // }, Session.getObj(), data);

            // console.log(angular.toJson(data));
            return commonTest ? $http({
                url: 'test-data/ws/' + command,
                method: 'GET'
            }) : $http({
                url: urlBackEnd + command,
                method: 'POST',
                data: data
            })
        };

        // post multi commands to server
        this.postMulti = function() {

        };

        return this;
    }


    function AuthService($http, $rootScope, AUTH_EVENTS, $window, CommonService) {

        var authService = {};

        authService.login = function(user) {
            return CommonService.post("login", user);
        };

        authService.logout = function() {
            return CommonService.post("logout");
        };

        // is session avalid
        authService.isAuthenticated = function() {
            console.log('isAuthenticated: ' + !!$window.sessionStorage.token);
            return !!$window.sessionStorage.token;
        };

        return authService;
    }


    function registerService($http, $rootScope, CommonService) {
        var service = {};

        service.register = function(user) {
            return CommonService.post("register", user);
        };

        return service;
    }

    function userService($http, $rootScope, Session, CommonService) {
        var service = {};

        return service;
    }

})();

(function() {
    'use strict';

    angular.module('app.layout', [
        'app.core'
    ]);
})();


(function() {
    'use strict';

    angular
        .module('app.components')
        .controller('CoListCtrl', CoListCtrl);

    CoListCtrl.$inject = ['$scope', '$rootScope', 'clientOrder', 'marketOrder'];

    /* @ngInject */
    function CoListCtrl($scope, $rootScope, clientOrder, marketOrder) {

        $scope.selectCo = function(coId) {
             $rootScope.selectedClientOrderId = $rootScope.selectedClientOrderId == coId ? "" : coId;
        }

        // init
        clientOrder.query({}, function(res) {
            $scope.clientOrderItems = res;
        });

    }

})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .factory('clientOrder', clientOrder);

    /* @ngInject */
    clientOrder.$inject = ['$resource'];

    function clientOrder($resource) {
        return $resource('ws/clientorder/list', {}, {
            query: {
                method: 'GET',
                params: {},
                isArray: true
            }
        });
    }

})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .controller('coPieCtrl', coPieCtrl);

    coPieCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', '$window', '$cookies', '$state', '$interval', 'AUTH_EVENTS', 'CommonService', 'Session', 'AuthService', 'marketOrder'];

    /* @ngInject */
    function coPieCtrl($scope, $rootScope, $location, $http, $window, $cookies, $state, $interval, AUTH_EVENTS, CommonService, Session, AuthService, marketOrder) {


        var option = {
            title: {
                text: 'Market Order Pie',
                subtext: '',
                x: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                data: ['NYSE', 'NASDAQ', 'SSE', 'HKSE', 'SGSE']
            },
            series: [
                {
                    name: 'Exchange',
                    type: 'pie',
                    radius: '55%',
                    center: ['50%', '60%'],
                    data: [
                        { value: 335, name: 'NYSE' },
                        { value: 310, name: 'NASDAQ' },
                        { value: 234, name: 'SSE' },
                        { value: 135, name: 'HKSE' },
                        { value: 1548, name: 'SGSE' }
                    ],
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };

        var myChart = echarts.init(document.getElementById('main'));
        myChart.setOption(option);

    }

})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .directive('coPie', coPie);

    function coPie() {
        return {
            scope: {
                icon: "@"
            },
            templateUrl: 'js/components/co-pie/co-pie.html',
            restrict: "E"
        };
    }


})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .factory('marketOrder', marketOrder);

    /* @ngInject */
    marketOrder.$inject = ['$resource'];

    function marketOrder($resource) {
        return $resource('ws/marketorder/list/:coId', { coId: '@coId' });
    }

})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .directive('footer', footer);

    function footer() {
        return {
            scope: {
                icon: "@"
            },
            templateUrl: 'js/components/footer/footer.html',
            restrict: "AE"
        };
    }

})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .controller('LoginCtrl', LoginCtrl);

    LoginCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', '$window', '$cookies', '$state', 'AUTH_EVENTS', 'CommonService', 'Session', 'AuthService', 'Login'];

    /* @ngInject */
    function LoginCtrl($scope, $rootScope, $location, $http, $window, $cookies, $state, AUTH_EVENTS, CommonService, Session, AuthService, Login) {

        // TODO check if user is Login
        if ($window.sessionStorage.token != undefined && $window.sessionStorage.token != '') {
            $rootScope.$broadcast(AUTH_EVENTS.loginSuccess);
        }


        $scope.user = {};

        // $scope.alerts = []
        $scope.Alerts = {
            isShow: false,
            alerts: [],
            add: function(msg) {
                this.isShow = true;
                this.alerts = [];
                this.alerts.push(msg);
            },
            close: function(index) {
                this.isShow = false;
                this.alerts.splice(index, 1);
            }
        };


        $scope.login = function(user) {

            Login.login(user, function(res) {
                if (res.token != undefined && res.token != '') {
                    $window.sessionStorage.token = res.token;
                    $rootScope.currentUser = user.username;
                    $rootScope.$broadcast(AUTH_EVENTS.loginSuccess);
                    $scope.Alerts.close();
                } else {
                    $scope.Alerts.add({ type: "danger", msg: 'Login failed. Please try again.' });
                }
            }, function(res) {
                $scope.Alerts.add({ type: "danger", msg: res.data.reason || "Login failed." });
            });

            console.log(user);
        };
    }

})();

(function() {
    'use strict';


    angular
        .module('app.components')
        .directive('loginPanel', loginPanel);

    loginPanel.$inject = ['$compile'];
    /* @ngInject */
    function loginPanel($compile) {
        return {
            restrict: 'E',
            scope: '@',
            templateUrl: 'js/components/login-panel/login-panel.html',
            link: function(scope) {
                // scope.name = "hel"
            }
        };
    }

})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .factory('Login', Login);

    /* @ngInject */
    Login.$inject = ['$resource'];

    function Login($resource) {
        return $resource('ws/login', {}, {
            login: {
                method: 'POST',
                params: {},
                isArray: false
            }
        });
    }

})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .controller('MoListCtrl', MoListCtrl);

    MoListCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', '$window', '$cookies', '$state', '$interval', 'AUTH_EVENTS', 'CommonService', 'Session', 'AuthService', 'marketOrder'];

    /* @ngInject */
    function MoListCtrl($scope, $rootScope, $location, $http, $window, $cookies, $state, $interval, AUTH_EVENTS, CommonService, Session, AuthService, marketOrder) {

        // console.log($rootScope.moList)
        // $scope.moList = [];
        $interval(function() {
            if ($rootScope.selectedClientOrderId != '' && $rootScope.selectedClientOrderId != undefined && AuthService.isAuthenticated()) {
                marketOrder.query({ coId: $rootScope.selectedClientOrderId }, function(res) {
                    $scope.moList = res;
                    console.log(res)
                });
            }
        }, 1000);

    }

})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .directive('marketOrderList', marketOrderList);

    function marketOrderList() {
        return {
            scope: {
                icon: "@"
            },
            templateUrl: 'js/components/market-order-list/market-order-list.html',
            restrict: "E"
        };
    }


})();

(function() {
    'use strict';

    angular
        .module('app.components')
        .factory('marketOrder', marketOrder);

    /* @ngInject */
    marketOrder.$inject = ['$resource'];

    function marketOrder($resource) {
        return $resource('ws/marketorder/list/:coId', { coId: '@coId' });
    }

})();

/**
 * @author Shawn
 * @desc Controllers of the mainAPP
 */
(function() {
    'use strict';

    angular
        .module('app.components')
        .controller('testCtrl', testCtrl);

    testCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', 'AUTH_EVENTS', 'AuthService'];


    function testCtrl($scope, $rootScope, $location, $http, AUTH_EVENTS, AuthService) {
        $scope.obj = {
            url: "user/login.do",
            method: "POST",
            data: ""
        };
        $scope.test = function(obj) {
            var aa = (JSON.parse(obj.data));
            $scope.result = {
                result: "",
                status: "",
                msg: "",
                content: ""
            };
            $http({
                url: obj.url,
                method: obj.method,
                data: serializeData(aa)
            }).then(function(res) {
                console.log(res);
                $scope.result.result = "Req Success";
                $scope.result = res;
            }, function(res) {
                console.log(res);
                $scope.result = res;
                $scope.result.result = "Req Fail";
            });
        }
    }
})();

/**
 * @author Shawn
 * @desc Controllers of the mainAPP
 */

(function() {
    'use strict';

    angular
        .module('app.components')
        .controller('testCtrl', testCtrl);

    testCtrl.$inject = ['$scope', '$rootScope', '$location', '$http', 'AUTH_EVENTS', 'AuthService'];

    function testCtrl($scope, $rootScope, $location, $http, AUTH_EVENTS, AuthService) {
        $scope.obj = {
            url: "user/login.do",
            method: "POST",
            data: ""
        };
        $scope.test = function(obj) {
            var aa = (JSON.parse(obj.data));
            $scope.result = {
                result: "",
                status: "",
                msg: "",
                content: ""
            };
            $http({
                url: obj.url,
                method: obj.method,
                data: serializeData(aa)
            }).then(function(res) {
                console.log(res);
                $scope.result.result = "Req Success";
                $scope.result = res;
            }, function(res) {
                console.log(res);
                $scope.result = res;
                $scope.result.result = "Req Fail";
            });
        }
    }
})();

/**
 * @author Shawn
 * @desc Controllers of the mainAPP
 */
(function() {
    'use strict';

    angular
        .module('app.components')
        .controller('userCtrl', userCtrl);

    userCtrl.$inject = ['$scope', '$rootScope', '$location', 'Session', 'AUTH_EVENTS', 'AuthService'];
    function userCtrl($scope, $rootScope, $location, Session, AUTH_EVENTS, AuthService) {
        $scope.$on(AUTH_EVENTS.logoutSuccess, function(event, data) {
            $location.path("/");
        });

        if (!AuthService.isAuthenticated()) {
            console.log("user need login");
            $location.path("/login");
        }
    }

})();
(function() {
    'use strict';

    angular.module('app.layout')
        // dashboard Sidebar
        .controller("MasterCtrl", MasterCtrl);

    MasterCtrl.$inject = ["$scope", "$cookies"];


    function MasterCtrl($scope, $cookies) {
        /**
         * Sidebar Toggle & Cookies Control
         */
        var mobileView = 992;
        $scope.getWidth = function() {
            return window.innerWidth;
        };
        $scope.$watch($scope.getWidth, function(newValue, oldValue) {
            if (newValue >= mobileView) {
                if (angular.isDefined($cookies.get('toggle'))) {
                    $scope.toggle = !$cookies.get('toggle') ? true : false;
                } else {
                    $scope.toggle = false;
                }
            } else {
                $scope.toggle = true;
            }
        });
        $scope.toggleSidebar = function() {
            $scope.toggle = !$scope.toggle;
            $cookies.put('toggle', $scope.toggle);
        };
        window.onresize = function() {
            $scope.$apply();
        };
    }


})();
(function() {
    'use strict';
    angular.module('app.widgets')
        .controller('AlertsCtrl', AlertsCtrl);

    AlertsCtrl.$inject = ['$scope'];
    function AlertsCtrl($scope) {
        $scope.alerts = [{
            type: 'success',
            msg: 'Thanks for visiting! Feel free to create pull requests to improve the dashboard!'
        }, {
                type: 'danger',
                msg: 'Found a bug? Create an issue with as many details as you can.'
            }];

        $scope.addAlert = function() {
            $scope.alerts.push({
                msg: 'Another alert!'
            });
        };

        $scope.closeAlert = function(index) {
            $scope.alerts.splice(index, 1);
        };
    }
})();
(function() {
    'use strict';
    angular
        .module('app.widgets')
        .directive("rdLoading", rdLoading);

    function rdLoading() {
        var d = {
            restrict: "AE",
            template: '<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'
        };
        return d
    }

})();

(function() {
    'use strict';

    angular
        .module('app.widgets')
        // angular-ui Modal
        .controller('ModalDemoCtrl', ModalDemoCtrl);

    ModalDemoCtrl.$inject = ['$scope', '$uibModal', '$log'];
    function ModalDemoCtrl($scope, $uibModal, $log) {
        $scope.items = ['item1', 'item2', 'item3'];
        $scope.animationsEnabled = true;
        $scope.open = function(size) {
            var modalInstance = $uibModal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'myModalContent.html',
                controller: 'ModalInstanceCtrl',
                size: size,
                resolve: {
                    items: function() {
                        return $scope.items;
                    }
                }
            });

            modalInstance.result.then(function(selectedItem) {
                $scope.selected = selectedItem;
            }, function() {
                $log.info('Modal dismissed at: ' + new Date());
            });
        };
        $scope.toggleAnimation = function() {
            $scope.animationsEnabled = !$scope.animationsEnabled;
        };

    }
})();

(function() {
    'use strict';

    angular
        .module('app.widgets')

        // Please note that $uibModalInstance represents a modal window (instance) dependency.
        // It is not the same as the $uibModal service used above.
        // angular-ui Modal
        .controller('ModalInstanceCtrl', ModalInstanceCtrl);

    ModalInstanceCtrl.$inject = ['$scope', '$uibModalInstance', 'items'];
    function ModalInstanceCtrl($scope, $uibModalInstance, items) {
        $scope.items = items;
        $scope.selected = {
            item: $scope.items[0]
        };

        $scope.ok = function() {
            $uibModalInstance.close($scope.selected.item);
        };

        $scope.cancel = function() {
            $uibModalInstance.dismiss('cancel');
        };
    }

})();
(function() {
    'use strict';


    angular
        .module('app.widgets')
        .directive('rdWidget', rdWidget);

    function rdWidget() {
        var directive = {
            transclude: true,
            template: '<div class="widget" ng-transclude></div>',
            restrict: 'EA'
        };
        return directive;

        function link(scope, element, attrs) {
            /* */
        }
    };

})();


(function() {
    'use strict';

    angular.module('app.widgets')

        // angular-ui progressBar
        .controller('ProgressDemoCtrl', ProgressDemoCtrl);
    ProgressDemoCtrl.$inject = ['$scope'];

    function ProgressDemoCtrl($scope) {
        $scope.max = 200;

        $scope.random = function() {
            var value = Math.floor(Math.random() * 100 + 1);
            var type;

            if (value < 25) {
                type = 'warning';
            } else if (value < 50) {
                type = 'info';
            } else if (value < 75) {
                type = 'success';
            } else {
                type = 'success';
            }

            $scope.showWarning = type === 'danger' || type === 'warning';

            $scope.dynamic = value;
            $scope.type = type;
        };

        $scope.random();

        $scope.randomStacked = function() {
            $scope.stacked = [];
            var types = ['success', 'info', 'warning', 'danger'];

            for (var i = 0, n = Math.floor(Math.random() * 4 + 1); i < n; i++) {
                var index = Math.floor(Math.random() * 4);
                $scope.stacked.push({
                    value: Math.floor(Math.random() * 30 + 1),
                    type: types[index]
                });
            }
        };

        $scope.randomStacked();
    }
})();
(function() {
    'use strict';

    angular
    .module('app.widgets')
    .directive("rdWidgetBody", rdWidgetBody);
    
    function rdWidgetBody() {
        var d = {
            requires: "^rdWidget",
            scope: {
                loading: "@?",
                classes: "@?"
            },
            transclude: !0,
            template: '<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',
            restrict: "E"
        };
        return d
    }

})();

(function() {
    'use strict';
    angular
    .module('app.widgets')
    .directive("rdWidgetFooter", rdWidgetFooter);

    function rdWidgetFooter() {
        var e = {
            requires: "^rdWidget",
            transclude: !0,
            template: '<div class="widget-footer" ng-transclude></div>',
            restrict: "E"
        };
        return e
    }


})();

(function() {
    'use strict';

    angular
        .module('app.widgets')
        .directive("rdWidgetHeader", rdWidgetTitle);


    function rdWidgetTitle() {
        var e = {
            requires: "^rdWidget",
            scope: {
                title: "@",
                icon: "@"
            },
            transclude: !0,
            template: '<div class="widget-header"><i class="fa" ng-class="icon"></i> {{title}} <div class="pull-right" ng-transclude></div></div>',
            restrict: "E"
        };
        return e
    }

})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJ0b29sa2l0LmpzIiwiY29tcG9uZW50cy9jb21wb25lbnRzLm1vZHVsZS5qcyIsImNvcmUvY29yZS5jb25maWcuanMiLCJjb3JlL2NvcmUuY29udHJvbGxlcnMuanMiLCJjb3JlL2NvcmUuZGlyZWN0aXZlcy5qcyIsImNvcmUvY29yZS5maWx0ZXJzLmpzIiwiY29yZS9jb3JlLm1vZHVsZS5qcyIsImNvcmUvY29yZS5yb3V0ZXIuanMiLCJjb3JlL2NvcmUuc2VydmljZS5qcyIsImxheW91dC9sYXlvdXQubW9kdWxlLmpzIiwid2lkZ2V0cy93aWRnZXRzLm1vZHVsZS5qcyIsImNvbXBvbmVudHMvY2xpZW50LW9yZGVyLWxpc3QvY2xpZW50LW9yZGVyLWxpc3QuY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvY2xpZW50LW9yZGVyLWxpc3QvY2xpZW50LW9yZGVyLWxpc3Quc2VydmljZS5qcyIsImNvbXBvbmVudHMvY28tcGllL2NvLXBpZS5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9jby1waWUvY28tcGllLmRpcmVjdGl2ZS5qcyIsImNvbXBvbmVudHMvY28tcGllL2NvLXBpZS5zZXJ2aWNlLmpzIiwiY29tcG9uZW50cy9mb290ZXIvZm9vdGVyLmRpcmVjdGl2ZS5qcyIsImNvbXBvbmVudHMvbG9naW4tcGFuZWwvbG9naW4tcGFuZWwuY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvbG9naW4tcGFuZWwvbG9naW4tcGFuZWwuZGlyZWN0aXZlLmpzIiwiY29tcG9uZW50cy9sb2dpbi1wYW5lbC9sb2dpbi1wYW5lbC5zZXJ2aWNlLmpzIiwiY29tcG9uZW50cy9tYXJrZXQtb3JkZXItbGlzdC9tYXJrZXQtb3JkZXItbGlzdC5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9tYXJrZXQtb3JkZXItbGlzdC9tYXJrZXQtb3JkZXItbGlzdC5kaXJlY3RpdmUuanMiLCJjb21wb25lbnRzL21hcmtldC1vcmRlci1saXN0L21hcmtldC1vcmRlci1saXN0LnNlcnZpY2UuanMiLCJjb21wb25lbnRzL3JlZ2lzdGVyLXBhbmVsL3JlZ2lzdGVyLXBhbmVsLmNvbnRyb2xsZXJzLmpzIiwiY29tcG9uZW50cy90ZXN0L3Rlc3QuY29udHJvbGxlcnMuanMiLCJjb21wb25lbnRzL3VzZXIvdXNlci5jb250cm9sbGVycy5qcyIsImxheW91dC9kYXNoYm9hcmQvc2lkZWJhci5jb250cm9sbGVyLmpzIiwid2lkZ2V0cy9hbGVydHMvYWxlcnRzLWRlbW8uY29udHJvbGxlci5qcyIsIndpZGdldHMvbG9hZGluZy9sb2FkaW5nLmRpcmVjdGl2ZXMuanMiLCJ3aWRnZXRzL21vZGFsL21vZGFsLWRlbW8uY29udHJvbGxlci5qcyIsIndpZGdldHMvbW9kYWwvbW9kYWwtaW5zdGFuY2UuY29udHJvbGxlci5qcyIsIndpZGdldHMvd2lkZ2V0L3dpZGdldC5kaXJlY3RpdmVzLmpzIiwid2lkZ2V0cy9wcm9ncmVzc2Jhci9wcm9ncmVzc2Jhci1kZW1vLmNvbnRyb2xsZXIuanMiLCJ3aWRnZXRzL3dpZGdldC1ib2R5L2JvZHkuZGlyZWN0aXZlcy5qcyIsIndpZGdldHMvd2lkZ2V0LWZvb3Rlci9mb290ZXIuZGlyZWN0aXZlcy5qcyIsIndpZGdldHMvd2lkZ2V0LWhlYWRlci9oZWFkZXIuZGlyZWN0aXZlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNySEE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1REE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1BBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnbWFpbkFwcCcsIFtcclxuICAgICAgICAnYXBwLmNvcmUnLFxyXG4gICAgICAgICdhcHAubGF5b3V0JyxcclxuICAgICAgICAnYXBwLmNvbXBvbmVudHMnLFxyXG4gICAgICAgICdhcHAud2lkZ2V0cydcclxuICAgIF0pO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29yZScsIFtcclxuICAgICAgICAndWkucm91dGVyJyxcclxuICAgICAgICAndWkuYm9vdHN0cmFwJyxcclxuICAgICAgICAndWkubGF5b3V0JyxcclxuICAgICAgICAnbmdSZXNvdXJjZScsXHJcbiAgICAgICAgJ25nQ29va2llcycsXHJcbiAgICAgICAgJ25nQW5pbWF0ZSdcclxuICAgIF0pO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAud2lkZ2V0cycsIFtcclxuICAgICAgICAnYXBwLmNvcmUnXHJcbiAgICBdKTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnLCBbXHJcbiAgICAgICAgJ2FwcC5jb3JlJyxcclxuICAgICAgICAnYXBwLndpZGdldHMnXHJcbiAgICBdKTtcclxuXHJcbn0pKCk7XHJcbiIsIlxyXG4vLyBTYW1wbGU6IHthZGRyLmxvY2F0aW9uOmEsYWRkci5udW1iZXI6Yn0gPT0+IGFkZHIlNUJsb2NhdGlvbiU1RD1hJmFkZHIlNUJudW1iZXIlNUQ9YlxyXG5zZXJpYWxpemVEYXRhID0gZnVuY3Rpb24ob2JqLCBwcmVmaXgpIHtcclxuICAgIHZhciBzdHIgPSBbXTtcclxuICAgIGZvciAodmFyIHAgaW4gb2JqKSB7XHJcbiAgICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cob2JqKTtcclxuICAgICAgICAgICAgdmFyIGsgPSBwcmVmaXggPyBwcmVmaXggKyBcIltcIiArIHAgKyBcIl1cIiA6IHAsXHJcbiAgICAgICAgICAgICAgICB2ID0gb2JqW3BdO1xyXG4gICAgICAgICAgICBzdHIucHVzaCh0eXBlb2YgdiA9PSBcIm9iamVjdFwiID9cclxuICAgICAgICAgICAgICAgIHNlcmlhbGl6ZURhdGEodiwgaykgOlxyXG4gICAgICAgICAgICAgICAgZW5jb2RlVVJJQ29tcG9uZW50KGspICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQodikpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAob2JqLmhhc093blByb3BlcnR5KHApKSB7XHJcbiAgICAgICAgICAgIC8vICAgdmFyIGsgPSBwcmVmaXggPyBwcmVmaXggKyBcIltcIiArIHAgKyBcIl1cIiA6IHAsIHYgPSBvYmpbcF07XHJcbiAgICAgICAgICAgIHZhciBrID0gcHJlZml4ID8gcHJlZml4ICsgXCIuXCIgKyBwIDogcCxcclxuICAgICAgICAgICAgICAgIHYgPSBvYmpbcF07XHJcbiAgICAgICAgICAgIHN0ci5wdXNoKHR5cGVvZiB2ID09IFwib2JqZWN0XCIgP1xyXG4gICAgICAgICAgICAgICAgc2VyaWFsaXplRGF0YSh2LCBrKSA6XHJcbiAgICAgICAgICAgICAgICBlbmNvZGVVUklDb21wb25lbnQoaykgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudCh2KSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0ci5qb2luKFwiJlwiKTtcclxufVxyXG5cclxuLy8gU2FtcGxlOiAzNSUgPT0+IDAuMzVcclxucGVyY2VudFRvTnVtID0gZnVuY3Rpb24ocGFyYW0pIHtcclxuICAgIHBhcmFtID0gcGFyYW0udG9TdHJpbmcoKS5yZXBsYWNlKCclJywgJycpO1xyXG4gICAgaWYgKHBhcmFtICE9IHVuZGVmaW5lZCAmJiBpc05hTihwYXJhbSkgPT0gZmFsc2UpIHtcclxuICAgICAgICByZXR1cm4gcGFyYW0gKiAxMDAwIC8gMTAwMDAwO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4qICBTZWN1cmUgSGFzaCBBbGdvcml0aG0gKFNIQTI1NilcclxuKiAgaHR0cDovL3d3dy53ZWJ0b29sa2l0LmluZm8vXHJcbiogIE9yaWdpbmFsIGNvZGUgYnkgQW5nZWwgTWFyaW4sIFBhdWwgSm9obnN0b24uXHJcbioqL1xyXG52YXIgU0hBMjU2ID0gZnVuY3Rpb24ocykge3ZhciBjaHJzeiA9IDg7dmFyIGhleGNhc2UgPSAwO2Z1bmN0aW9uIHNhZmVfYWRkKHgsIHkpIHt2YXIgbHN3ID0gKHggJiAweEZGRkYpICsgKHkgJiAweEZGRkYpO3ZhciBtc3cgPSAoeCA+PiAxNikgKyAoeSA+PiAxNikgKyAobHN3ID4+IDE2KTtyZXR1cm4gKG1zdyA8PCAxNikgfCAobHN3ICYgMHhGRkZGKTt9ZnVuY3Rpb24gUyhYLCBuKSB7cmV0dXJuIChYID4+PiBuKSB8IChYIDw8ICgzMiAtIG4pKTt9ZnVuY3Rpb24gUihYLCBuKSB7cmV0dXJuIChYID4+PiBuKTt9ZnVuY3Rpb24gQ2goeCwgeSwgeikge3JldHVybiAoKHggJiB5KSBeICgofngpICYgeikpO31mdW5jdGlvbiBNYWooeCwgeSwgeikge3JldHVybiAoKHggJiB5KSBeICh4ICYgeikgXiAoeSAmIHopKTt9ZnVuY3Rpb24gU2lnbWEwMjU2KHgpIHtyZXR1cm4gKFMoeCwgMikgXiBTKHgsIDEzKSBeIFMoeCwgMjIpKTt9ZnVuY3Rpb24gU2lnbWExMjU2KHgpIHtyZXR1cm4gKFMoeCwgNikgXiBTKHgsIDExKSBeIFMoeCwgMjUpKTt9ZnVuY3Rpb24gR2FtbWEwMjU2KHgpIHtyZXR1cm4gKFMoeCwgNykgXiBTKHgsIDE4KSBeIFIoeCwgMykpO31mdW5jdGlvbiBHYW1tYTEyNTYoeCkge3JldHVybiAoUyh4LCAxNykgXiBTKHgsIDE5KSBeIFIoeCwgMTApKTt9ZnVuY3Rpb24gY29yZV9zaGEyNTYobSwgbCkge3ZhciBLID0gbmV3IEFycmF5KDB4NDI4QTJGOTgsIDB4NzEzNzQ0OTEsIDB4QjVDMEZCQ0YsIDB4RTlCNURCQTUsIDB4Mzk1NkMyNUIsIDB4NTlGMTExRjEsIDB4OTIzRjgyQTQsIDB4QUIxQzVFRDUsIDB4RDgwN0FBOTgsIDB4MTI4MzVCMDEsIDB4MjQzMTg1QkUsIDB4NTUwQzdEQzMsIDB4NzJCRTVENzQsIDB4ODBERUIxRkUsIDB4OUJEQzA2QTcsIDB4QzE5QkYxNzQsIDB4RTQ5QjY5QzEsIDB4RUZCRTQ3ODYsIDB4RkMxOURDNiwgMHgyNDBDQTFDQywgMHgyREU5MkM2RiwgMHg0QTc0ODRBQSwgMHg1Q0IwQTlEQywgMHg3NkY5ODhEQSwgMHg5ODNFNTE1MiwgMHhBODMxQzY2RCwgMHhCMDAzMjdDOCwgMHhCRjU5N0ZDNywgMHhDNkUwMEJGMywgMHhENUE3OTE0NywgMHg2Q0E2MzUxLCAweDE0MjkyOTY3LCAweDI3QjcwQTg1LCAweDJFMUIyMTM4LCAweDREMkM2REZDLCAweDUzMzgwRDEzLCAweDY1MEE3MzU0LCAweDc2NkEwQUJCLCAweDgxQzJDOTJFLCAweDkyNzIyQzg1LCAweEEyQkZFOEExLCAweEE4MUE2NjRCLCAweEMyNEI4QjcwLCAweEM3NkM1MUEzLCAweEQxOTJFODE5LCAweEQ2OTkwNjI0LCAweEY0MEUzNTg1LCAweDEwNkFBMDcwLCAweDE5QTRDMTE2LCAweDFFMzc2QzA4LCAweDI3NDg3NzRDLCAweDM0QjBCQ0I1LCAweDM5MUMwQ0IzLCAweDRFRDhBQTRBLCAweDVCOUNDQTRGLCAweDY4MkU2RkYzLCAweDc0OEY4MkVFLCAweDc4QTU2MzZGLCAweDg0Qzg3ODE0LCAweDhDQzcwMjA4LCAweDkwQkVGRkZBLCAweEE0NTA2Q0VCLCAweEJFRjlBM0Y3LCAweEM2NzE3OEYyKTt2YXIgSEFTSCA9IG5ldyBBcnJheSgweDZBMDlFNjY3LCAweEJCNjdBRTg1LCAweDNDNkVGMzcyLCAweEE1NEZGNTNBLCAweDUxMEU1MjdGLCAweDlCMDU2ODhDLCAweDFGODNEOUFCLCAweDVCRTBDRDE5KTt2YXIgVyA9IG5ldyBBcnJheSg2NCk7dmFyIGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGksIGo7dmFyIFQxLCBUMjttW2wgPj4gNV0gfD0gMHg4MCA8PCAoMjQgLSBsICUgMzIpO21bKChsICsgNjQgPj4gOSkgPDwgNCkgKyAxNV0gPSBsO2ZvciAodmFyIGkgPSAwOyBpIDwgbS5sZW5ndGg7IGkgKz0gMTYpIHthID0gSEFTSFswXTtiID0gSEFTSFsxXTtjID0gSEFTSFsyXTtkID0gSEFTSFszXTtlID0gSEFTSFs0XTtmID0gSEFTSFs1XTtnID0gSEFTSFs2XTtoID0gSEFTSFs3XTtmb3IgKHZhciBqID0gMDsgaiA8IDY0OyBqKyspIHtpZiAoaiA8IDE2KSBXW2pdID0gbVtqICsgaV07ZWxzZSBXW2pdID0gc2FmZV9hZGQoc2FmZV9hZGQoc2FmZV9hZGQoR2FtbWExMjU2KFdbaiAtIDJdKSwgV1tqIC0gN10pLCBHYW1tYTAyNTYoV1tqIC0gMTVdKSksIFdbaiAtIDE2XSk7VDEgPSBzYWZlX2FkZChzYWZlX2FkZChzYWZlX2FkZChzYWZlX2FkZChoLCBTaWdtYTEyNTYoZSkpLCBDaChlLCBmLCBnKSksIEtbal0pLCBXW2pdKTtUMiA9IHNhZmVfYWRkKFNpZ21hMDI1NihhKSwgTWFqKGEsIGIsIGMpKTtoID0gZztnID0gZjtmID0gZTtlID0gc2FmZV9hZGQoZCwgVDEpO2QgPSBjO2MgPSBiO2IgPSBhO2EgPSBzYWZlX2FkZChUMSwgVDIpO31IQVNIWzBdID0gc2FmZV9hZGQoYSwgSEFTSFswXSk7SEFTSFsxXSA9IHNhZmVfYWRkKGIsIEhBU0hbMV0pO0hBU0hbMl0gPSBzYWZlX2FkZChjLCBIQVNIWzJdKTtIQVNIWzNdID0gc2FmZV9hZGQoZCwgSEFTSFszXSk7SEFTSFs0XSA9IHNhZmVfYWRkKGUsIEhBU0hbNF0pO0hBU0hbNV0gPSBzYWZlX2FkZChmLCBIQVNIWzVdKTtIQVNIWzZdID0gc2FmZV9hZGQoZywgSEFTSFs2XSk7SEFTSFs3XSA9IHNhZmVfYWRkKGgsIEhBU0hbN10pO31yZXR1cm4gSEFTSDt9ZnVuY3Rpb24gc3RyMmJpbmIoc3RyKSB7dmFyIGJpbiA9IEFycmF5KCk7dmFyIG1hc2sgPSAoMSA8PCBjaHJzeikgLSAxO2ZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aCAqIGNocnN6OyBpICs9IGNocnN6KSB7YmluW2kgPj4gNV0gfD0gKHN0ci5jaGFyQ29kZUF0KGkgLyBjaHJzeikgJiBtYXNrKSA8PCAoMjQgLSBpICUgMzIpO31yZXR1cm4gYmluO31mdW5jdGlvbiBVdGY4RW5jb2RlKHN0cmluZykge3N0cmluZyA9IHN0cmluZy5yZXBsYWNlKC9ybi9nLCBcIm5cIik7dmFyIHV0ZnRleHQgPSBcIlwiO2ZvciAodmFyIG4gPSAwOyBuIDwgc3RyaW5nLmxlbmd0aDsgbisrKSB7dmFyIGMgPSBzdHJpbmcuY2hhckNvZGVBdChuKTtpZiAoYyA8IDEyOCkge3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTt9IGVsc2UgaWYgKChjID4gMTI3KSAmJiAoYyA8IDIwNDgpKSB7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjID4+IDYpIHwgMTkyKTt1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgJiA2MykgfCAxMjgpO30gZWxzZSB7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjID4+IDEyKSB8IDIyNCk7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyA+PiA2KSAmIDYzKSB8IDEyOCk7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjICYgNjMpIHwgMTI4KTt9fXJldHVybiB1dGZ0ZXh0O31mdW5jdGlvbiBiaW5iMmhleChiaW5hcnJheSkge3ZhciBoZXhfdGFiID0gaGV4Y2FzZSA/IFwiMDEyMzQ1Njc4OUFCQ0RFRlwiIDogXCIwMTIzNDU2Nzg5YWJjZGVmXCI7dmFyIHN0ciA9IFwiXCI7Zm9yICh2YXIgaSA9IDA7IGkgPCBiaW5hcnJheS5sZW5ndGggKiA0OyBpKyspIHtzdHIgKz0gaGV4X3RhYi5jaGFyQXQoKGJpbmFycmF5W2kgPj4gMl0gPj4gKCgzIC0gaSAlIDQpICogOCArIDQpKSAmIDB4RikgKyBoZXhfdGFiLmNoYXJBdCgoYmluYXJyYXlbaSA+PiAyXSA+PiAoKDMgLSBpICUgNCkgKiA4KSkgJiAweEYpO31yZXR1cm4gc3RyO31zID0gVXRmOEVuY29kZShzKTtyZXR1cm4gYmluYjJoZXgoY29yZV9zaGEyNTYoc3RyMmJpbmIocyksIHMubGVuZ3RoICogY2hyc3opKTt9XHJcblxyXG4vKipcclxuKiAgU2VjdXJlIEhhc2ggQWxnb3JpdGhtIChTSEExKVxyXG4qICBodHRwOi8vd3d3LndlYnRvb2xraXQuaW5mby9cclxuKiovXHJcbnZhciBTSEExID0gZnVuY3Rpb24obXNnKSB7ZnVuY3Rpb24gcm90YXRlX2xlZnQobixzKSB7dmFyIHQ0ID0gKCBuPDxzICkgfCAobj4+PigzMi1zKSk7cmV0dXJuIHQ0O307ZnVuY3Rpb24gbHNiX2hleCh2YWwpIHt2YXIgc3RyPVwiXCI7dmFyIGk7dmFyIHZoO3ZhciB2bDtmb3IoIGk9MDsgaTw9NjsgaSs9MiApIHt2aCA9ICh2YWw+Pj4oaSo0KzQpKSYweDBmO3ZsID0gKHZhbD4+PihpKjQpKSYweDBmO3N0ciArPSB2aC50b1N0cmluZygxNikgKyB2bC50b1N0cmluZygxNik7fXJldHVybiBzdHI7fTtmdW5jdGlvbiBjdnRfaGV4KHZhbCkge3ZhciBzdHI9XCJcIjt2YXIgaTt2YXIgdjtmb3IoIGk9NzsgaT49MDsgaS0tICkge3YgPSAodmFsPj4+KGkqNCkpJjB4MGY7c3RyICs9IHYudG9TdHJpbmcoMTYpO31yZXR1cm4gc3RyO307ZnVuY3Rpb24gVXRmOEVuY29kZShzdHJpbmcpIHtzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvcm4vZyxcIm5cIik7dmFyIHV0ZnRleHQgPSBcIlwiO2ZvciAodmFyIG4gPSAwOyBuIDwgc3RyaW5nLmxlbmd0aDsgbisrKSB7dmFyIGMgPSBzdHJpbmcuY2hhckNvZGVBdChuKTtpZiAoYyA8IDEyOCkge3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTt9ZWxzZSBpZigoYyA+IDEyNykgJiYgKGMgPCAyMDQ4KSkge3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiA2KSB8IDE5Mik7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjICYgNjMpIHwgMTI4KTt9ZWxzZSB7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjID4+IDEyKSB8IDIyNCk7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyA+PiA2KSAmIDYzKSB8IDEyOCk7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjICYgNjMpIHwgMTI4KTt9fXJldHVybiB1dGZ0ZXh0O307dmFyIGJsb2Nrc3RhcnQ7dmFyIGksIGo7dmFyIFcgPSBuZXcgQXJyYXkoODApO3ZhciBIMCA9IDB4Njc0NTIzMDE7dmFyIEgxID0gMHhFRkNEQUI4OTt2YXIgSDIgPSAweDk4QkFEQ0ZFO3ZhciBIMyA9IDB4MTAzMjU0NzY7dmFyIEg0ID0gMHhDM0QyRTFGMDt2YXIgQSwgQiwgQywgRCwgRTt2YXIgdGVtcDttc2cgPSBVdGY4RW5jb2RlKG1zZyk7dmFyIG1zZ19sZW4gPSBtc2cubGVuZ3RoO3ZhciB3b3JkX2FycmF5ID0gbmV3IEFycmF5KCk7Zm9yKCBpPTA7IGk8bXNnX2xlbi0zOyBpKz00ICkge2ogPSBtc2cuY2hhckNvZGVBdChpKTw8MjQgfCBtc2cuY2hhckNvZGVBdChpKzEpPDwxNiB8bXNnLmNoYXJDb2RlQXQoaSsyKTw8OCB8IG1zZy5jaGFyQ29kZUF0KGkrMyk7d29yZF9hcnJheS5wdXNoKCBqICk7fXN3aXRjaCggbXNnX2xlbiAlIDQgKSB7Y2FzZSAwOmkgPSAweDA4MDAwMDAwMDticmVhaztjYXNlIDE6aSA9IG1zZy5jaGFyQ29kZUF0KG1zZ19sZW4tMSk8PDI0IHwgMHgwODAwMDAwO2JyZWFrO2Nhc2UgMjppID0gbXNnLmNoYXJDb2RlQXQobXNnX2xlbi0yKTw8MjQgfCBtc2cuY2hhckNvZGVBdChtc2dfbGVuLTEpPDwxNiB8IDB4MDgwMDA7YnJlYWs7Y2FzZSAzOmkgPSBtc2cuY2hhckNvZGVBdChtc2dfbGVuLTMpPDwyNCB8IG1zZy5jaGFyQ29kZUF0KG1zZ19sZW4tMik8PDE2IHwgbXNnLmNoYXJDb2RlQXQobXNnX2xlbi0xKTw8OCB8IDB4ODA7YnJlYWs7fXdvcmRfYXJyYXkucHVzaCggaSApO3doaWxlKCAod29yZF9hcnJheS5sZW5ndGggJSAxNikgIT0gMTQgKSB3b3JkX2FycmF5LnB1c2goIDAgKTt3b3JkX2FycmF5LnB1c2goIG1zZ19sZW4+Pj4yOSApO3dvcmRfYXJyYXkucHVzaCggKG1zZ19sZW48PDMpJjB4MGZmZmZmZmZmICk7Zm9yICggYmxvY2tzdGFydD0wOyBibG9ja3N0YXJ0PHdvcmRfYXJyYXkubGVuZ3RoOyBibG9ja3N0YXJ0Kz0xNiApIHtmb3IoIGk9MDsgaTwxNjsgaSsrICkgV1tpXSA9IHdvcmRfYXJyYXlbYmxvY2tzdGFydCtpXTtmb3IoIGk9MTY7IGk8PTc5OyBpKysgKSBXW2ldID0gcm90YXRlX2xlZnQoV1tpLTNdIF4gV1tpLThdIF4gV1tpLTE0XSBeIFdbaS0xNl0sIDEpO0EgPSBIMDtCID0gSDE7QyA9IEgyO0QgPSBIMztFID0gSDQ7Zm9yKCBpPSAwOyBpPD0xOTsgaSsrICkge3RlbXAgPSAocm90YXRlX2xlZnQoQSw1KSArICgoQiZDKSB8ICh+QiZEKSkgKyBFICsgV1tpXSArIDB4NUE4Mjc5OTkpICYgMHgwZmZmZmZmZmY7RSA9IEQ7RCA9IEM7QyA9IHJvdGF0ZV9sZWZ0KEIsMzApO0IgPSBBO0EgPSB0ZW1wO31mb3IoIGk9MjA7IGk8PTM5OyBpKysgKSB7dGVtcCA9IChyb3RhdGVfbGVmdChBLDUpICsgKEIgXiBDIF4gRCkgKyBFICsgV1tpXSArIDB4NkVEOUVCQTEpICYgMHgwZmZmZmZmZmY7RSA9IEQ7RCA9IEM7QyA9IHJvdGF0ZV9sZWZ0KEIsMzApO0IgPSBBO0EgPSB0ZW1wO31mb3IoIGk9NDA7IGk8PTU5OyBpKysgKSB7dGVtcCA9IChyb3RhdGVfbGVmdChBLDUpICsgKChCJkMpIHwgKEImRCkgfCAoQyZEKSkgKyBFICsgV1tpXSArIDB4OEYxQkJDREMpICYgMHgwZmZmZmZmZmY7RSA9IEQ7RCA9IEM7QyA9IHJvdGF0ZV9sZWZ0KEIsMzApO0IgPSBBO0EgPSB0ZW1wO31mb3IoIGk9NjA7IGk8PTc5OyBpKysgKSB7dGVtcCA9IChyb3RhdGVfbGVmdChBLDUpICsgKEIgXiBDIF4gRCkgKyBFICsgV1tpXSArIDB4Q0E2MkMxRDYpICYgMHgwZmZmZmZmZmY7RSA9IEQ7RCA9IEM7QyA9IHJvdGF0ZV9sZWZ0KEIsMzApO0IgPSBBO0EgPSB0ZW1wO31IMCA9IChIMCArIEEpICYgMHgwZmZmZmZmZmY7SDEgPSAoSDEgKyBCKSAmIDB4MGZmZmZmZmZmO0gyID0gKEgyICsgQykgJiAweDBmZmZmZmZmZjtIMyA9IChIMyArIEQpICYgMHgwZmZmZmZmZmY7SDQgPSAoSDQgKyBFKSAmIDB4MGZmZmZmZmZmO312YXIgdGVtcCA9IGN2dF9oZXgoSDApICsgY3Z0X2hleChIMSkgKyBjdnRfaGV4KEgyKSArIGN2dF9oZXgoSDMpICsgY3Z0X2hleChINCk7cmV0dXJuIHRlbXAudG9Mb3dlckNhc2UoKTt9XHJcblxyXG5cclxuLy8gR3JhYiB0aGUgZmlsZXMgYW5kIHNldCB0aGVtIHRvIG91ciB2YXJpYWJsZVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIDxpbnB1dCBpZD1cImZpbGV1cGxvYWRcIiB0eXBlPVwiZmlsZVwiIGNsYXNzPVwiXCIgbmFtZT1cImZpbGVzW11cIiBkYXRhLXVybD1cInVwbG9hZC5kb1wiIG11bHRpcGxlPlxyXG5mdW5jdGlvbiBwcmVwYXJlVXBsb2FkKGV2ZW50KSB7XHJcbiAgICB2YXIgZWxlID0gJCh0aGlzKS5zaWJsaW5ncygnLmhpZGRlbicpWzBdO1xyXG4gICAgdXBsb2FkRmlsZXMoZXZlbnQudGFyZ2V0LmZpbGVzLCBlbGUpO1xyXG5cclxuICAgIC8vIGVsZS52YWx1ZSA9IHJlc0ZpbGVJZDtcclxuICAgIC8vXHJcbiAgICAvLyB0cnkge1xyXG4gICAgLy8gICAgIHZhciByZXNGaWxlSWQgPSB1cGxvYWRGaWxlcyhldmVudC50YXJnZXQuZmlsZXMpO1xyXG4gICAgLy8gICAgIHZhciBlbGUgPSAkKHRoaXMpLnNpYmxpbmdzKCcuaGlkZGVuJylbMF0udmFsdWU7XHJcbiAgICAvLyAgICAgdmFyIGFycmF5ID0gZWxlID09IFwiXCI/IFtdIDogZWxlLnNwbGl0KCcsJykgO1xyXG4gICAgLy8gfSBjYXRjaCAoZSkge1xyXG4gICAgLy8gICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgLy8gfSBmaW5hbGx5IHtcclxuICAgIC8vICAgICBjb25zb2xlLmxvZyhhcnJheSk7XHJcbiAgICAvLyAgICAgYXJyYXkucHVzaChyZXNGaWxlSWQpO1xyXG4gICAgLy8gICAgIGNvbnNvbGUubG9nKGFycmF5KTtcclxuICAgIC8vICAgICBlbGUudmFsdWUgPSBhcnJheS5qb2luKCcsJykpLnRyaWdnZXIoJ2lucHV0JztcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBlbGUudmFsKGVsZS52YWwoKS5zcGxpdCgnLCcpLnB1c2gocmVzSWQpLmpvaW4oJywnKSkudHJpZ2dlcignaW5wdXQnKTtcclxuXHJcbiAgICAvLyAkKHRoaXMpLnNpYmxpbmdzKCcuaGlkZGVuJykudmFsKHVwbG9hZEZpbGVzKGV2ZW50LnRhcmdldC5maWxlcykpLnRyaWdnZXIoJ2lucHV0Jyk7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogQHBhcmFtIGZpbGVzIOmcgOimgeS4iuS8oOeahOaWh+S7tlxyXG4gKiBAcGFyYW0gZWxlIOS4iuS8oOaIkOWKn+WQjuaOpeaUtui/lOWbnuaWh+S7tklE55qE5YWD57SgXHJcbiAqIEBkZXNjIOaWh+S7tuS4iuS8oOaooeWdlywg6K6+572u6L+U5ZueaWTlkI7vvIzkvb/nlKh0cmlnZ2VyKCdpbnB1dCcp5L2/bmctbW9kZWzog73mlLbliLDlgLxcclxuICovXHJcbmZ1bmN0aW9uIHVwbG9hZEZpbGVzKGZpbGVzLCBlbGUpIHtcclxuICAgIC8vIENyZWF0ZSBhIGZvcm1kYXRhIG9iamVjdCBhbmQgYWRkIHRoZSBmaWxlc1xyXG4gICAgdmFyIGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICQuZWFjaChmaWxlcywgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIGRhdGEuYXBwZW5kKFwiZmlsZXNcIiwgdmFsdWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coZmlsZXMpXHJcblxyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6ICd1cGxvYWQuZG8nLFxyXG4gICAgICAgIHR5cGU6ICdQT1NUJyxcclxuICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgIGNhY2hlOiBmYWxzZSxcclxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSwgLy8gRG9uJ3QgcHJvY2VzcyB0aGUgZmlsZXNcclxuICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsIC8vIFNldCBjb250ZW50IHR5cGUgdG8gZmFsc2UgYXMgalF1ZXJ5IHdpbGwgdGVsbCB0aGUgc2VydmVyIGl0cyBhIHF1ZXJ5IHN0cmluZyByZXF1ZXN0XHJcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhLmVycm9yID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgLy8gU3VjY2VzcyBzbyBjYWxsIGZ1bmN0aW9uIHRvIHByb2Nlc3MgdGhlIGZvcm1cclxuICAgICAgICAgICAgICAgIGZpbGVpZCA9IGRhdGEuY29udGVudC5uYW1lO1xyXG4gICAgICAgICAgICAgICAgZWxlLnZhbHVlID0gZGF0YS5jb250ZW50Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICAkKGVsZSkudHJpZ2dlcignaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgIC8vIHN1Ym1pdEZvcm0oZXZlbnQsIGRhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIGVycm9ycyBoZXJlXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRVJST1JTOiAnICsgZGF0YS5lcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcclxuICAgICAgICAgICAgLy8gSGFuZGxlIGVycm9ycyBoZXJlXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUlM6ICcgKyB0ZXh0U3RhdHVzKTtcclxuICAgICAgICAgICAgLy8gU1RPUCBMT0FESU5HIFNQSU5ORVJcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG4iLCIiLCIvKipcclxuICogQGF1dGhvciBTaGF3blxyXG4gKiBAZGVzYyBtYWluQVBQXHJcbiAqL1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb3JlJylcclxuICAgICAgICAvLyBHbG9iYWxcclxuICAgICAgICAuY29uc3RhbnQoJ1dFQl9JTkZPJywge1xyXG4gICAgICAgICAgICB0aXRsZTogJ09yZGVyIE1hbmFnZW1lbnQgU3lzdGVtJ1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC5jb25zdGFudCgnQVVUSF9FVkVOVFMnLCB7XHJcbiAgICAgICAgICAgIGxvZ2luU3VjY2VzczogJ2F1dGgtbG9naW4tc3VjY2VzcycsXHJcbiAgICAgICAgICAgIGxvZ2luRmFpbGVkOiAnYXV0aC1sb2dpbi1mYWlsZWQnLFxyXG4gICAgICAgICAgICBsb2dvdXRTdWNjZXNzOiAnYXV0aC1sb2dvdXQtc3VjY2VzcycsXHJcbiAgICAgICAgICAgIHNlc3Npb25UaW1lb3V0OiAnYXV0aC1zZXNzaW9uLXRpbWVvdXQnLFxyXG4gICAgICAgICAgICBub3RBdXRoZW50aWNhdGVkOiAnYXV0aC1ub3QtYXV0aGVudGljYXRlZCcsXHJcbiAgICAgICAgICAgIHBhZ2VOb3RGb3VuZDogJ3BhZ2Utbm90LWZvdW5kJyxcclxuICAgICAgICAgICAgc2VydmVyRXJyb3I6ICdzZXJ2ZXItZXJyb3InXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgLy8gRG8gYXV0aCB3aGVuIHN0YXRlL3VybCBjaGFuZ2VcclxuICAgICAgICAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUsIEFVVEhfRVZFTlRTLCBBdXRoU2VydmljZSwgU2Vzc2lvbikge1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldmVudCwgbmV4dCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChBVVRIX0VWRU5UUy5ub3RBdXRoZW50aWNhdGVkKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IFNlc3Npb24uZ2V0VXNlck5hbWUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuXHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBAYXV0aG9yIFNoYXduXHJcbiAqIEBkZXNjIFRoZSBSb290IENvbnRyb2xsZXIgb2YgdGhlIG1haW5BUFBcclxuICovXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvcmUnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdtYWluQ3RybCcsIG1haW5DdHJsKTtcclxuXHJcbiAgICBtYWluQ3RybC4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJyRzY29wZScsICckbG9jYXRpb24nLCAnJHN0YXRlJywgJyR3aW5kb3cnLCAnQXV0aFNlcnZpY2UnLCAnQVVUSF9FVkVOVFMnLCAnQ29tbW9uU2VydmljZScsICdTZXNzaW9uJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkN0cmwoJHJvb3RTY29wZSwgJHNjb3BlLCAkbG9jYXRpb24sICRzdGF0ZSwgJHdpbmRvdywgQXV0aFNlcnZpY2UsIEFVVEhfRVZFTlRTLCBDb21tb25TZXJ2aWNlLCBTZXNzaW9uKSB7XHJcblxyXG4gICAgICAgIC8vIGlmICghJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbikge1xyXG4gICAgICAgIC8vICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XHJcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKDEpO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgLy8gZm9yIHRlc3RcclxuXHJcbiAgICAgICAgLy8gJHJvb3RTY29wZS5tb0xpc3QgPSBbXTtcclxuXHJcbiAgICAgICAgLy8gJHNjb3BlLm9yZGVySXRlbXMgPSBbXTtcclxuICAgICAgICAvLyBmb3IgKHZhciBpID0gMDsgaSA8IDMwOyBpKyspIHtcclxuICAgICAgICAvLyAgICAgJHNjb3BlLm9yZGVySXRlbXNbaV0gPSBpO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5zZXRDdXJyZW50VXNlciA9IGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHVzZXI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gTG9nIG91dFxyXG4gICAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbiA9ICcnO1xyXG4gICAgICAgICAgICAvLyBTZXNzaW9uLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IG51bGw7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChBVVRIX0VWRU5UUy5sb2dvdXRTdWNjZXNzKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2xvZ291dCBzdWNjZXNzJyk7XHJcbiAgICAgICAgICAgIC8vIEF1dGhTZXJ2aWNlLmxvZ291dCgpLnRoZW4oZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAoQ29tbW9uU2VydmljZS5pc1JlcVN1Y2Nlc3MocmVzKSkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChBVVRIX0VWRU5UUy5sb2dvdXRTdWNjZXNzKTtcclxuICAgICAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZygnTG9nIG91dCBzdWNjZXNzJyk7XHJcbiAgICAgICAgICAgIC8vICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIENvbW1vblNlcnZpY2UuaGFuZGxlUmVzRXJyKHJlcyk7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vIH0sIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAvLyAgICAgQ29tbW9uU2VydmljZS5oYW5kbGVIdHRwRXJyKHJlcyk7XHJcbiAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTGlzdGVuaW5nXHJcbiAgICAgICAgJHNjb3BlLiRvbihBVVRIX0VWRU5UUy5sb2dpblN1Y2Nlc3MsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibG9naW4gc3VjY2Vzc1wiKTtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lLm9yZGVyJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oQVVUSF9FVkVOVFMubG9naW5GYWlsZWQsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW4gPSAnJztcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2dpbiBmYWlsZWRcIik7XHJcbiAgICAgICAgICAgIC8vICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oQVVUSF9FVkVOVFMubG9nb3V0U3VjY2VzcywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlbW92ZSB0b2tlbicpO1xyXG4gICAgICAgICAgICAkd2luZG93LnNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3Rva2VuJyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibG9naW4gZmFpbGVkXCIpO1xyXG4gICAgICAgICAgICAvLyAkbG9jYXRpb24ucGF0aCgnLycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdtZXRob2Qtbm90LWFsbG93JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJtZXRob2Qgbm90IGFsbG93XCIpO1xyXG4gICAgICAgICAgICAvLyAkbG9jYXRpb24ucGF0aCgnLycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKEFVVEhfRVZFTlRTLnBhZ2VOb3RGb3VuZCwgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJzQwNCBlcnJvcicpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKEFVVEhfRVZFTlRTLnNlcnZlckVycm9yLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnNTAwIGVycm9yJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG5cclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIEBhdXRob3IgU2hhd25cclxuICogQGRlc2MgbWFpbkFQUFxyXG4gKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5jb25zdCBQUk9KRUNUU1RBVFVTID0ge1xyXG4gICAgMDogXCJ0ZVwiLFxyXG4gICAgMTogXCIyXCIsXHJcbiAgICAyOiBcIjNcIixcclxuICAgIDM6IFwiclwiLFxyXG4gICAgNDogXCJyXCIsXHJcbiAgICA1OiBcImZld2ZcIixcclxuICAgIDY6IFwiZmVhd1wiXHJcbn07XHJcblxyXG4vKiBmaWx0ZXJzICovXHJcbnZhciBmaWx0ZXJzID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJylcclxuXHJcbi5maWx0ZXIoJ3N3aXRjaCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKHBhcmFtKSB7XHJcbiAgICAgICAgaWYgKHBhcmFtID09IDEgfHwgcGFyYW0gPT0gJzEnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnT1BFTic7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICdDTE9TRUQnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSlcclxuXHJcbi8vIDc4ID09PT4gMC43OFxyXG4uZmlsdGVyKCdwZXJjZW50JywgZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24ocGFyYW0pIHtcclxuICAgICAgICBpZiAocGFyYW0gIT0gdW5kZWZpbmVkICYmIGlzTmFOKHBhcmFtKSA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyYW0gKiAxMDAwIC8gMTAwMDAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pXHJcblxyXG4uZmlsdGVyKCdjYXRlZ29yeScsIGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIG9iaiA9IENBVEVHT1JZO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKHBhcmFtKSB7XHJcbiAgICAgICAgcmV0dXJuIG9ialtwYXJhbV0gIT0gdW5kZWZpbmVkID8gb2JqW3BhcmFtXSA6IFwiXCI7XHJcbiAgICB9XHJcbn0pXHJcblxyXG4uZmlsdGVyKCdidWlsZGNvbXBhbnknLCBmdW5jdGlvbigpIHtcclxuICAgIHZhciBvYmogPSBCVUlMRENPTVBBTlk7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24ocGFyYW0pIHtcclxuICAgICAgICByZXR1cm4gb2JqW3BhcmFtXSAhPSB1bmRlZmluZWQgPyBvYmpbcGFyYW1dIDogXCJcIjtcclxuICAgIH1cclxufSlcclxuXHJcbi5maWx0ZXIoJ3Byb2plY3RzdGF0dXMnLCBmdW5jdGlvbigpIHtcclxuICAgIHZhciBvYmogPSBQUk9KRUNUU1RBVFVTO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKHBhcmFtKSB7XHJcbiAgICAgICAgcmV0dXJuIG9ialtwYXJhbV0gIT0gdW5kZWZpbmVkID8gb2JqW3BhcmFtXSA6IFwiXCI7XHJcbiAgICB9XHJcbn0pXHJcbn0pKCk7IiwiIiwiLyoqXHJcbiAqIEBhdXRob3IgU2hhd25cclxuICogQGRlc2Mgcm91dGVyIG9mIGFwcC5jb3JlXHJcbiAqL1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJylcclxuXHJcbiAgICAgICAgLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJGh0dHBQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xyXG5cclxuICAgICAgICAgICAgLy8gSW50ZXJjZXB0b3Igb2YgUmVxdWVzdHNcclxuICAgICAgICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaChbXHJcbiAgICAgICAgICAgICAgICAnJGluamVjdG9yJyxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCRpbmplY3Rvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkaW5qZWN0b3IuZ2V0KCdBdXRoSW50ZXJjZXB0b3InKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXSk7XHJcblxyXG4gICAgICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUoe1xyXG4gICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICByZXF1aXJlQmFzZTogZmFsc2VcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBGb3IgYW55IHVubWF0Y2hlZCB1cmwsIHJlZGlyZWN0IHRvIC9cclxuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2xvZ2luJyk7XHJcblxyXG5cclxuICAgICAgICAgICAgLy8gbG9naW5yZWdpc3RlclxyXG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxyXG5cclxuICAgICAgICAgICAgICAgIC8vIG1haW4gcGFnZVxyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy8nLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnaHRtbC9kYXNoYm9hcmQuaHRtbCdcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwiaG9tZS5kYXNoMVwiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcImRhc2gxXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiaHRtbC9yZGFzaC9kYXNoYm9hcmQuaHRtbFwiXHJcbiAgICAgICAgICAgICAgICB9KS5zdGF0ZShcImhvbWUub3JkZXJcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJvcmRlclwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImpzL2NvbXBvbmVudHMvY2xpZW50LW9yZGVyLWxpc3QvY2xpZW50LW9yZGVyLWxpc3QuaHRtbFwiXHJcbiAgICAgICAgICAgICAgICB9KS5zdGF0ZShcImhvbWUuZGFzaDJcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJkYXNoMlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImh0bWwvcmRhc2gvdGFibGVzLmh0bWxcIlxyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9sb2dpbicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdodG1sL2xvZ2luLmh0bWwnXHJcbiAgICAgICAgICAgICAgICB9KS5zdGF0ZSgncmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2h0bWwvcmVnaXN0ZXIuaHRtbCdcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXNlciBBY2NvdW50XHJcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FjY291bnQnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FjY291bnQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnaHRtbC9hY2NvdW50L2FjY291bnQuaHRtbCdcclxuICAgICAgICAgICAgICAgIH0pLnN0YXRlKCdhY2NvdW50Lm1lJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9tZScsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdodG1sL2FjY291bnQvYWNjb3VudC5tZS5odG1sJ1xyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBmb3IgdGVzdFxyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0ZXN0Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy90ZXN0JyxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2h0bWwvdGVzdC1hbmd1bGFyLXVpLWJvb3RzdHJhcC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAndGVzdEN0cmwnXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG59KSgpO1xyXG4iLCIvKipcclxuICogQGF1dGhvciBTaGF3blxyXG4gKiBAZGVzYyBTZXJ2aWNlcyBvZiB0aGUgbWFpbkFQUFxyXG4gKi9cclxuXHJcbi8vIEZvciB0ZXN0XHJcbnZhciBjb21tb25UZXN0ID0gdHJ1ZTtcclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvcmUnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdBdXRoSW50ZXJjZXB0b3InLCBBdXRoSW50ZXJjZXB0b3IpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1Nlc3Npb24nLCBTZXNzaW9uKVxyXG4gICAgICAgIC5mYWN0b3J5KCdDb21tb25TZXJ2aWNlJywgQ29tbW9uU2VydmljZSlcclxuICAgICAgICAuZmFjdG9yeSgnQXV0aFNlcnZpY2UnLCBBdXRoU2VydmljZSlcclxuICAgICAgICAuZmFjdG9yeSgncmVnaXN0ZXJTZXJ2aWNlJywgcmVnaXN0ZXJTZXJ2aWNlKVxyXG4gICAgICAgIC5mYWN0b3J5KCd1c2VyU2VydmljZScsIHVzZXJTZXJ2aWNlKTtcclxuXHJcbiAgICBTZXNzaW9uLiRpbmplY3QgPSBbJyRjb29raWVzJywgJyR3aW5kb3cnXTtcclxuICAgIEF1dGhJbnRlcmNlcHRvci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJyRxJywgJyR3aW5kb3cnLCAnQVVUSF9FVkVOVFMnXTtcclxuICAgIEF1dGhTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRyb290U2NvcGUnLCAnQVVUSF9FVkVOVFMnLCAnJHdpbmRvdycsICdDb21tb25TZXJ2aWNlJ107XHJcbiAgICBDb21tb25TZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJ1Nlc3Npb24nXTtcclxuICAgIHJlZ2lzdGVyU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcm9vdFNjb3BlJywgJ0NvbW1vblNlcnZpY2UnXTtcclxuICAgIHVzZXJTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRyb290U2NvcGUnLCAnU2Vzc2lvbicsICdDb21tb25TZXJ2aWNlJ107XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIEF1dGhJbnRlcmNlcHRvcigkcm9vdFNjb3BlLCAkcSwgJHdpbmRvdywgQVVUSF9FVkVOVFMpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgcmVxdWVzdDogcmVxdWVzdEhhbmRsZXIsXHJcbiAgICAgICAgICAgIHJlc3BvbnNlOiByZXNwb25zZUhhbmRsZXIsXHJcbiAgICAgICAgICAgIHJlc3BvbnNlRXJyb3I6IHJlc3BvbnNlRXJyb3JIYW5kbGVyXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVxdWVzdEhhbmRsZXIoY29uZmlnKSB7XHJcbiAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XHJcbiAgICAgICAgICAgIGlmICgkd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snWC1BdXRoVG9rZW4nXSA9ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlc3BvbnNlSGFuZGxlcihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSlcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIHVzZXIgaXMgbm90IGF1dGhlbnRpY2F0ZWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgJHEud2hlbihyZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNwb25zZUVycm9ySGFuZGxlcihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCh7XHJcbiAgICAgICAgICAgICAgICA0MDE6IEFVVEhfRVZFTlRTLm5vdEF1dGhlbnRpY2F0ZWQsXHJcbiAgICAgICAgICAgICAgICA0MDM6IEFVVEhfRVZFTlRTLm5vdEF1dGhvcml6ZWQsXHJcbiAgICAgICAgICAgICAgICA0MDU6ICdtZXRob2Qtbm90LWFsbG93JyxcclxuICAgICAgICAgICAgICAgIDQxOTogQVVUSF9FVkVOVFMuc2Vzc2lvblRpbWVvdXQsXHJcbiAgICAgICAgICAgICAgICA0NDA6IEFVVEhfRVZFTlRTLnNlc3Npb25UaW1lb3V0LFxyXG4gICAgICAgICAgICAgICAgNDA0OiBBVVRIX0VWRU5UUy5wYWdlTm90Rm91bmQsXHJcbiAgICAgICAgICAgICAgICA1MDA6IEFVVEhfRVZFTlRTLnNlcnZlckVycm9yXHJcbiAgICAgICAgICAgIH1bcmVzcG9uc2Uuc3RhdHVzXSwgcmVzcG9uc2UpO1xyXG4gICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIFNlc3Npb24oJGNvb2tpZXMsICR3aW5kb3cpIHtcclxuICAgICAgICB2YXIgYU5hbWUgPSBcIlVTRVJJRFwiO1xyXG4gICAgICAgIHZhciBiTmFtZSA9IFwiU0lEXCI7XHJcblxyXG4gICAgICAgIHRoaXMuY3JlYXRlID0gZnVuY3Rpb24oc2Vzc2lvbklkLCB1c2VySWQpIHtcclxuICAgICAgICAgICAgJGNvb2tpZXMucHV0KGFOYW1lLCB1c2VySWQpO1xyXG4gICAgICAgICAgICAkY29va2llcy5wdXQoYk5hbWUsIHNlc3Npb25JZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuY3JlYXRlID0gZnVuY3Rpb24oc2Vzc2lvbklkLCB1c2VySWQpIHtcclxuICAgICAgICAvLyAgICAgZG9jdW1lbnQuY29va2llID0gYU5hbWUgKyAnPScgKyB1c2VySWQ7XHJcbiAgICAgICAgLy8gICAgIGRvY3VtZW50LmNvb2tpZSA9IGJOYW1lICsgJz0nICsgc2Vzc2lvbklkO1xyXG4gICAgICAgIC8vICAgICB0aGlzLmlkID0gc2Vzc2lvbklkO1xyXG4gICAgICAgIC8vICAgICB0aGlzLnVzZXJJZCA9IHVzZXJJZDtcclxuICAgICAgICAvLyB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldCA9IGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRjb29raWVzLmdldE9iamVjdChuYW1lKTtcclxuICAgICAgICAgICAgLy8gaWYgKGRvY3VtZW50LmNvb2tpZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIC8vICAgICB2YXIgc3RhcnQgPSBkb2N1bWVudC5jb29raWUuaW5kZXhPZihuYW1lICsgXCI9XCIpO1xyXG4gICAgICAgICAgICAvLyAgICAgaWYgKHN0YXJ0ICE9IC0xKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgc3RhcnQgPSBzdGFydCArIG5hbWUubGVuZ3RoICsgMTtcclxuICAgICAgICAgICAgLy8gICAgICAgICB2YXIgZW5kID0gZG9jdW1lbnQuY29va2llLmluZGV4T2YoXCI7XCIsIHN0YXJ0KTtcclxuICAgICAgICAgICAgLy8gICAgICAgICBpZiAoZW5kID09IC0xKSBlbmQgPSBkb2N1bWVudC5jb29raWUubGVuZ3RoO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiB1bmVzY2FwZShkb2N1bWVudC5jb29raWUuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpKTtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAvLyByZXR1cm4gXCJcIjtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZ2V0VXNlck5hbWUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KGFOYW1lKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZ2V0U2Vzc2lvbklkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChiTmFtZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmdldE9iaiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgJ2FjY291bnRuYW1lJzogdGhpcy5nZXQoYU5hbWUpLFxyXG4gICAgICAgICAgICAgICAgJ3Nlc3Npb25pZCc6IHRoaXMuZ2V0KGJOYW1lKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbicpO1xyXG4gICAgICAgICAgICAvLyBkb2N1bWVudC5jb29raWUgPSBhTmFtZSArICc9JztcclxuICAgICAgICAgICAgLy8gZG9jdW1lbnQuY29va2llID0gYk5hbWUgKyAnPSc7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuaWQgPSBudWxsO1xyXG4gICAgICAgICAgICAvLyB0aGlzLnVzZXJJZCA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gR2xvYmFsIFNlcnZpY2VzXHJcbiAgICBmdW5jdGlvbiBDb21tb25TZXJ2aWNlKCRodHRwLCBTZXNzaW9uKSB7XHJcbiAgICAgICAgLy8gU2V0IENvbnRlbnQtVHlwZSB0byBmb3JtLWRhdGEgd2hpY2ggYmFjay1lbmQgY2FuIGFjY2VwdFxyXG4gICAgICAgIC8vICRodHRwLmRlZmF1bHRzLmhlYWRlcnMucG9zdFsnQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkO2NoYXJzZXQ9dXRmLTgnO1xyXG5cclxuICAgICAgICB2YXIgdXJsQmFja0VuZCA9ICdodHRwOi8vbG9mZXdmY2FsaG9zdDo4MDgwL3dzLyc7XHJcbiAgICAgICAgLy8gdmFyIHVybEJhY2tFbmQgPSAnaHR0cDovLzEwLjIyLjE2LjEyNDo4MDg4L3dzL21hcmtldG9yZGVyL2dldEJ5Q2xpZW50T3JkZXJJZC8nO1xyXG4gICAgICAgIHZhciB1cmxNaWRkbGVFbmQgPSAnaHR0cHM6Ly9FeGFtcGxlVVJMLjkyLyc7XHJcblxyXG4gICAgICAgIC8vIHJlcXVlc3RzIHN0YXR1cyBoYW5kbGVcclxuICAgICAgICB0aGlzLmlzUmVxU3VjY2VzcyA9IGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLmRhdGEuZXJyQ29kZSA9PSAwID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGhhbmRsZSBIdHRwIGVycm9yXHJcbiAgICAgICAgdGhpcy5oYW5kbGVIdHRwRXJyID0gZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXEgRXJyb3InLCByZXMpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGhhbmRsZSByZXNwb25zZSBlcnJvciAoYmFzZSBvbiBBUEkpXHJcbiAgICAgICAgdGhpcy5oYW5kbGVSZXNFcnIgPSBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgICAgaWYgKHJlcy5kYXRhLmVyckRlc2MgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3Igd2l0aG91dCBkaXNjcmlwdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ21zZzogJyArIHJlcy5lcnJEZXNjKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGFsZXJ0KHJlcy5kYXRhLmVyckRlc2MpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gcG9zdCBzaW5nbGUgY29tbWFuZCB0byBiYWNrLWVuZCBzZXJ2ZXJcclxuICAgICAgICB0aGlzLnBvc3QgPSBmdW5jdGlvbihjb21tYW5kLCBkYXRhKSB7XHJcbiAgICAgICAgICAgIC8vIFJlcXVlc3QgcGFyYW1ldGVycyBzdHJ1Y3R1cmVcclxuICAgICAgICAgICAgLy8gdmFyIGRhdGExMTEgPSAkLmV4dGVuZCh7XHJcbiAgICAgICAgICAgIC8vICAgICBcImNvbW1hbmRcIjogY29tbWFuZFxyXG4gICAgICAgICAgICAvLyB9LCBTZXNzaW9uLmdldE9iaigpLCBkYXRhKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGFuZ3VsYXIudG9Kc29uKGRhdGEpKTtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbW1vblRlc3QgPyAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICd0ZXN0LWRhdGEvd3MvJyArIGNvbW1hbmQsXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnXHJcbiAgICAgICAgICAgIH0pIDogJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxCYWNrRW5kICsgY29tbWFuZCxcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIHBvc3QgbXVsdGkgY29tbWFuZHMgdG8gc2VydmVyXHJcbiAgICAgICAgdGhpcy5wb3N0TXVsdGkgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIEF1dGhTZXJ2aWNlKCRodHRwLCAkcm9vdFNjb3BlLCBBVVRIX0VWRU5UUywgJHdpbmRvdywgQ29tbW9uU2VydmljZSkge1xyXG5cclxuICAgICAgICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgICAgYXV0aFNlcnZpY2UubG9naW4gPSBmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBDb21tb25TZXJ2aWNlLnBvc3QoXCJsb2dpblwiLCB1c2VyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhdXRoU2VydmljZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIENvbW1vblNlcnZpY2UucG9zdChcImxvZ291dFwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBpcyBzZXNzaW9uIGF2YWxpZFxyXG4gICAgICAgIGF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaXNBdXRoZW50aWNhdGVkOiAnICsgISEkd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuKTtcclxuICAgICAgICAgICAgcmV0dXJuICEhJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gYXV0aFNlcnZpY2U7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyU2VydmljZSgkaHR0cCwgJHJvb3RTY29wZSwgQ29tbW9uU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIHNlcnZpY2UucmVnaXN0ZXIgPSBmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBDb21tb25TZXJ2aWNlLnBvc3QoXCJyZWdpc3RlclwiLCB1c2VyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB1c2VyU2VydmljZSgkaHR0cCwgJHJvb3RTY29wZSwgU2Vzc2lvbiwgQ29tbW9uU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubGF5b3V0JywgW1xuICAgICAgICAnYXBwLmNvcmUnXG4gICAgXSk7XG59KSgpO1xuIiwiIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0NvTGlzdEN0cmwnLCBDb0xpc3RDdHJsKTtcclxuXHJcbiAgICBDb0xpc3RDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJ2NsaWVudE9yZGVyJywgJ21hcmtldE9yZGVyJ107XHJcblxyXG4gICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICBmdW5jdGlvbiBDb0xpc3RDdHJsKCRzY29wZSwgJHJvb3RTY29wZSwgY2xpZW50T3JkZXIsIG1hcmtldE9yZGVyKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5zZWxlY3RDbyA9IGZ1bmN0aW9uKGNvSWQpIHtcclxuICAgICAgICAgICAgICRyb290U2NvcGUuc2VsZWN0ZWRDbGllbnRPcmRlcklkID0gJHJvb3RTY29wZS5zZWxlY3RlZENsaWVudE9yZGVySWQgPT0gY29JZCA/IFwiXCIgOiBjb0lkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaW5pdFxyXG4gICAgICAgIGNsaWVudE9yZGVyLnF1ZXJ5KHt9LCBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmNsaWVudE9yZGVySXRlbXMgPSByZXM7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmZhY3RvcnkoJ2NsaWVudE9yZGVyJywgY2xpZW50T3JkZXIpO1xyXG5cclxuICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgY2xpZW50T3JkZXIuJGluamVjdCA9IFsnJHJlc291cmNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gY2xpZW50T3JkZXIoJHJlc291cmNlKSB7XHJcbiAgICAgICAgcmV0dXJuICRyZXNvdXJjZSgnd3MvY2xpZW50b3JkZXIvbGlzdCcsIHt9LCB7XHJcbiAgICAgICAgICAgIHF1ZXJ5OiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7fSxcclxuICAgICAgICAgICAgICAgIGlzQXJyYXk6IHRydWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2NvUGllQ3RybCcsIGNvUGllQ3RybCk7XHJcblxyXG4gICAgY29QaWVDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckaHR0cCcsICckd2luZG93JywgJyRjb29raWVzJywgJyRzdGF0ZScsICckaW50ZXJ2YWwnLCAnQVVUSF9FVkVOVFMnLCAnQ29tbW9uU2VydmljZScsICdTZXNzaW9uJywgJ0F1dGhTZXJ2aWNlJywgJ21hcmtldE9yZGVyJ107XHJcblxyXG4gICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICBmdW5jdGlvbiBjb1BpZUN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRodHRwLCAkd2luZG93LCAkY29va2llcywgJHN0YXRlLCAkaW50ZXJ2YWwsIEFVVEhfRVZFTlRTLCBDb21tb25TZXJ2aWNlLCBTZXNzaW9uLCBBdXRoU2VydmljZSwgbWFya2V0T3JkZXIpIHtcclxuXHJcblxyXG4gICAgICAgIHZhciBvcHRpb24gPSB7XHJcbiAgICAgICAgICAgIHRpdGxlOiB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0OiAnTWFya2V0IE9yZGVyIFBpZScsXHJcbiAgICAgICAgICAgICAgICBzdWJ0ZXh0OiAnJyxcclxuICAgICAgICAgICAgICAgIHg6ICdjZW50ZXInXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRvb2x0aXA6IHtcclxuICAgICAgICAgICAgICAgIHRyaWdnZXI6ICdpdGVtJyxcclxuICAgICAgICAgICAgICAgIGZvcm1hdHRlcjogXCJ7YX0gPGJyLz57Yn0gOiB7Y30gKHtkfSUpXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGVnZW5kOiB7XHJcbiAgICAgICAgICAgICAgICBvcmllbnQ6ICd2ZXJ0aWNhbCcsXHJcbiAgICAgICAgICAgICAgICBsZWZ0OiAnbGVmdCcsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBbJ05ZU0UnLCAnTkFTREFRJywgJ1NTRScsICdIS1NFJywgJ1NHU0UnXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXJpZXM6IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnRXhjaGFuZ2UnLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwaWUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJhZGl1czogJzU1JScsXHJcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiBbJzUwJScsICc2MCUnXSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdmFsdWU6IDMzNSwgbmFtZTogJ05ZU0UnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdmFsdWU6IDMxMCwgbmFtZTogJ05BU0RBUScgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogMjM0LCBuYW1lOiAnU1NFJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHZhbHVlOiAxMzUsIG5hbWU6ICdIS1NFJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHZhbHVlOiAxNTQ4LCBuYW1lOiAnU0dTRScgfVxyXG4gICAgICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbVN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtcGhhc2lzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFkb3dCbHVyOiAxMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYWRvd09mZnNldFg6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFkb3dDb2xvcjogJ3JnYmEoMCwgMCwgMCwgMC41KSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBteUNoYXJ0ID0gZWNoYXJ0cy5pbml0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluJykpO1xyXG4gICAgICAgIG15Q2hhcnQuc2V0T3B0aW9uKG9wdGlvbik7XHJcblxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnY29QaWUnLCBjb1BpZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29QaWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGljb246IFwiQFwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnanMvY29tcG9uZW50cy9jby1waWUvY28tcGllLmh0bWwnLFxyXG4gICAgICAgICAgICByZXN0cmljdDogXCJFXCJcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdtYXJrZXRPcmRlcicsIG1hcmtldE9yZGVyKTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIG1hcmtldE9yZGVyLiRpbmplY3QgPSBbJyRyZXNvdXJjZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1hcmtldE9yZGVyKCRyZXNvdXJjZSkge1xyXG4gICAgICAgIHJldHVybiAkcmVzb3VyY2UoJ3dzL21hcmtldG9yZGVyL2xpc3QvOmNvSWQnLCB7IGNvSWQ6ICdAY29JZCcgfSk7XHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb21wb25lbnRzJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdmb290ZXInLCBmb290ZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGZvb3RlcigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgaWNvbjogXCJAXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdqcy9jb21wb25lbnRzL2Zvb3Rlci9mb290ZXIuaHRtbCcsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFFXCJcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIExvZ2luQ3RybCk7XHJcblxyXG4gICAgTG9naW5DdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckaHR0cCcsICckd2luZG93JywgJyRjb29raWVzJywgJyRzdGF0ZScsICdBVVRIX0VWRU5UUycsICdDb21tb25TZXJ2aWNlJywgJ1Nlc3Npb24nLCAnQXV0aFNlcnZpY2UnLCAnTG9naW4nXTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIExvZ2luQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJGh0dHAsICR3aW5kb3csICRjb29raWVzLCAkc3RhdGUsIEFVVEhfRVZFTlRTLCBDb21tb25TZXJ2aWNlLCBTZXNzaW9uLCBBdXRoU2VydmljZSwgTG9naW4pIHtcclxuXHJcbiAgICAgICAgLy8gVE9ETyBjaGVjayBpZiB1c2VyIGlzIExvZ2luXHJcbiAgICAgICAgaWYgKCR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW4gIT0gdW5kZWZpbmVkICYmICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW4gIT0gJycpIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KEFVVEhfRVZFTlRTLmxvZ2luU3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcclxuXHJcbiAgICAgICAgLy8gJHNjb3BlLmFsZXJ0cyA9IFtdXHJcbiAgICAgICAgJHNjb3BlLkFsZXJ0cyA9IHtcclxuICAgICAgICAgICAgaXNTaG93OiBmYWxzZSxcclxuICAgICAgICAgICAgYWxlcnRzOiBbXSxcclxuICAgICAgICAgICAgYWRkOiBmdW5jdGlvbihtc2cpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNTaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWxlcnRzID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFsZXJ0cy5wdXNoKG1zZyk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbihpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWxlcnRzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24odXNlcikge1xyXG5cclxuICAgICAgICAgICAgTG9naW4ubG9naW4odXNlciwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzLnRva2VuICE9IHVuZGVmaW5lZCAmJiByZXMudG9rZW4gIT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAkd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuID0gcmVzLnRva2VuO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSB1c2VyLnVzZXJuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChBVVRIX0VWRU5UUy5sb2dpblN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5BbGVydHMuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkFsZXJ0cy5hZGQoeyB0eXBlOiBcImRhbmdlclwiLCBtc2c6ICdMb2dpbiBmYWlsZWQuIFBsZWFzZSB0cnkgYWdhaW4uJyB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuQWxlcnRzLmFkZCh7IHR5cGU6IFwiZGFuZ2VyXCIsIG1zZzogcmVzLmRhdGEucmVhc29uIHx8IFwiTG9naW4gZmFpbGVkLlwiIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnbG9naW5QYW5lbCcsIGxvZ2luUGFuZWwpO1xyXG5cclxuICAgIGxvZ2luUGFuZWwuJGluamVjdCA9IFsnJGNvbXBpbGUnXTtcclxuICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgZnVuY3Rpb24gbG9naW5QYW5lbCgkY29tcGlsZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHNjb3BlOiAnQCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnanMvY29tcG9uZW50cy9sb2dpbi1wYW5lbC9sb2dpbi1wYW5lbC5odG1sJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHNjb3BlLm5hbWUgPSBcImhlbFwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0xvZ2luJywgTG9naW4pO1xyXG5cclxuICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgTG9naW4uJGluamVjdCA9IFsnJHJlc291cmNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTG9naW4oJHJlc291cmNlKSB7XHJcbiAgICAgICAgcmV0dXJuICRyZXNvdXJjZSgnd3MvbG9naW4nLCB7fSwge1xyXG4gICAgICAgICAgICBsb2dpbjoge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHt9LFxyXG4gICAgICAgICAgICAgICAgaXNBcnJheTogZmFsc2VcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ01vTGlzdEN0cmwnLCBNb0xpc3RDdHJsKTtcclxuXHJcbiAgICBNb0xpc3RDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckaHR0cCcsICckd2luZG93JywgJyRjb29raWVzJywgJyRzdGF0ZScsICckaW50ZXJ2YWwnLCAnQVVUSF9FVkVOVFMnLCAnQ29tbW9uU2VydmljZScsICdTZXNzaW9uJywgJ0F1dGhTZXJ2aWNlJywgJ21hcmtldE9yZGVyJ107XHJcblxyXG4gICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICBmdW5jdGlvbiBNb0xpc3RDdHJsKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkaHR0cCwgJHdpbmRvdywgJGNvb2tpZXMsICRzdGF0ZSwgJGludGVydmFsLCBBVVRIX0VWRU5UUywgQ29tbW9uU2VydmljZSwgU2Vzc2lvbiwgQXV0aFNlcnZpY2UsIG1hcmtldE9yZGVyKSB7XHJcblxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCRyb290U2NvcGUubW9MaXN0KVxyXG4gICAgICAgIC8vICRzY29wZS5tb0xpc3QgPSBbXTtcclxuICAgICAgICAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkcm9vdFNjb3BlLnNlbGVjdGVkQ2xpZW50T3JkZXJJZCAhPSAnJyAmJiAkcm9vdFNjb3BlLnNlbGVjdGVkQ2xpZW50T3JkZXJJZCAhPSB1bmRlZmluZWQgJiYgQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpIHtcclxuICAgICAgICAgICAgICAgIG1hcmtldE9yZGVyLnF1ZXJ5KHsgY29JZDogJHJvb3RTY29wZS5zZWxlY3RlZENsaWVudE9yZGVySWQgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1vTGlzdCA9IHJlcztcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIDEwMDApO1xyXG5cclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ21hcmtldE9yZGVyTGlzdCcsIG1hcmtldE9yZGVyTGlzdCk7XHJcblxyXG4gICAgZnVuY3Rpb24gbWFya2V0T3JkZXJMaXN0KCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBpY29uOiBcIkBcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL2NvbXBvbmVudHMvbWFya2V0LW9yZGVyLWxpc3QvbWFya2V0LW9yZGVyLWxpc3QuaHRtbCcsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIlxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY29tcG9uZW50cycpXHJcbiAgICAgICAgLmZhY3RvcnkoJ21hcmtldE9yZGVyJywgbWFya2V0T3JkZXIpO1xyXG5cclxuICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgbWFya2V0T3JkZXIuJGluamVjdCA9IFsnJHJlc291cmNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFya2V0T3JkZXIoJHJlc291cmNlKSB7XHJcbiAgICAgICAgcmV0dXJuICRyZXNvdXJjZSgnd3MvbWFya2V0b3JkZXIvbGlzdC86Y29JZCcsIHsgY29JZDogJ0Bjb0lkJyB9KTtcclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBAYXV0aG9yIFNoYXduXHJcbiAqIEBkZXNjIENvbnRyb2xsZXJzIG9mIHRoZSBtYWluQVBQXHJcbiAqL1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb21wb25lbnRzJylcclxuICAgICAgICAuY29udHJvbGxlcigndGVzdEN0cmwnLCB0ZXN0Q3RybCk7XHJcblxyXG4gICAgdGVzdEN0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJyRodHRwJywgJ0FVVEhfRVZFTlRTJywgJ0F1dGhTZXJ2aWNlJ107XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIHRlc3RDdHJsKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkaHR0cCwgQVVUSF9FVkVOVFMsIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgICAgJHNjb3BlLm9iaiA9IHtcclxuICAgICAgICAgICAgdXJsOiBcInVzZXIvbG9naW4uZG9cIixcclxuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgZGF0YTogXCJcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnRlc3QgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgdmFyIGFhID0gKEpTT04ucGFyc2Uob2JqLmRhdGEpKTtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc3VsdCA9IHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdDogXCJcIixcclxuICAgICAgICAgICAgICAgIHN0YXR1czogXCJcIixcclxuICAgICAgICAgICAgICAgIG1zZzogXCJcIixcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFwiXCJcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiBvYmoudXJsLFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiBvYmoubWV0aG9kLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogc2VyaWFsaXplRGF0YShhYSlcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0LnJlc3VsdCA9IFwiUmVxIFN1Y2Nlc3NcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSByZXM7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSByZXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0LnJlc3VsdCA9IFwiUmVxIEZhaWxcIjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIvKipcclxuICogQGF1dGhvciBTaGF3blxyXG4gKiBAZGVzYyBDb250cm9sbGVycyBvZiB0aGUgbWFpbkFQUFxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCd0ZXN0Q3RybCcsIHRlc3RDdHJsKTtcclxuXHJcbiAgICB0ZXN0Q3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCAnQVVUSF9FVkVOVFMnLCAnQXV0aFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiB0ZXN0Q3RybCgkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJGh0dHAsIEFVVEhfRVZFTlRTLCBBdXRoU2VydmljZSkge1xyXG4gICAgICAgICRzY29wZS5vYmogPSB7XHJcbiAgICAgICAgICAgIHVybDogXCJ1c2VyL2xvZ2luLmRvXCIsXHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIGRhdGE6IFwiXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS50ZXN0ID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHZhciBhYSA9IChKU09OLnBhcnNlKG9iai5kYXRhKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQ6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBtc2c6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiBcIlwiXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIHVybDogb2JqLnVybCxcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogb2JqLm1ldGhvZCxcclxuICAgICAgICAgICAgICAgIGRhdGE6IHNlcmlhbGl6ZURhdGEoYWEpXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc3VsdC5yZXN1bHQgPSBcIlJlcSBTdWNjZXNzXCI7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0gcmVzO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc3VsdC5yZXN1bHQgPSBcIlJlcSBGYWlsXCI7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIEBhdXRob3IgU2hhd25cclxuICogQGRlc2MgQ29udHJvbGxlcnMgb2YgdGhlIG1haW5BUFBcclxuICovXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbXBvbmVudHMnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCd1c2VyQ3RybCcsIHVzZXJDdHJsKTtcclxuXHJcbiAgICB1c2VyQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnU2Vzc2lvbicsICdBVVRIX0VWRU5UUycsICdBdXRoU2VydmljZSddO1xyXG4gICAgZnVuY3Rpb24gdXNlckN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIFNlc3Npb24sIEFVVEhfRVZFTlRTLCBBdXRoU2VydmljZSkge1xyXG4gICAgICAgICRzY29wZS4kb24oQVVUSF9FVkVOVFMubG9nb3V0U3VjY2VzcywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoIUF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidXNlciBuZWVkIGxvZ2luXCIpO1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9sb2dpblwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmxheW91dCcpXHJcbiAgICAgICAgLy8gZGFzaGJvYXJkIFNpZGViYXJcclxuICAgICAgICAuY29udHJvbGxlcihcIk1hc3RlckN0cmxcIiwgTWFzdGVyQ3RybCk7XHJcblxyXG4gICAgTWFzdGVyQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGNvb2tpZXNcIl07XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIE1hc3RlckN0cmwoJHNjb3BlLCAkY29va2llcykge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNpZGViYXIgVG9nZ2xlICYgQ29va2llcyBDb250cm9sXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIG1vYmlsZVZpZXcgPSA5OTI7XHJcbiAgICAgICAgJHNjb3BlLmdldFdpZHRoID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS4kd2F0Y2goJHNjb3BlLmdldFdpZHRoLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKG5ld1ZhbHVlID49IG1vYmlsZVZpZXcpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCgkY29va2llcy5nZXQoJ3RvZ2dsZScpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50b2dnbGUgPSAhJGNvb2tpZXMuZ2V0KCd0b2dnbGUnKSA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAkc2NvcGUudG9nZ2xlU2lkZWJhciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlID0gISRzY29wZS50b2dnbGU7XHJcbiAgICAgICAgICAgICRjb29raWVzLnB1dCgndG9nZ2xlJywgJHNjb3BlLnRvZ2dsZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB3aW5kb3cub25yZXNpemUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdBbGVydHNDdHJsJywgQWxlcnRzQ3RybCk7XHJcblxyXG4gICAgQWxlcnRzQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnXTtcclxuICAgIGZ1bmN0aW9uIEFsZXJ0c0N0cmwoJHNjb3BlKSB7XHJcbiAgICAgICAgJHNjb3BlLmFsZXJ0cyA9IFt7XHJcbiAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcclxuICAgICAgICAgICAgbXNnOiAnVGhhbmtzIGZvciB2aXNpdGluZyEgRmVlbCBmcmVlIHRvIGNyZWF0ZSBwdWxsIHJlcXVlc3RzIHRvIGltcHJvdmUgdGhlIGRhc2hib2FyZCEnXHJcbiAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ2RhbmdlcicsXHJcbiAgICAgICAgICAgICAgICBtc2c6ICdGb3VuZCBhIGJ1Zz8gQ3JlYXRlIGFuIGlzc3VlIHdpdGggYXMgbWFueSBkZXRhaWxzIGFzIHlvdSBjYW4uJ1xyXG4gICAgICAgICAgICB9XTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmFkZEFsZXJ0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5hbGVydHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBtc2c6ICdBbm90aGVyIGFsZXJ0ISdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmNsb3NlQWxlcnQgPSBmdW5jdGlvbihpbmRleCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuYWxlcnRzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoXCJyZExvYWRpbmdcIiwgcmRMb2FkaW5nKTtcclxuXHJcbiAgICBmdW5jdGlvbiByZExvYWRpbmcoKSB7XHJcbiAgICAgICAgdmFyIGQgPSB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFFXCIsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cImxvYWRpbmdcIj48ZGl2IGNsYXNzPVwiZG91YmxlLWJvdW5jZTFcIj48L2Rpdj48ZGl2IGNsYXNzPVwiZG91YmxlLWJvdW5jZTJcIj48L2Rpdj48L2Rpdj4nXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZFxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAud2lkZ2V0cycpXHJcbiAgICAgICAgLy8gYW5ndWxhci11aSBNb2RhbFxyXG4gICAgICAgIC5jb250cm9sbGVyKCdNb2RhbERlbW9DdHJsJywgTW9kYWxEZW1vQ3RybCk7XHJcblxyXG4gICAgTW9kYWxEZW1vQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHVpYk1vZGFsJywgJyRsb2cnXTtcclxuICAgIGZ1bmN0aW9uIE1vZGFsRGVtb0N0cmwoJHNjb3BlLCAkdWliTW9kYWwsICRsb2cpIHtcclxuICAgICAgICAkc2NvcGUuaXRlbXMgPSBbJ2l0ZW0xJywgJ2l0ZW0yJywgJ2l0ZW0zJ107XHJcbiAgICAgICAgJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAkc2NvcGUub3BlbiA9IGZ1bmN0aW9uKHNpemUpIHtcclxuICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246ICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbXlNb2RhbENvbnRlbnQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTW9kYWxJbnN0YW5jZUN0cmwnLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogc2l6ZSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtczogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJGxvZy5pbmZvKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUudG9nZ2xlQW5pbWF0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCA9ICEkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG5cclxuICAgICAgICAvLyBQbGVhc2Ugbm90ZSB0aGF0ICR1aWJNb2RhbEluc3RhbmNlIHJlcHJlc2VudHMgYSBtb2RhbCB3aW5kb3cgKGluc3RhbmNlKSBkZXBlbmRlbmN5LlxyXG4gICAgICAgIC8vIEl0IGlzIG5vdCB0aGUgc2FtZSBhcyB0aGUgJHVpYk1vZGFsIHNlcnZpY2UgdXNlZCBhYm92ZS5cclxuICAgICAgICAvLyBhbmd1bGFyLXVpIE1vZGFsXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ01vZGFsSW5zdGFuY2VDdHJsJywgTW9kYWxJbnN0YW5jZUN0cmwpO1xyXG5cclxuICAgIE1vZGFsSW5zdGFuY2VDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckdWliTW9kYWxJbnN0YW5jZScsICdpdGVtcyddO1xyXG4gICAgZnVuY3Rpb24gTW9kYWxJbnN0YW5jZUN0cmwoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgaXRlbXMpIHtcclxuICAgICAgICAkc2NvcGUuaXRlbXMgPSBpdGVtcztcclxuICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSB7XHJcbiAgICAgICAgICAgIGl0ZW06ICRzY29wZS5pdGVtc1swXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5vayA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuc2VsZWN0ZWQuaXRlbSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAud2lkZ2V0cycpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgncmRXaWRnZXQnLCByZFdpZGdldCk7XHJcblxyXG4gICAgZnVuY3Rpb24gcmRXaWRnZXQoKSB7XHJcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwid2lkZ2V0XCIgbmctdHJhbnNjbHVkZT48L2Rpdj4nLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgLyogKi9cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxufSkoKTtcclxuIiwiXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG5cclxuICAgICAgICAvLyBhbmd1bGFyLXVpIHByb2dyZXNzQmFyXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1Byb2dyZXNzRGVtb0N0cmwnLCBQcm9ncmVzc0RlbW9DdHJsKTtcclxuICAgIFByb2dyZXNzRGVtb0N0cmwuJGluamVjdCA9IFsnJHNjb3BlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gUHJvZ3Jlc3NEZW1vQ3RybCgkc2NvcGUpIHtcclxuICAgICAgICAkc2NvcGUubWF4ID0gMjAwO1xyXG5cclxuICAgICAgICAkc2NvcGUucmFuZG9tID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCArIDEpO1xyXG4gICAgICAgICAgICB2YXIgdHlwZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA8IDI1KSB7XHJcbiAgICAgICAgICAgICAgICB0eXBlID0gJ3dhcm5pbmcnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgNTApIHtcclxuICAgICAgICAgICAgICAgIHR5cGUgPSAnaW5mbyc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPCA3NSkge1xyXG4gICAgICAgICAgICAgICAgdHlwZSA9ICdzdWNjZXNzJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHR5cGUgPSAnc3VjY2Vzcyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zaG93V2FybmluZyA9IHR5cGUgPT09ICdkYW5nZXInIHx8IHR5cGUgPT09ICd3YXJuaW5nJztcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5keW5hbWljID0gdmFsdWU7XHJcbiAgICAgICAgICAgICRzY29wZS50eXBlID0gdHlwZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUucmFuZG9tKCk7XHJcblxyXG4gICAgICAgICRzY29wZS5yYW5kb21TdGFja2VkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5zdGFja2VkID0gW107XHJcbiAgICAgICAgICAgIHZhciB0eXBlcyA9IFsnc3VjY2VzcycsICdpbmZvJywgJ3dhcm5pbmcnLCAnZGFuZ2VyJ107XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQgKyAxKTsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhY2tlZC5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMzAgKyAxKSxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlc1tpbmRleF1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJhbmRvbVN0YWNrZWQoKTtcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwLndpZGdldHMnKVxyXG4gICAgLmRpcmVjdGl2ZShcInJkV2lkZ2V0Qm9keVwiLCByZFdpZGdldEJvZHkpO1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiByZFdpZGdldEJvZHkoKSB7XHJcbiAgICAgICAgdmFyIGQgPSB7XHJcbiAgICAgICAgICAgIHJlcXVpcmVzOiBcIl5yZFdpZGdldFwiLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgbG9hZGluZzogXCJAP1wiLFxyXG4gICAgICAgICAgICAgICAgY2xhc3NlczogXCJAP1wiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6ICEwLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ3aWRnZXQtYm9keVwiIG5nLWNsYXNzPVwiY2xhc3Nlc1wiPjxyZC1sb2FkaW5nIG5nLXNob3c9XCJsb2FkaW5nXCI+PC9yZC1sb2FkaW5nPjxkaXYgbmctaGlkZT1cImxvYWRpbmdcIiBjbGFzcz1cIndpZGdldC1jb250ZW50XCIgbmctdHJhbnNjbHVkZT48L2Rpdj48L2Rpdj4nLFxyXG4gICAgICAgICAgICByZXN0cmljdDogXCJFXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkXHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAud2lkZ2V0cycpXHJcbiAgICAuZGlyZWN0aXZlKFwicmRXaWRnZXRGb290ZXJcIiwgcmRXaWRnZXRGb290ZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHJkV2lkZ2V0Rm9vdGVyKCkge1xyXG4gICAgICAgIHZhciBlID0ge1xyXG4gICAgICAgICAgICByZXF1aXJlczogXCJecmRXaWRnZXRcIixcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogITAsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIndpZGdldC1mb290ZXJcIiBuZy10cmFuc2NsdWRlPjwvZGl2PicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGVcclxuICAgIH1cclxuXHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC53aWRnZXRzJylcclxuICAgICAgICAuZGlyZWN0aXZlKFwicmRXaWRnZXRIZWFkZXJcIiwgcmRXaWRnZXRUaXRsZSk7XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIHJkV2lkZ2V0VGl0bGUoKSB7XHJcbiAgICAgICAgdmFyIGUgPSB7XHJcbiAgICAgICAgICAgIHJlcXVpcmVzOiBcIl5yZFdpZGdldFwiLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiQFwiLFxyXG4gICAgICAgICAgICAgICAgaWNvbjogXCJAXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogITAsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIndpZGdldC1oZWFkZXJcIj48aSBjbGFzcz1cImZhXCIgbmctY2xhc3M9XCJpY29uXCI+PC9pPiB7e3RpdGxlfX0gPGRpdiBjbGFzcz1cInB1bGwtcmlnaHRcIiBuZy10cmFuc2NsdWRlPjwvZGl2PjwvZGl2PicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGVcclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
