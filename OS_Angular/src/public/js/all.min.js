/**
 * @author Shawn
 * @desc mainAPP
 */
(function() {
    'use strict';

    angular.module('mainApp', ['ui.router', 'ui.bootstrap','ngCookies', 'ngAnimate', 'router', 'ctrls', 'services', 'filters', 'directives'])

        // Global
        .constant('WEB_INFO', {
            title: 'Order Management System'
        })

        .constant('AUTH_EVENTS', {
            loginSuccess: 'auth-login-success',
            loginFailed: 'auth-login-failed',
            logoutSuccess: 'auth-logout-success',
            sessionTimeout: 'auth-session-timeout',
            notAuthenticated: 'auth-not-authenticated',
            pageNotFound: 'page-not-found',
            serverError: 'server-error'
        })

        // Do auth when state/url change
        .run(function($rootScope, AUTH_EVENTS, AuthService, Session) {
            $rootScope.$on('$stateChangeStart', function(event, next) {
                if (!AuthService.isAuthenticated()) {
                    $rootScope.$broadcast(AUTH_EVENTS.notAuthenticated);
                } else {
                    $rootScope.currentUser = Session.getUserName();
                }
            });
        })

})();

(function() {
    'use strict';

    angular.module('app', [
        'app.core',
        'app.widgets',
        'app.admin',
        'app.dashboard',
        'app.layout'
    ]);

})();

// (function() {
//     angular.module('ctrls', []);
// })();
/**
 * @author Shawn
 * @desc mainAPP
 */
(function() {
    'use strict';

    angular.module('router', [])

    .config(function($stateProvider, $httpProvider, $urlRouterProvider, $locationProvider) {

        // Interceptor of Requests
        $httpProvider.interceptors.push([
            '$injector',
            function($injector) {
                return $injector.get('AuthInterceptor');
            }
        ]);

        $locationProvider.html5Mode({
            enabled: false,
            requireBase: false
        });

        // For any unmatched url, redirect to /
        $urlRouterProvider.otherwise('login');


        // loginregister
        $stateProvider

        // main page
        .state('home', {
            url: '/',
            templateUrl: 'views/home.html',
            controller: 'indexCtrl'
        })

        .state("home.dash1", {
            url: "dash1",
            templateUrl: "views/rdash/dashboard.html"
        }).state("home.order", {
            url: "order",
            templateUrl: "views/rdash/order-list.html"
        }).state("home.dash2", {
            url: "dash2",
            templateUrl: "views/rdash/tables.html"
        })

        .state('login', {
            url: '/login',
            templateUrl: 'views/login.html'
        }).state('register', {
            url: '/register',
            templateUrl: 'views/register.html'
        })

        // User Account
        .state('account', {
            url: '/account',
            templateUrl: 'views/account/account.html'
        }).state('account.me', {
            url: '/me',
            templateUrl: 'views/account/account.me.html'
        }).state('account.charge', {
            url: '/charge',
            templateUrl: 'views/account/account.charge.html',
            controller: 'chargeCtrl'
        }).state('account.card', {
            url: '/card',
            templateUrl: 'views/account/account.card.html'
        }).state('account.coupons', {
            url: '/coupons',
            templateUrl: 'views/account/account.coupons.html'
        }).state('account.deposit', {
            url: '/deposit',
            templateUrl: 'views/account/account.deposit.html'
        }).state('account.gold', {
            url: '/gold',
            templateUrl: 'views/account/account.gold.html'
        }).state('account.reserve', {
            url: '/reserve',
            templateUrl: 'views/account/account.reserve.html'
        }).state('account.transaction', {
            url: '/transaction',
            templateUrl: 'views/account/account.transaction.html'
        }).state('account.withdraw', {
            url: '/withdraw',
            templateUrl: 'views/account/account.withdraw.html'
        })

        // for test
        .state('test', {
            url: '/test',
            templateUrl: 'views/test-angular-ui-bootstrap.html',
            controller: 'testCtrl'
        })
    });
})();

// 序列化对象
// 示例: {addr.location:a,addr.number:b} ==> addr%5Blocation%5D=a&addr%5Bnumber%5D=b
serializeData = function(obj, prefix) {
    var str = [];
    for (var p in obj) {
        if (obj.constructor === Array) {
            console.log(obj);
            var k = prefix ? prefix + "[" + p + "]" : p,
                v = obj[p];
            str.push(typeof v == "object" ?
                serializeData(v, k) :
                encodeURIComponent(k) + "=" + encodeURIComponent(v));
        } else if (obj.hasOwnProperty(p)) {
            //   var k = prefix ? prefix + "[" + p + "]" : p, v = obj[p];
            var k = prefix ? prefix + "." + p : p,
                v = obj[p];
            str.push(typeof v == "object" ?
                serializeData(v, k) :
                encodeURIComponent(k) + "=" + encodeURIComponent(v));
        }
    }
    return str.join("&");
}

// 转化百分数(或不带百分号)至小数
// 示例: 35% ==> 0.35
percentToNum = function(param) {
    param = param.toString().replace('%', '');
    if (param != undefined && isNaN(param) == false) {
        return param * 1000 / 100000;
    } else {
        return '';
    }
}

/**
*  Secure Hash Algorithm (SHA256)
*  http://www.webtoolkit.info/
*  Original code by Angel Marin, Paul Johnston.
**/
var SHA256 = function(s) {var chrsz = 8;var hexcase = 0;function safe_add(x, y) {var lsw = (x & 0xFFFF) + (y & 0xFFFF);var msw = (x >> 16) + (y >> 16) + (lsw >> 16);return (msw << 16) | (lsw & 0xFFFF);}function S(X, n) {return (X >>> n) | (X << (32 - n));}function R(X, n) {return (X >>> n);}function Ch(x, y, z) {return ((x & y) ^ ((~x) & z));}function Maj(x, y, z) {return ((x & y) ^ (x & z) ^ (y & z));}function Sigma0256(x) {return (S(x, 2) ^ S(x, 13) ^ S(x, 22));}function Sigma1256(x) {return (S(x, 6) ^ S(x, 11) ^ S(x, 25));}function Gamma0256(x) {return (S(x, 7) ^ S(x, 18) ^ R(x, 3));}function Gamma1256(x) {return (S(x, 17) ^ S(x, 19) ^ R(x, 10));}function core_sha256(m, l) {var K = new Array(0x428A2F98, 0x71374491, 0xB5C0FBCF, 0xE9B5DBA5, 0x3956C25B, 0x59F111F1, 0x923F82A4, 0xAB1C5ED5, 0xD807AA98, 0x12835B01, 0x243185BE, 0x550C7DC3, 0x72BE5D74, 0x80DEB1FE, 0x9BDC06A7, 0xC19BF174, 0xE49B69C1, 0xEFBE4786, 0xFC19DC6, 0x240CA1CC, 0x2DE92C6F, 0x4A7484AA, 0x5CB0A9DC, 0x76F988DA, 0x983E5152, 0xA831C66D, 0xB00327C8, 0xBF597FC7, 0xC6E00BF3, 0xD5A79147, 0x6CA6351, 0x14292967, 0x27B70A85, 0x2E1B2138, 0x4D2C6DFC, 0x53380D13, 0x650A7354, 0x766A0ABB, 0x81C2C92E, 0x92722C85, 0xA2BFE8A1, 0xA81A664B, 0xC24B8B70, 0xC76C51A3, 0xD192E819, 0xD6990624, 0xF40E3585, 0x106AA070, 0x19A4C116, 0x1E376C08, 0x2748774C, 0x34B0BCB5, 0x391C0CB3, 0x4ED8AA4A, 0x5B9CCA4F, 0x682E6FF3, 0x748F82EE, 0x78A5636F, 0x84C87814, 0x8CC70208, 0x90BEFFFA, 0xA4506CEB, 0xBEF9A3F7, 0xC67178F2);var HASH = new Array(0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19);var W = new Array(64);var a, b, c, d, e, f, g, h, i, j;var T1, T2;m[l >> 5] |= 0x80 << (24 - l % 32);m[((l + 64 >> 9) << 4) + 15] = l;for (var i = 0; i < m.length; i += 16) {a = HASH[0];b = HASH[1];c = HASH[2];d = HASH[3];e = HASH[4];f = HASH[5];g = HASH[6];h = HASH[7];for (var j = 0; j < 64; j++) {if (j < 16) W[j] = m[j + i];else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);T2 = safe_add(Sigma0256(a), Maj(a, b, c));h = g;g = f;f = e;e = safe_add(d, T1);d = c;c = b;b = a;a = safe_add(T1, T2);}HASH[0] = safe_add(a, HASH[0]);HASH[1] = safe_add(b, HASH[1]);HASH[2] = safe_add(c, HASH[2]);HASH[3] = safe_add(d, HASH[3]);HASH[4] = safe_add(e, HASH[4]);HASH[5] = safe_add(f, HASH[5]);HASH[6] = safe_add(g, HASH[6]);HASH[7] = safe_add(h, HASH[7]);}return HASH;}function str2binb(str) {var bin = Array();var mask = (1 << chrsz) - 1;for (var i = 0; i < str.length * chrsz; i += chrsz) {bin[i >> 5] |= (str.charCodeAt(i / chrsz) & mask) << (24 - i % 32);}return bin;}function Utf8Encode(string) {string = string.replace(/rn/g, "n");var utftext = "";for (var n = 0; n < string.length; n++) {var c = string.charCodeAt(n);if (c < 128) {utftext += String.fromCharCode(c);} else if ((c > 127) && (c < 2048)) {utftext += String.fromCharCode((c >> 6) | 192);utftext += String.fromCharCode((c & 63) | 128);} else {utftext += String.fromCharCode((c >> 12) | 224);utftext += String.fromCharCode(((c >> 6) & 63) | 128);utftext += String.fromCharCode((c & 63) | 128);}}return utftext;}function binb2hex(binarray) {var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";var str = "";for (var i = 0; i < binarray.length * 4; i++) {str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) + hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);}return str;}s = Utf8Encode(s);return binb2hex(core_sha256(str2binb(s), s.length * chrsz));}

/**
*  Secure Hash Algorithm (SHA1)
*  http://www.webtoolkit.info/
**/
var SHA1 = function(msg) {function rotate_left(n,s) {var t4 = ( n<<s ) | (n>>>(32-s));return t4;};function lsb_hex(val) {var str="";var i;var vh;var vl;for( i=0; i<=6; i+=2 ) {vh = (val>>>(i*4+4))&0x0f;vl = (val>>>(i*4))&0x0f;str += vh.toString(16) + vl.toString(16);}return str;};function cvt_hex(val) {var str="";var i;var v;for( i=7; i>=0; i-- ) {v = (val>>>(i*4))&0x0f;str += v.toString(16);}return str;};function Utf8Encode(string) {string = string.replace(/rn/g,"n");var utftext = "";for (var n = 0; n < string.length; n++) {var c = string.charCodeAt(n);if (c < 128) {utftext += String.fromCharCode(c);}else if((c > 127) && (c < 2048)) {utftext += String.fromCharCode((c >> 6) | 192);utftext += String.fromCharCode((c & 63) | 128);}else {utftext += String.fromCharCode((c >> 12) | 224);utftext += String.fromCharCode(((c >> 6) & 63) | 128);utftext += String.fromCharCode((c & 63) | 128);}}return utftext;};var blockstart;var i, j;var W = new Array(80);var H0 = 0x67452301;var H1 = 0xEFCDAB89;var H2 = 0x98BADCFE;var H3 = 0x10325476;var H4 = 0xC3D2E1F0;var A, B, C, D, E;var temp;msg = Utf8Encode(msg);var msg_len = msg.length;var word_array = new Array();for( i=0; i<msg_len-3; i+=4 ) {j = msg.charCodeAt(i)<<24 | msg.charCodeAt(i+1)<<16 |msg.charCodeAt(i+2)<<8 | msg.charCodeAt(i+3);word_array.push( j );}switch( msg_len % 4 ) {case 0:i = 0x080000000;break;case 1:i = msg.charCodeAt(msg_len-1)<<24 | 0x0800000;break;case 2:i = msg.charCodeAt(msg_len-2)<<24 | msg.charCodeAt(msg_len-1)<<16 | 0x08000;break;case 3:i = msg.charCodeAt(msg_len-3)<<24 | msg.charCodeAt(msg_len-2)<<16 | msg.charCodeAt(msg_len-1)<<8 | 0x80;break;}word_array.push( i );while( (word_array.length % 16) != 14 ) word_array.push( 0 );word_array.push( msg_len>>>29 );word_array.push( (msg_len<<3)&0x0ffffffff );for ( blockstart=0; blockstart<word_array.length; blockstart+=16 ) {for( i=0; i<16; i++ ) W[i] = word_array[blockstart+i];for( i=16; i<=79; i++ ) W[i] = rotate_left(W[i-3] ^ W[i-8] ^ W[i-14] ^ W[i-16], 1);A = H0;B = H1;C = H2;D = H3;E = H4;for( i= 0; i<=19; i++ ) {temp = (rotate_left(A,5) + ((B&C) | (~B&D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}for( i=20; i<=39; i++ ) {temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}for( i=40; i<=59; i++ ) {temp = (rotate_left(A,5) + ((B&C) | (B&D) | (C&D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}for( i=60; i<=79; i++ ) {temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;E = D;D = C;C = rotate_left(B,30);B = A;A = temp;}H0 = (H0 + A) & 0x0ffffffff;H1 = (H1 + B) & 0x0ffffffff;H2 = (H2 + C) & 0x0ffffffff;H3 = (H3 + D) & 0x0ffffffff;H4 = (H4 + E) & 0x0ffffffff;}var temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);return temp.toLowerCase();}


// Grab the files and set them to our variable
// ========================================================================================
// <input id="fileupload" type="file" class="" name="files[]" data-url="upload.do" multiple>
function prepareUpload(event) {
    var ele = $(this).siblings('.hidden')[0];
    uploadFiles(event.target.files, ele);

    // ele.value = resFileId;
    //
    // try {
    //     var resFileId = uploadFiles(event.target.files);
    //     var ele = $(this).siblings('.hidden')[0].value;
    //     var array = ele == ""? [] : ele.split(',') ;
    // } catch (e) {
    //     console.log(e);
    // } finally {
    //     console.log(array);
    //     array.push(resFileId);
    //     console.log(array);
    //     ele.value = array.join(',')).trigger('input';
    // }

    // ele.val(ele.val().split(',').push(resId).join(',')).trigger('input');

    // $(this).siblings('.hidden').val(uploadFiles(event.target.files)).trigger('input');
}


/**
 * @param files 需要上传的文件
 * @param ele 上传成功后接收返回文件ID的元素
 * @desc 文件上传模块, 设置返回id后，使用trigger('input')使ng-model能收到值
 */
function uploadFiles(files, ele) {
    // Create a formdata object and add the files
    var data = new FormData();
    $.each(files, function(key, value) {
        data.append("files", value);
    });

    console.log(files)

    $.ajax({
        url: 'upload.do',
        type: 'POST',
        data: data,
        cache: false,
        dataType: 'json',
        processData: false, // Don't process the files
        contentType: false, // Set content type to false as jQuery will tell the server its a query string request
        success: function(data, textStatus, jqXHR) {
            if (typeof data.error === 'undefined') {
                // Success so call function to process the form
                fileid = data.content.name;
                ele.value = data.content.name;
                $(ele).trigger('input');
                // submitForm(event, data);
            } else {
                // Handle errors here
                console.log('ERRORS: ' + data.error);
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // Handle errors here
            console.log('ERRORS: ' + textStatus);
            // STOP LOADING SPINNER
        }
    });
}

// angular.module('ctrls')
//     .controller('AlertsCtrl', AlertsCtrl);

// function AlertsCtrl($scope) {
//     $scope.alerts = [{
//         type: 'success',
//         msg: 'Thanks for visiting! Feel free to create pull requests to improve the dashboard!'
//     }, {
//             type: 'danger',
//             msg: 'Found a bug? Create an issue with as many details as you can.'
//         }];

//     $scope.addAlert = function() {
//         $scope.alerts.push({
//             msg: 'Another alert!'
//         });
//     };

//     $scope.closeAlert = function(index) {
//         $scope.alerts.splice(index, 1);
//     };
// }

(function() {
    'use strict';

    angular.module('ctrls')
        // angular-ui Modal
        .controller('ModalDemoCtrl', ModalDemoCtrl);

    function ModalDemoCtrl($scope, $uibModal, $log) {
        $scope.items = ['item1', 'item2', 'item3'];
        $scope.animationsEnabled = true;
        $scope.open = function(size) {
            var modalInstance = $uibModal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'myModalContent.html',
                controller: 'ModalInstanceCtrl',
                size: size,
                resolve: {
                    items: function() {
                        return $scope.items;
                    }
                }
            });

            modalInstance.result.then(function(selectedItem) {
                $scope.selected = selectedItem;
            }, function() {
                $log.info('Modal dismissed at: ' + new Date());
            });
        };
        $scope.toggleAnimation = function() {
            $scope.animationsEnabled = !$scope.animationsEnabled;
        };

    }
})();

(function() {
    'use strict';

    angular.module('ctrls')

        // Please note that $uibModalInstance represents a modal window (instance) dependency.
        // It is not the same as the $uibModal service used above.
        // angular-ui Modal
        .controller('ModalInstanceCtrl', function($scope, $uibModalInstance, items) {
            $scope.items = items;
            $scope.selected = {
                item: $scope.items[0]
            };

            $scope.ok = function() {
                $uibModalInstance.close($scope.selected.item);
            };

            $scope.cancel = function() {
                $uibModalInstance.dismiss('cancel');
            };
        })

})();

(function() {
    'use strict';

    angular.module('ctrls')

        // angular-ui progressBar
        .controller('ProgressDemoCtrl', function($scope) {
            $scope.max = 200;

            $scope.random = function() {
                var value = Math.floor(Math.random() * 100 + 1);
                var type;

                if (value < 25) {
                    type = 'warning';
                } else if (value < 50) {
                    type = 'info';
                } else if (value < 75) {
                    type = 'success';
                } else {
                    type = 'success';
                }

                $scope.showWarning = type === 'danger' || type === 'warning';

                $scope.dynamic = value;
                $scope.type = type;
            };

            $scope.random();

            $scope.randomStacked = function() {
                $scope.stacked = [];
                var types = ['success', 'info', 'warning', 'danger'];

                for (var i = 0, n = Math.floor(Math.random() * 4 + 1); i < n; i++) {
                    var index = Math.floor(Math.random() * 4);
                    $scope.stacked.push({
                        value: Math.floor(Math.random() * 30 + 1),
                        type: types[index]
                    });
                }
            };

            $scope.randomStacked();
        })
})();
(function() {
    'use strict';

    angular.module('ctrls')
        // dashboard Sidebar
        .controller("MasterCtrl", ["$scope", "$cookies", function($scope, $cookies) {
            /**
             * Sidebar Toggle & Cookies Control
             */
            var mobileView = 992;
            $scope.getWidth = function() {
                return window.innerWidth;
            };
            $scope.$watch($scope.getWidth, function(newValue, oldValue) {
                if (newValue >= mobileView) {
                    if (angular.isDefined($cookies.get('toggle'))) {
                        $scope.toggle = !$cookies.get('toggle') ? true : false;
                    } else {
                        $scope.toggle = false;
                    }
                } else {
                    $scope.toggle = true;
                }
            });
            $scope.toggleSidebar = function() {
                $scope.toggle = !$scope.toggle;
                $cookies.put('toggle', $scope.toggle);
            };
            window.onresize = function() {
                $scope.$apply();
            };
        }])
        
        
})();
/**
 * @author Shawn
 * @desc Controllers of the mainAPP
 */
(function() {
    'use strict';

    angular.module('ctrls', [])

        // Parent/Main Controller
        .controller('mainCtrl', ['$rootScope', '$scope', '$location', 'AuthService', 'AUTH_EVENTS', 'CommonService', 'Session', 'goldService',
            function($rootScope, $scope, $location, AuthService, AUTH_EVENTS, CommonService, Session, goldService) {

                // for test
                $scope.toggleMO = function() {
                    $(this).addClass("al")
                    console.log(this)
                    $('.mo-list').animate({
                        width: 'toggle'
                    }, 350);
                }
                $scope.orderItems = [];
                for (var i = 0; i < 30; i++) {
                    $scope.orderItems[i] = i;
                }

                $rootScope.setCurrentUser = function(user) {
                    $rootScope.currentUser = user;
                };

                // Log out
                $scope.logout = function() {
                    Session.destroy();
                    $rootScope.currentUser = null;
                    AuthService.logout().then(function(res) {
                        if (CommonService.isReqSuccess(res)) {
                            $rootScope.$broadcast(AUTH_EVENTS.logoutSuccess);
                            console.log('登出成功');
                        } else {
                            CommonService.handleResErr(res);
                        }
                    }, function(res) {
                        CommonService.handleHttpErr(res);
                    });
                }

                // Listening
                $scope.$on(AUTH_EVENTS.loginSuccess, function(event, data) {
                    console.log("login success");
                    $location.path('/');
                });

                $scope.$on(AUTH_EVENTS.pageNotFound, function(event, data) {
                    console.log('404 error');
                });

                $scope.$on(AUTH_EVENTS.serverError, function(event, data) {
                    console.log('500 error');
                });

            }
        ])


        // Register Controller
        .controller('registerCtrl', ['$scope', '$location', 'registerService', function($scope, $location, registerService) {
            // If success jump to Login page
            $scope.register = function(user) {
                registerService.register(user).then(function(res) {
                    if (CommonService.isReqSuccess(res)) {
                        console.log(res);
                        alert('register成功');
                        $location.path("/login");
                    } else {
                        CommonService.handleResErr(res);
                    }
                }, function(res) {
                    alert('register失败');
                    CommonService.handleHttpErr(res);
                })
            }
        }])


        // User Controller
        .controller('userCtrl', ['$scope', '$rootScope', '$location', 'Session', 'AUTH_EVENTS', 'AuthService', function($scope, $rootScope, $location, Session, AUTH_EVENTS, AuthService) {
            $scope.$on(AUTH_EVENTS.logoutSuccess, function(event, data) {
                $location.path("/");
            });

            if (!AuthService.isAuthenticated()) {
                console.log("user need login");
                $location.path("/login");
            }

        }])



        // For test
        .controller('testCtrl', ['$scope', '$rootScope', '$location', '$http', 'AUTH_EVENTS', 'AuthService',
            function($scope, $rootScope, $location, $http, AUTH_EVENTS, AuthService) {
                $scope.obj = {
                    url: "user/login.do",
                    method: "POST",
                    data: ""
                };
                $scope.test = function(obj) {
                    var aa = (JSON.parse(obj.data));
                    $scope.result = {
                        result: "",
                        status: "",
                        msg: "",
                        content: ""
                    };
                    $http({
                        url: obj.url,
                        method: obj.method,
                        data: serializeData(aa)
                    }).then(function(res) {
                        console.log(res);
                        $scope.result.result = "Req Success";
                        $scope.result = res;
                    }, function(res) {
                        console.log(res);
                        $scope.result = res;
                        $scope.result.result = "Req Fail";
                    });
                }
            }
        ])

})();
/**
 * @author Shawn
 * @desc Services of the mainAPP
 */

// For test
var commonTest = false;

(function() {
    'use strict';

    angular.module('services', [])

        // Broadcast the result of User status
        .factory('AuthInterceptor', function($rootScope, $q, AUTH_EVENTS) {
            return {
                responseError: function(response) {
                    // console.log(response);
                    $rootScope.$broadcast({
                        401: AUTH_EVENTS.notAuthenticated,
                        403: AUTH_EVENTS.notAuthorized,
                        419: AUTH_EVENTS.sessionTimeout,
                        440: AUTH_EVENTS.sessionTimeout,
                        404: AUTH_EVENTS.pageNotFound,
                        500: AUTH_EVENTS.serverError
                    }[response.status], response);
                    return $q.reject(response);
                }
            };
        })

        // Session manipulate
        .factory('Session', function($cookies) {
            var aName = "USERID";
            var bName = "SID";

            this.create = function(sessionId, userId) {
                $cookies.put(aName, userId);
                $cookies.put(bName, sessionId);
            }
            // this.create = function(sessionId, userId) {
            //     document.cookie = aName + '=' + userId;
            //     document.cookie = bName + '=' + sessionId;
            //     this.id = sessionId;
            //     this.userId = userId;
            // };

            this.get = function(name) {
                return $cookies.getObject(name);
                // if (document.cookie.length > 0) {
                //     var start = document.cookie.indexOf(name + "=");
                //     if (start != -1) {
                //         start = start + name.length + 1;
                //         var end = document.cookie.indexOf(";", start);
                //         if (end == -1) end = document.cookie.length;
                //         return unescape(document.cookie.substring(start, end));
                //     }
                // }
                // return "";
            };
            this.getUserName = function() {
                return this.get(aName);
            };
            this.getSessionId = function() {
                return this.get(bName);
            };
            this.getObj = function() {
                return {
                    'accountname': this.get(aName),
                    'sessionid': this.get(bName)
                }
            };
            this.destroy = function() {
                document.cookie = aName + '=';
                document.cookie = bName + '=';
                this.id = null;
                this.userId = null;
            };
            return this;
        })

        // Global Services
        .factory('CommonService', function($http, Session) {
            // Set Content-Type to form-data which back-end can accept
            $http.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';

            var urlBackEnd = 'http://localhost:8080/test-data/';
            var urlMiddleEnd = 'https://ExampleURL.92/';

            // requests status handle
            this.isReqSuccess = function(res) {
                console.log(res);
                return res.data.errCode == 0 ? true : false;
            };

            // handle Http error
            this.handleHttpErr = function(res) {
                console.log('Req Error', res);
            };

            // handle response error (base on API)
            this.handleResErr = function(res) {
                console.log(res);
                if (res.data.errDesc == undefined) {
                    console.log('Error without discription');
                    console.log('msg: ' + res.errDesc);
                } else {
                    alert(res.data.errDesc);
                    console.log(res.data);
                }
            };

            // post single command to back-end server
            this.post = function(command, req) {
                // Request parameters structure
                var data = $.extend({
                    "command": command
                }, Session.getObj(), req);

                // console.log(angular.toJson(data));
                return commonTest ? $http({
                    url: 'test-data/' + command,
                    method: 'GET'
                }) : $http({
                    url: urlBackEnd + command,
                    method: 'POST',
                    data: "JsonStr=" + angular.toJson(data)
                })
            };

            // post single command to back-end server
            // namespace: user/golduserrecharge.action
            this.postMiddleEnd = function(namespace, command, req) {
                var data = $.extend({
                    "command": command
                }, req);

                return $http({
                    url: urlMiddleEnd + namespace,
                    method: 'POST',
                    data: "JsonStr=" + angular.toJson(data)
                })
            }

            // post multi commands to server
            this.postMulti = function() {

            };

            return this;
        })

        // Auth
        .factory('AuthService', function($http, $rootScope, AUTH_EVENTS, Session, CommonService) {

            var authService = {};

            authService.login = function(user) {
                return CommonService.post("login", user);
            };

            authService.logout = function() {
                return CommonService.post("logout");
            };

            // is session avalid
            authService.isAuthenticated = function() {
                console.log('isAuthenticated: ' + !!Session.get('USERID'));
                return !!Session.get('USERID');
            };

            return authService;
        })

        // register
        .factory('registerService', function($http, $rootScope, CommonService) {
            var service = {};

            service.register = function(user) {
                return CommonService.post("user/register.do", user);
            };

            return service;
        })

        // User
        .factory('userService', function($http, $rootScope, Session, CommonService) {
            var service = {};

            return service;
        })

        // Example
        .factory('goldService', function($http, $rootScope, Session, CommonService) {

            var service = {};

            // 1
            service.querygoldprice = function() {
                return CommonService.post("gold/querygoldprice");
            };
            // 3
            service.queryprojectdetail = function(req) {
                return CommonService.post("gold/queryprojectdetail", req);
            };


            return service;
        })

        // Example
        .factory('middleEndService', function($http, $rootScope, Session, CommonService) {

            var service = {};

            // 1
            service.charge = function(req) {
                return CommonService.postMiddleEnd('user/golduserrecharge.action', 'postdata', req);
            };
            // 2
            service.queryprojectlist = function() {
                return CommonService.post("gold/queryprojectlist");
            };

            service.querymyfixedgoldinterestdetail = function(req) {
                return CommonService.post("gold/myaccount/querymyfixedgoldinterestdetail", req);
            };

            return service;
        })

})();

(function() {
    'use strict';

    function rdLoading() {
        var d = {
            restrict: "AE",
            template: '<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'
        };
        return d
    }

    function rdWidgetBody() {
        var d = {
            requires: "^rdWidget",
            scope: {
                loading: "@?",
                classes: "@?"
            },
            transclude: !0,
            template: '<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',
            restrict: "E"
        };
        return d
    }

    function rdWidget() {
        var d = {
            transclude: !0,
            template: '<div class="widget" ng-transclude></div>',
            restrict: "EA"
        };
        return d
    }

    function rdWidgetTitle() {
        var e = {
            requires: "^rdWidget",
            scope: {
                title: "@",
                icon: "@"
            },
            transclude: !0,
            template: '<div class="widget-header"><i class="fa" ng-class="icon"></i> {{title}} <div class="pull-right" ng-transclude></div></div>',
            restrict: "E"
        };
        return e
    }


    function rdWidgetFooter() {
        var e = {
            requires: "^rdWidget",
            transclude: !0,
            template: '<div class="widget-footer" ng-transclude></div>',
            restrict: "E"
        };
        return e
    }




    angular.module('directives', [])

    .directive("rdLoading", rdLoading)

    .directive("rdWidgetBody", rdWidgetBody)

    .directive("rdWidgetFooter", rdWidgetFooter)

    .directive("rdWidgetHeader", rdWidgetTitle)

    .directive("rdWidget", rdWidget)



})();

/**
 * @author Shawn
 * @desc mainAPP
 */
const PROJECTSTATUS = {
    0: "科技",
    1: "艺术",
    2: "娱乐",
    3: "农业",
    4: "地产",
    5: "公益",
    6: "其他"
};

// 项目审核状态
const AUDITSTATUS = {
    0: "未提交",
    10: "未审核",
    20: "审核未通过",
    30: "预热中",
    40: "中",
    50: "即将结束",
    60: "已成功",
    70: "已失败"
};

// 项目所处阶段
const PROJECTPHASE = {
    0: "研发中",
    1: "已正式发布",
    2: "已有收入",
    3: "已盈利"
}
const BUILDCOMPANY = {
    0: "未成立",
    1: "已成立"
};
const CATEGORY = {
    0: "科技",
    1: "艺术",
    2: "娱乐",
    3: "农业",
    4: "地产",
    5: "公益",
    6: "其他"
};

/* filters */
var filters = angular.module('filters', [])

// 开关过滤器，0则显示关闭，1则显示开启
.filter('switch', function() {
    return function(param) {
        if (param == 1 || param == '1') {
            return '开启';
        } else {
            return '关闭';
        }
    }
})

// 百分比,页面一般有额外百分号，传入*100的数值，输出小数
.filter('percent', function() {
    return function(param) {
        if (param != undefined && isNaN(param) == false) {
            return param * 1000 / 100000;
        } else {
            return '';
        }
    }
})

.filter('category', function() {
    var obj = CATEGORY;
    return function(param) {
        return obj[param] != undefined ? obj[param] : "";
    }
})

.filter('buildcompany', function() {
    var obj = BUILDCOMPANY;
    return function(param) {
        return obj[param] != undefined ? obj[param] : "";
    }
})

.filter('projectphase', function() {
    var obj = PROJECTPHASE;
    return function(param) {
        return obj[param] != undefined ? obj[param] : "";
    }
})

.filter('auditstatus', function() {
    var obj = AUDITSTATUS;
    return function(param) {
        return obj[param] != undefined ? obj[param] : "";
    }
})

.filter('projectstatus', function() {
    var obj = PROJECTSTATUS;
    return function(param) {
        return obj[param] != undefined ? obj[param] : "";
    }
})

(function() {
    'use strict';


    angular.module('directives')
        .directive('marketOrderList', marketOrderList);
    function marketOrderList() {
        return {
            scope: {
                icon: "@"
            },
            templateUrl: 'public/js/components/market-order-list/market-order-list.html',
            restrict: "E"
        };
    }


})();

angular.module('ctrls')
    // angular-ui Modal
    .controller('LoginCtrl', LoginCtrl);


// Login Controller
function LoginCtrl($scope, $rootScope, $location, $http, $cookies, $state, AUTH_EVENTS, CommonService, Session, AuthService) {

    // if (!!$rootScope.currentUser) {
    //     $state.go('home');
    // }

    $scope.user = {};
    $scope.login = function(user) {

        AuthService.login(user).then(function(res) {

            console.log(res);
            if (CommonService.isReqSuccess(res)) {
                console.log('login success');
                // $cookies.put(res.data.sessionid, user.accountname);
                Session.create(res.data.sessionid, user.accountname);
                $rootScope.$broadcast(AUTH_EVENTS.loginSuccess);
                $state.go('home.order');
                $rootScope.setCurrentUser(user.accountname);
            } else {
                CommonService.handleResErr(res);
                $rootScope.$broadcast(AUTH_EVENTS.loginFailed);
            }
        }, function(res) {
            CommonService.handleHttpErr(res);
            $rootScope.$broadcast(AUTH_EVENTS.loginFailed);
        });
        console.log(user);
    }
}

(function() {
    'use strict';


    angular.module('directives')
        .directive('login', login);

    function login($compile) {
        return {
            restrict: 'E',
            scope: '@',
            templateUrl: 'public/js/components/login-panel/login-panel.html',
            link: function(scope) {
                // scope.name = "hel"
            }
        };
    }

})();

(function() {
    'use strict';


    angular.module('directives')
        .directive('marketOrderList', marketOrderList);
    function marketOrderList() {
        return {
            scope: {
                icon: "@"
            },
            templateUrl: 'public/js/components/market-order-list/market-order-list.html',
            restrict: "E"
        };
    }


})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC5tb2R1bGUuanMiLCJtb2R1bGUuanMiLCJyb3V0ZXIuanMiLCJ0b29sa2l0LmpzIiwiY29udHJvbGxlcnMvYWxlcnRzLWRlbW8uY29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21vZGFsLWRlbW8uY29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21vZGFsLWluc3RhbmNlLmNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9wcm9ncmVzc2Jhci1kZW1vLmNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9zaWRlYmFyLmNvbnRyb2xsZXIuanMiLCJjb3JlL2NvbnRyb2xsZXJzLmpzIiwiY29yZS9jb3JlLnNlcnZpY2UuanMiLCJjb3JlL2RpcmVjdGl2ZXMuanMiLCJjb3JlL2ZpbHRlcnMuanMiLCJjb21wb25lbnRzL21hcmtldC1vcmRlci9tYXJrZXQtb3JkZXItbGlzdC5kaXJlY3RpdmUuanMiLCJjb21wb25lbnRzL2xvZ2luLXBhbmVsL2xvZ2luLXBhbmVsLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL2xvZ2luLXBhbmVsL2xvZ2luLXBhbmVsLmRpcmVjdGl2ZS5qcyIsImNvbXBvbmVudHMvbWFya2V0LW9yZGVyLWxpc3QvbWFya2V0LW9yZGVyLWxpc3QuZGlyZWN0aXZlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FDRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGF1dGhvciBTaGF3blxyXG4gKiBAZGVzYyBtYWluQVBQXHJcbiAqL1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ21haW5BcHAnLCBbJ3VpLnJvdXRlcicsICd1aS5ib290c3RyYXAnLCduZ0Nvb2tpZXMnLCAnbmdBbmltYXRlJywgJ3JvdXRlcicsICdjdHJscycsICdzZXJ2aWNlcycsICdmaWx0ZXJzJywgJ2RpcmVjdGl2ZXMnXSlcclxuXHJcbiAgICAgICAgLy8gR2xvYmFsXHJcbiAgICAgICAgLmNvbnN0YW50KCdXRUJfSU5GTycsIHtcclxuICAgICAgICAgICAgdGl0bGU6ICdPcmRlciBNYW5hZ2VtZW50IFN5c3RlbSdcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAuY29uc3RhbnQoJ0FVVEhfRVZFTlRTJywge1xyXG4gICAgICAgICAgICBsb2dpblN1Y2Nlc3M6ICdhdXRoLWxvZ2luLXN1Y2Nlc3MnLFxyXG4gICAgICAgICAgICBsb2dpbkZhaWxlZDogJ2F1dGgtbG9naW4tZmFpbGVkJyxcclxuICAgICAgICAgICAgbG9nb3V0U3VjY2VzczogJ2F1dGgtbG9nb3V0LXN1Y2Nlc3MnLFxyXG4gICAgICAgICAgICBzZXNzaW9uVGltZW91dDogJ2F1dGgtc2Vzc2lvbi10aW1lb3V0JyxcclxuICAgICAgICAgICAgbm90QXV0aGVudGljYXRlZDogJ2F1dGgtbm90LWF1dGhlbnRpY2F0ZWQnLFxyXG4gICAgICAgICAgICBwYWdlTm90Rm91bmQ6ICdwYWdlLW5vdC1mb3VuZCcsXHJcbiAgICAgICAgICAgIHNlcnZlckVycm9yOiAnc2VydmVyLWVycm9yJ1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vIERvIGF1dGggd2hlbiBzdGF0ZS91cmwgY2hhbmdlXHJcbiAgICAgICAgLnJ1bihmdW5jdGlvbigkcm9vdFNjb3BlLCBBVVRIX0VWRU5UUywgQXV0aFNlcnZpY2UsIFNlc3Npb24pIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oZXZlbnQsIG5leHQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoQVVUSF9FVkVOVFMubm90QXV0aGVudGljYXRlZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSBTZXNzaW9uLmdldFVzZXJOYW1lKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFtcbiAgICAgICAgJ2FwcC5jb3JlJyxcbiAgICAgICAgJ2FwcC53aWRnZXRzJyxcbiAgICAgICAgJ2FwcC5hZG1pbicsXG4gICAgICAgICdhcHAuZGFzaGJvYXJkJyxcbiAgICAgICAgJ2FwcC5sYXlvdXQnXG4gICAgXSk7XG5cbn0pKCk7XG4iLCIvLyAoZnVuY3Rpb24oKSB7XHJcbi8vICAgICBhbmd1bGFyLm1vZHVsZSgnY3RybHMnLCBbXSk7XHJcbi8vIH0pKCk7IiwiLyoqXHJcbiAqIEBhdXRob3IgU2hhd25cclxuICogQGRlc2MgbWFpbkFQUFxyXG4gKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdyb3V0ZXInLCBbXSlcclxuXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XHJcblxyXG4gICAgICAgIC8vIEludGVyY2VwdG9yIG9mIFJlcXVlc3RzXHJcbiAgICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaChbXHJcbiAgICAgICAgICAgICckaW5qZWN0b3InLFxyXG4gICAgICAgICAgICBmdW5jdGlvbigkaW5qZWN0b3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaW5qZWN0b3IuZ2V0KCdBdXRoSW50ZXJjZXB0b3InKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUoe1xyXG4gICAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVxdWlyZUJhc2U6IGZhbHNlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIEZvciBhbnkgdW5tYXRjaGVkIHVybCwgcmVkaXJlY3QgdG8gL1xyXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJ2xvZ2luJyk7XHJcblxyXG5cclxuICAgICAgICAvLyBsb2dpbnJlZ2lzdGVyXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuXHJcbiAgICAgICAgLy8gbWFpbiBwYWdlXHJcbiAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICB1cmw6ICcvJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9ob21lLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnaW5kZXhDdHJsJ1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC5zdGF0ZShcImhvbWUuZGFzaDFcIiwge1xyXG4gICAgICAgICAgICB1cmw6IFwiZGFzaDFcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvcmRhc2gvZGFzaGJvYXJkLmh0bWxcIlxyXG4gICAgICAgIH0pLnN0YXRlKFwiaG9tZS5vcmRlclwiLCB7XHJcbiAgICAgICAgICAgIHVybDogXCJvcmRlclwiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9yZGFzaC9vcmRlci1saXN0Lmh0bWxcIlxyXG4gICAgICAgIH0pLnN0YXRlKFwiaG9tZS5kYXNoMlwiLCB7XHJcbiAgICAgICAgICAgIHVybDogXCJkYXNoMlwiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9yZGFzaC90YWJsZXMuaHRtbFwiXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcclxuICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9sb2dpbi5odG1sJ1xyXG4gICAgICAgIH0pLnN0YXRlKCdyZWdpc3RlcicsIHtcclxuICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9yZWdpc3Rlci5odG1sJ1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vIFVzZXIgQWNjb3VudFxyXG4gICAgICAgIC5zdGF0ZSgnYWNjb3VudCcsIHtcclxuICAgICAgICAgICAgdXJsOiAnL2FjY291bnQnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2FjY291bnQvYWNjb3VudC5odG1sJ1xyXG4gICAgICAgIH0pLnN0YXRlKCdhY2NvdW50Lm1lJywge1xyXG4gICAgICAgICAgICB1cmw6ICcvbWUnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2FjY291bnQvYWNjb3VudC5tZS5odG1sJ1xyXG4gICAgICAgIH0pLnN0YXRlKCdhY2NvdW50LmNoYXJnZScsIHtcclxuICAgICAgICAgICAgdXJsOiAnL2NoYXJnZScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvYWNjb3VudC9hY2NvdW50LmNoYXJnZS5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NoYXJnZUN0cmwnXHJcbiAgICAgICAgfSkuc3RhdGUoJ2FjY291bnQuY2FyZCcsIHtcclxuICAgICAgICAgICAgdXJsOiAnL2NhcmQnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2FjY291bnQvYWNjb3VudC5jYXJkLmh0bWwnXHJcbiAgICAgICAgfSkuc3RhdGUoJ2FjY291bnQuY291cG9ucycsIHtcclxuICAgICAgICAgICAgdXJsOiAnL2NvdXBvbnMnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2FjY291bnQvYWNjb3VudC5jb3Vwb25zLmh0bWwnXHJcbiAgICAgICAgfSkuc3RhdGUoJ2FjY291bnQuZGVwb3NpdCcsIHtcclxuICAgICAgICAgICAgdXJsOiAnL2RlcG9zaXQnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2FjY291bnQvYWNjb3VudC5kZXBvc2l0Lmh0bWwnXHJcbiAgICAgICAgfSkuc3RhdGUoJ2FjY291bnQuZ29sZCcsIHtcclxuICAgICAgICAgICAgdXJsOiAnL2dvbGQnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2FjY291bnQvYWNjb3VudC5nb2xkLmh0bWwnXHJcbiAgICAgICAgfSkuc3RhdGUoJ2FjY291bnQucmVzZXJ2ZScsIHtcclxuICAgICAgICAgICAgdXJsOiAnL3Jlc2VydmUnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2FjY291bnQvYWNjb3VudC5yZXNlcnZlLmh0bWwnXHJcbiAgICAgICAgfSkuc3RhdGUoJ2FjY291bnQudHJhbnNhY3Rpb24nLCB7XHJcbiAgICAgICAgICAgIHVybDogJy90cmFuc2FjdGlvbicsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvYWNjb3VudC9hY2NvdW50LnRyYW5zYWN0aW9uLmh0bWwnXHJcbiAgICAgICAgfSkuc3RhdGUoJ2FjY291bnQud2l0aGRyYXcnLCB7XHJcbiAgICAgICAgICAgIHVybDogJy93aXRoZHJhdycsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvYWNjb3VudC9hY2NvdW50LndpdGhkcmF3Lmh0bWwnXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgLy8gZm9yIHRlc3RcclxuICAgICAgICAuc3RhdGUoJ3Rlc3QnLCB7XHJcbiAgICAgICAgICAgIHVybDogJy90ZXN0JyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy90ZXN0LWFuZ3VsYXItdWktYm9vdHN0cmFwLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAndGVzdEN0cmwnXHJcbiAgICAgICAgfSlcclxuICAgIH0pO1xyXG59KSgpO1xyXG4iLCIvLyDluo/liJfljJblr7nosaFcclxuLy8g56S65L6LOiB7YWRkci5sb2NhdGlvbjphLGFkZHIubnVtYmVyOmJ9ID09PiBhZGRyJTVCbG9jYXRpb24lNUQ9YSZhZGRyJTVCbnVtYmVyJTVEPWJcclxuc2VyaWFsaXplRGF0YSA9IGZ1bmN0aW9uKG9iaiwgcHJlZml4KSB7XHJcbiAgICB2YXIgc3RyID0gW107XHJcbiAgICBmb3IgKHZhciBwIGluIG9iaikge1xyXG4gICAgICAgIGlmIChvYmouY29uc3RydWN0b3IgPT09IEFycmF5KSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG9iaik7XHJcbiAgICAgICAgICAgIHZhciBrID0gcHJlZml4ID8gcHJlZml4ICsgXCJbXCIgKyBwICsgXCJdXCIgOiBwLFxyXG4gICAgICAgICAgICAgICAgdiA9IG9ialtwXTtcclxuICAgICAgICAgICAgc3RyLnB1c2godHlwZW9mIHYgPT0gXCJvYmplY3RcIiA/XHJcbiAgICAgICAgICAgICAgICBzZXJpYWxpemVEYXRhKHYsIGspIDpcclxuICAgICAgICAgICAgICAgIGVuY29kZVVSSUNvbXBvbmVudChrKSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHYpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwKSkge1xyXG4gICAgICAgICAgICAvLyAgIHZhciBrID0gcHJlZml4ID8gcHJlZml4ICsgXCJbXCIgKyBwICsgXCJdXCIgOiBwLCB2ID0gb2JqW3BdO1xyXG4gICAgICAgICAgICB2YXIgayA9IHByZWZpeCA/IHByZWZpeCArIFwiLlwiICsgcCA6IHAsXHJcbiAgICAgICAgICAgICAgICB2ID0gb2JqW3BdO1xyXG4gICAgICAgICAgICBzdHIucHVzaCh0eXBlb2YgdiA9PSBcIm9iamVjdFwiID9cclxuICAgICAgICAgICAgICAgIHNlcmlhbGl6ZURhdGEodiwgaykgOlxyXG4gICAgICAgICAgICAgICAgZW5jb2RlVVJJQ29tcG9uZW50KGspICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQodikpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBzdHIuam9pbihcIiZcIik7XHJcbn1cclxuXHJcbi8vIOi9rOWMlueZvuWIhuaVsCjmiJbkuI3luKbnmb7liIblj7cp6Iez5bCP5pWwXHJcbi8vIOekuuS+izogMzUlID09PiAwLjM1XHJcbnBlcmNlbnRUb051bSA9IGZ1bmN0aW9uKHBhcmFtKSB7XHJcbiAgICBwYXJhbSA9IHBhcmFtLnRvU3RyaW5nKCkucmVwbGFjZSgnJScsICcnKTtcclxuICAgIGlmIChwYXJhbSAhPSB1bmRlZmluZWQgJiYgaXNOYU4ocGFyYW0pID09IGZhbHNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHBhcmFtICogMTAwMCAvIDEwMDAwMDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuKiAgU2VjdXJlIEhhc2ggQWxnb3JpdGhtIChTSEEyNTYpXHJcbiogIGh0dHA6Ly93d3cud2VidG9vbGtpdC5pbmZvL1xyXG4qICBPcmlnaW5hbCBjb2RlIGJ5IEFuZ2VsIE1hcmluLCBQYXVsIEpvaG5zdG9uLlxyXG4qKi9cclxudmFyIFNIQTI1NiA9IGZ1bmN0aW9uKHMpIHt2YXIgY2hyc3ogPSA4O3ZhciBoZXhjYXNlID0gMDtmdW5jdGlvbiBzYWZlX2FkZCh4LCB5KSB7dmFyIGxzdyA9ICh4ICYgMHhGRkZGKSArICh5ICYgMHhGRkZGKTt2YXIgbXN3ID0gKHggPj4gMTYpICsgKHkgPj4gMTYpICsgKGxzdyA+PiAxNik7cmV0dXJuIChtc3cgPDwgMTYpIHwgKGxzdyAmIDB4RkZGRik7fWZ1bmN0aW9uIFMoWCwgbikge3JldHVybiAoWCA+Pj4gbikgfCAoWCA8PCAoMzIgLSBuKSk7fWZ1bmN0aW9uIFIoWCwgbikge3JldHVybiAoWCA+Pj4gbik7fWZ1bmN0aW9uIENoKHgsIHksIHopIHtyZXR1cm4gKCh4ICYgeSkgXiAoKH54KSAmIHopKTt9ZnVuY3Rpb24gTWFqKHgsIHksIHopIHtyZXR1cm4gKCh4ICYgeSkgXiAoeCAmIHopIF4gKHkgJiB6KSk7fWZ1bmN0aW9uIFNpZ21hMDI1Nih4KSB7cmV0dXJuIChTKHgsIDIpIF4gUyh4LCAxMykgXiBTKHgsIDIyKSk7fWZ1bmN0aW9uIFNpZ21hMTI1Nih4KSB7cmV0dXJuIChTKHgsIDYpIF4gUyh4LCAxMSkgXiBTKHgsIDI1KSk7fWZ1bmN0aW9uIEdhbW1hMDI1Nih4KSB7cmV0dXJuIChTKHgsIDcpIF4gUyh4LCAxOCkgXiBSKHgsIDMpKTt9ZnVuY3Rpb24gR2FtbWExMjU2KHgpIHtyZXR1cm4gKFMoeCwgMTcpIF4gUyh4LCAxOSkgXiBSKHgsIDEwKSk7fWZ1bmN0aW9uIGNvcmVfc2hhMjU2KG0sIGwpIHt2YXIgSyA9IG5ldyBBcnJheSgweDQyOEEyRjk4LCAweDcxMzc0NDkxLCAweEI1QzBGQkNGLCAweEU5QjVEQkE1LCAweDM5NTZDMjVCLCAweDU5RjExMUYxLCAweDkyM0Y4MkE0LCAweEFCMUM1RUQ1LCAweEQ4MDdBQTk4LCAweDEyODM1QjAxLCAweDI0MzE4NUJFLCAweDU1MEM3REMzLCAweDcyQkU1RDc0LCAweDgwREVCMUZFLCAweDlCREMwNkE3LCAweEMxOUJGMTc0LCAweEU0OUI2OUMxLCAweEVGQkU0Nzg2LCAweEZDMTlEQzYsIDB4MjQwQ0ExQ0MsIDB4MkRFOTJDNkYsIDB4NEE3NDg0QUEsIDB4NUNCMEE5REMsIDB4NzZGOTg4REEsIDB4OTgzRTUxNTIsIDB4QTgzMUM2NkQsIDB4QjAwMzI3QzgsIDB4QkY1OTdGQzcsIDB4QzZFMDBCRjMsIDB4RDVBNzkxNDcsIDB4NkNBNjM1MSwgMHgxNDI5Mjk2NywgMHgyN0I3MEE4NSwgMHgyRTFCMjEzOCwgMHg0RDJDNkRGQywgMHg1MzM4MEQxMywgMHg2NTBBNzM1NCwgMHg3NjZBMEFCQiwgMHg4MUMyQzkyRSwgMHg5MjcyMkM4NSwgMHhBMkJGRThBMSwgMHhBODFBNjY0QiwgMHhDMjRCOEI3MCwgMHhDNzZDNTFBMywgMHhEMTkyRTgxOSwgMHhENjk5MDYyNCwgMHhGNDBFMzU4NSwgMHgxMDZBQTA3MCwgMHgxOUE0QzExNiwgMHgxRTM3NkMwOCwgMHgyNzQ4Nzc0QywgMHgzNEIwQkNCNSwgMHgzOTFDMENCMywgMHg0RUQ4QUE0QSwgMHg1QjlDQ0E0RiwgMHg2ODJFNkZGMywgMHg3NDhGODJFRSwgMHg3OEE1NjM2RiwgMHg4NEM4NzgxNCwgMHg4Q0M3MDIwOCwgMHg5MEJFRkZGQSwgMHhBNDUwNkNFQiwgMHhCRUY5QTNGNywgMHhDNjcxNzhGMik7dmFyIEhBU0ggPSBuZXcgQXJyYXkoMHg2QTA5RTY2NywgMHhCQjY3QUU4NSwgMHgzQzZFRjM3MiwgMHhBNTRGRjUzQSwgMHg1MTBFNTI3RiwgMHg5QjA1Njg4QywgMHgxRjgzRDlBQiwgMHg1QkUwQ0QxOSk7dmFyIFcgPSBuZXcgQXJyYXkoNjQpO3ZhciBhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBpLCBqO3ZhciBUMSwgVDI7bVtsID4+IDVdIHw9IDB4ODAgPDwgKDI0IC0gbCAlIDMyKTttWygobCArIDY0ID4+IDkpIDw8IDQpICsgMTVdID0gbDtmb3IgKHZhciBpID0gMDsgaSA8IG0ubGVuZ3RoOyBpICs9IDE2KSB7YSA9IEhBU0hbMF07YiA9IEhBU0hbMV07YyA9IEhBU0hbMl07ZCA9IEhBU0hbM107ZSA9IEhBU0hbNF07ZiA9IEhBU0hbNV07ZyA9IEhBU0hbNl07aCA9IEhBU0hbN107Zm9yICh2YXIgaiA9IDA7IGogPCA2NDsgaisrKSB7aWYgKGogPCAxNikgV1tqXSA9IG1baiArIGldO2Vsc2UgV1tqXSA9IHNhZmVfYWRkKHNhZmVfYWRkKHNhZmVfYWRkKEdhbW1hMTI1NihXW2ogLSAyXSksIFdbaiAtIDddKSwgR2FtbWEwMjU2KFdbaiAtIDE1XSkpLCBXW2ogLSAxNl0pO1QxID0gc2FmZV9hZGQoc2FmZV9hZGQoc2FmZV9hZGQoc2FmZV9hZGQoaCwgU2lnbWExMjU2KGUpKSwgQ2goZSwgZiwgZykpLCBLW2pdKSwgV1tqXSk7VDIgPSBzYWZlX2FkZChTaWdtYTAyNTYoYSksIE1haihhLCBiLCBjKSk7aCA9IGc7ZyA9IGY7ZiA9IGU7ZSA9IHNhZmVfYWRkKGQsIFQxKTtkID0gYztjID0gYjtiID0gYTthID0gc2FmZV9hZGQoVDEsIFQyKTt9SEFTSFswXSA9IHNhZmVfYWRkKGEsIEhBU0hbMF0pO0hBU0hbMV0gPSBzYWZlX2FkZChiLCBIQVNIWzFdKTtIQVNIWzJdID0gc2FmZV9hZGQoYywgSEFTSFsyXSk7SEFTSFszXSA9IHNhZmVfYWRkKGQsIEhBU0hbM10pO0hBU0hbNF0gPSBzYWZlX2FkZChlLCBIQVNIWzRdKTtIQVNIWzVdID0gc2FmZV9hZGQoZiwgSEFTSFs1XSk7SEFTSFs2XSA9IHNhZmVfYWRkKGcsIEhBU0hbNl0pO0hBU0hbN10gPSBzYWZlX2FkZChoLCBIQVNIWzddKTt9cmV0dXJuIEhBU0g7fWZ1bmN0aW9uIHN0cjJiaW5iKHN0cikge3ZhciBiaW4gPSBBcnJheSgpO3ZhciBtYXNrID0gKDEgPDwgY2hyc3opIC0gMTtmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGggKiBjaHJzejsgaSArPSBjaHJzeikge2JpbltpID4+IDVdIHw9IChzdHIuY2hhckNvZGVBdChpIC8gY2hyc3opICYgbWFzaykgPDwgKDI0IC0gaSAlIDMyKTt9cmV0dXJuIGJpbjt9ZnVuY3Rpb24gVXRmOEVuY29kZShzdHJpbmcpIHtzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvcm4vZywgXCJuXCIpO3ZhciB1dGZ0ZXh0ID0gXCJcIjtmb3IgKHZhciBuID0gMDsgbiA8IHN0cmluZy5sZW5ndGg7IG4rKykge3ZhciBjID0gc3RyaW5nLmNoYXJDb2RlQXQobik7aWYgKGMgPCAxMjgpIHt1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7fSBlbHNlIGlmICgoYyA+IDEyNykgJiYgKGMgPCAyMDQ4KSkge3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiA2KSB8IDE5Mik7dXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjICYgNjMpIHwgMTI4KTt9IGVsc2Uge3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiAxMikgfCAyMjQpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgPj4gNikgJiA2MykgfCAxMjgpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7fX1yZXR1cm4gdXRmdGV4dDt9ZnVuY3Rpb24gYmluYjJoZXgoYmluYXJyYXkpIHt2YXIgaGV4X3RhYiA9IGhleGNhc2UgPyBcIjAxMjM0NTY3ODlBQkNERUZcIiA6IFwiMDEyMzQ1Njc4OWFiY2RlZlwiO3ZhciBzdHIgPSBcIlwiO2ZvciAodmFyIGkgPSAwOyBpIDwgYmluYXJyYXkubGVuZ3RoICogNDsgaSsrKSB7c3RyICs9IGhleF90YWIuY2hhckF0KChiaW5hcnJheVtpID4+IDJdID4+ICgoMyAtIGkgJSA0KSAqIDggKyA0KSkgJiAweEYpICsgaGV4X3RhYi5jaGFyQXQoKGJpbmFycmF5W2kgPj4gMl0gPj4gKCgzIC0gaSAlIDQpICogOCkpICYgMHhGKTt9cmV0dXJuIHN0cjt9cyA9IFV0ZjhFbmNvZGUocyk7cmV0dXJuIGJpbmIyaGV4KGNvcmVfc2hhMjU2KHN0cjJiaW5iKHMpLCBzLmxlbmd0aCAqIGNocnN6KSk7fVxyXG5cclxuLyoqXHJcbiogIFNlY3VyZSBIYXNoIEFsZ29yaXRobSAoU0hBMSlcclxuKiAgaHR0cDovL3d3dy53ZWJ0b29sa2l0LmluZm8vXHJcbioqL1xyXG52YXIgU0hBMSA9IGZ1bmN0aW9uKG1zZykge2Z1bmN0aW9uIHJvdGF0ZV9sZWZ0KG4scykge3ZhciB0NCA9ICggbjw8cyApIHwgKG4+Pj4oMzItcykpO3JldHVybiB0NDt9O2Z1bmN0aW9uIGxzYl9oZXgodmFsKSB7dmFyIHN0cj1cIlwiO3ZhciBpO3ZhciB2aDt2YXIgdmw7Zm9yKCBpPTA7IGk8PTY7IGkrPTIgKSB7dmggPSAodmFsPj4+KGkqNCs0KSkmMHgwZjt2bCA9ICh2YWw+Pj4oaSo0KSkmMHgwZjtzdHIgKz0gdmgudG9TdHJpbmcoMTYpICsgdmwudG9TdHJpbmcoMTYpO31yZXR1cm4gc3RyO307ZnVuY3Rpb24gY3Z0X2hleCh2YWwpIHt2YXIgc3RyPVwiXCI7dmFyIGk7dmFyIHY7Zm9yKCBpPTc7IGk+PTA7IGktLSApIHt2ID0gKHZhbD4+PihpKjQpKSYweDBmO3N0ciArPSB2LnRvU3RyaW5nKDE2KTt9cmV0dXJuIHN0cjt9O2Z1bmN0aW9uIFV0ZjhFbmNvZGUoc3RyaW5nKSB7c3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL3JuL2csXCJuXCIpO3ZhciB1dGZ0ZXh0ID0gXCJcIjtmb3IgKHZhciBuID0gMDsgbiA8IHN0cmluZy5sZW5ndGg7IG4rKykge3ZhciBjID0gc3RyaW5nLmNoYXJDb2RlQXQobik7aWYgKGMgPCAxMjgpIHt1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7fWVsc2UgaWYoKGMgPiAxMjcpICYmIChjIDwgMjA0OCkpIHt1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgPj4gNikgfCAxOTIpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7fWVsc2Uge3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiAxMikgfCAyMjQpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgPj4gNikgJiA2MykgfCAxMjgpO3V0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7fX1yZXR1cm4gdXRmdGV4dDt9O3ZhciBibG9ja3N0YXJ0O3ZhciBpLCBqO3ZhciBXID0gbmV3IEFycmF5KDgwKTt2YXIgSDAgPSAweDY3NDUyMzAxO3ZhciBIMSA9IDB4RUZDREFCODk7dmFyIEgyID0gMHg5OEJBRENGRTt2YXIgSDMgPSAweDEwMzI1NDc2O3ZhciBINCA9IDB4QzNEMkUxRjA7dmFyIEEsIEIsIEMsIEQsIEU7dmFyIHRlbXA7bXNnID0gVXRmOEVuY29kZShtc2cpO3ZhciBtc2dfbGVuID0gbXNnLmxlbmd0aDt2YXIgd29yZF9hcnJheSA9IG5ldyBBcnJheSgpO2ZvciggaT0wOyBpPG1zZ19sZW4tMzsgaSs9NCApIHtqID0gbXNnLmNoYXJDb2RlQXQoaSk8PDI0IHwgbXNnLmNoYXJDb2RlQXQoaSsxKTw8MTYgfG1zZy5jaGFyQ29kZUF0KGkrMik8PDggfCBtc2cuY2hhckNvZGVBdChpKzMpO3dvcmRfYXJyYXkucHVzaCggaiApO31zd2l0Y2goIG1zZ19sZW4gJSA0ICkge2Nhc2UgMDppID0gMHgwODAwMDAwMDA7YnJlYWs7Y2FzZSAxOmkgPSBtc2cuY2hhckNvZGVBdChtc2dfbGVuLTEpPDwyNCB8IDB4MDgwMDAwMDticmVhaztjYXNlIDI6aSA9IG1zZy5jaGFyQ29kZUF0KG1zZ19sZW4tMik8PDI0IHwgbXNnLmNoYXJDb2RlQXQobXNnX2xlbi0xKTw8MTYgfCAweDA4MDAwO2JyZWFrO2Nhc2UgMzppID0gbXNnLmNoYXJDb2RlQXQobXNnX2xlbi0zKTw8MjQgfCBtc2cuY2hhckNvZGVBdChtc2dfbGVuLTIpPDwxNiB8IG1zZy5jaGFyQ29kZUF0KG1zZ19sZW4tMSk8PDggfCAweDgwO2JyZWFrO313b3JkX2FycmF5LnB1c2goIGkgKTt3aGlsZSggKHdvcmRfYXJyYXkubGVuZ3RoICUgMTYpICE9IDE0ICkgd29yZF9hcnJheS5wdXNoKCAwICk7d29yZF9hcnJheS5wdXNoKCBtc2dfbGVuPj4+MjkgKTt3b3JkX2FycmF5LnB1c2goIChtc2dfbGVuPDwzKSYweDBmZmZmZmZmZiApO2ZvciAoIGJsb2Nrc3RhcnQ9MDsgYmxvY2tzdGFydDx3b3JkX2FycmF5Lmxlbmd0aDsgYmxvY2tzdGFydCs9MTYgKSB7Zm9yKCBpPTA7IGk8MTY7IGkrKyApIFdbaV0gPSB3b3JkX2FycmF5W2Jsb2Nrc3RhcnQraV07Zm9yKCBpPTE2OyBpPD03OTsgaSsrICkgV1tpXSA9IHJvdGF0ZV9sZWZ0KFdbaS0zXSBeIFdbaS04XSBeIFdbaS0xNF0gXiBXW2ktMTZdLCAxKTtBID0gSDA7QiA9IEgxO0MgPSBIMjtEID0gSDM7RSA9IEg0O2ZvciggaT0gMDsgaTw9MTk7IGkrKyApIHt0ZW1wID0gKHJvdGF0ZV9sZWZ0KEEsNSkgKyAoKEImQykgfCAofkImRCkpICsgRSArIFdbaV0gKyAweDVBODI3OTk5KSAmIDB4MGZmZmZmZmZmO0UgPSBEO0QgPSBDO0MgPSByb3RhdGVfbGVmdChCLDMwKTtCID0gQTtBID0gdGVtcDt9Zm9yKCBpPTIwOyBpPD0zOTsgaSsrICkge3RlbXAgPSAocm90YXRlX2xlZnQoQSw1KSArIChCIF4gQyBeIEQpICsgRSArIFdbaV0gKyAweDZFRDlFQkExKSAmIDB4MGZmZmZmZmZmO0UgPSBEO0QgPSBDO0MgPSByb3RhdGVfbGVmdChCLDMwKTtCID0gQTtBID0gdGVtcDt9Zm9yKCBpPTQwOyBpPD01OTsgaSsrICkge3RlbXAgPSAocm90YXRlX2xlZnQoQSw1KSArICgoQiZDKSB8IChCJkQpIHwgKEMmRCkpICsgRSArIFdbaV0gKyAweDhGMUJCQ0RDKSAmIDB4MGZmZmZmZmZmO0UgPSBEO0QgPSBDO0MgPSByb3RhdGVfbGVmdChCLDMwKTtCID0gQTtBID0gdGVtcDt9Zm9yKCBpPTYwOyBpPD03OTsgaSsrICkge3RlbXAgPSAocm90YXRlX2xlZnQoQSw1KSArIChCIF4gQyBeIEQpICsgRSArIFdbaV0gKyAweENBNjJDMUQ2KSAmIDB4MGZmZmZmZmZmO0UgPSBEO0QgPSBDO0MgPSByb3RhdGVfbGVmdChCLDMwKTtCID0gQTtBID0gdGVtcDt9SDAgPSAoSDAgKyBBKSAmIDB4MGZmZmZmZmZmO0gxID0gKEgxICsgQikgJiAweDBmZmZmZmZmZjtIMiA9IChIMiArIEMpICYgMHgwZmZmZmZmZmY7SDMgPSAoSDMgKyBEKSAmIDB4MGZmZmZmZmZmO0g0ID0gKEg0ICsgRSkgJiAweDBmZmZmZmZmZjt9dmFyIHRlbXAgPSBjdnRfaGV4KEgwKSArIGN2dF9oZXgoSDEpICsgY3Z0X2hleChIMikgKyBjdnRfaGV4KEgzKSArIGN2dF9oZXgoSDQpO3JldHVybiB0ZW1wLnRvTG93ZXJDYXNlKCk7fVxyXG5cclxuXHJcbi8vIEdyYWIgdGhlIGZpbGVzIGFuZCBzZXQgdGhlbSB0byBvdXIgdmFyaWFibGVcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyA8aW5wdXQgaWQ9XCJmaWxldXBsb2FkXCIgdHlwZT1cImZpbGVcIiBjbGFzcz1cIlwiIG5hbWU9XCJmaWxlc1tdXCIgZGF0YS11cmw9XCJ1cGxvYWQuZG9cIiBtdWx0aXBsZT5cclxuZnVuY3Rpb24gcHJlcGFyZVVwbG9hZChldmVudCkge1xyXG4gICAgdmFyIGVsZSA9ICQodGhpcykuc2libGluZ3MoJy5oaWRkZW4nKVswXTtcclxuICAgIHVwbG9hZEZpbGVzKGV2ZW50LnRhcmdldC5maWxlcywgZWxlKTtcclxuXHJcbiAgICAvLyBlbGUudmFsdWUgPSByZXNGaWxlSWQ7XHJcbiAgICAvL1xyXG4gICAgLy8gdHJ5IHtcclxuICAgIC8vICAgICB2YXIgcmVzRmlsZUlkID0gdXBsb2FkRmlsZXMoZXZlbnQudGFyZ2V0LmZpbGVzKTtcclxuICAgIC8vICAgICB2YXIgZWxlID0gJCh0aGlzKS5zaWJsaW5ncygnLmhpZGRlbicpWzBdLnZhbHVlO1xyXG4gICAgLy8gICAgIHZhciBhcnJheSA9IGVsZSA9PSBcIlwiPyBbXSA6IGVsZS5zcGxpdCgnLCcpIDtcclxuICAgIC8vIH0gY2F0Y2ggKGUpIHtcclxuICAgIC8vICAgICBjb25zb2xlLmxvZyhlKTtcclxuICAgIC8vIH0gZmluYWxseSB7XHJcbiAgICAvLyAgICAgY29uc29sZS5sb2coYXJyYXkpO1xyXG4gICAgLy8gICAgIGFycmF5LnB1c2gocmVzRmlsZUlkKTtcclxuICAgIC8vICAgICBjb25zb2xlLmxvZyhhcnJheSk7XHJcbiAgICAvLyAgICAgZWxlLnZhbHVlID0gYXJyYXkuam9pbignLCcpKS50cmlnZ2VyKCdpbnB1dCc7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy8gZWxlLnZhbChlbGUudmFsKCkuc3BsaXQoJywnKS5wdXNoKHJlc0lkKS5qb2luKCcsJykpLnRyaWdnZXIoJ2lucHV0Jyk7XHJcblxyXG4gICAgLy8gJCh0aGlzKS5zaWJsaW5ncygnLmhpZGRlbicpLnZhbCh1cGxvYWRGaWxlcyhldmVudC50YXJnZXQuZmlsZXMpKS50cmlnZ2VyKCdpbnB1dCcpO1xyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSBmaWxlcyDpnIDopoHkuIrkvKDnmoTmlofku7ZcclxuICogQHBhcmFtIGVsZSDkuIrkvKDmiJDlip/lkI7mjqXmlLbov5Tlm57mlofku7ZJROeahOWFg+e0oFxyXG4gKiBAZGVzYyDmlofku7bkuIrkvKDmqKHlnZcsIOiuvue9rui/lOWbnmlk5ZCO77yM5L2/55SodHJpZ2dlcignaW5wdXQnKeS9v25nLW1vZGVs6IO95pS25Yiw5YC8XHJcbiAqL1xyXG5mdW5jdGlvbiB1cGxvYWRGaWxlcyhmaWxlcywgZWxlKSB7XHJcbiAgICAvLyBDcmVhdGUgYSBmb3JtZGF0YSBvYmplY3QgYW5kIGFkZCB0aGUgZmlsZXNcclxuICAgIHZhciBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAkLmVhY2goZmlsZXMsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcclxuICAgICAgICBkYXRhLmFwcGVuZChcImZpbGVzXCIsIHZhbHVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGZpbGVzKVxyXG5cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAndXBsb2FkLmRvJyxcclxuICAgICAgICB0eXBlOiAnUE9TVCcsXHJcbiAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICBjYWNoZTogZmFsc2UsXHJcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsIC8vIERvbid0IHByb2Nlc3MgdGhlIGZpbGVzXHJcbiAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLCAvLyBTZXQgY29udGVudCB0eXBlIHRvIGZhbHNlIGFzIGpRdWVyeSB3aWxsIHRlbGwgdGhlIHNlcnZlciBpdHMgYSBxdWVyeSBzdHJpbmcgcmVxdWVzdFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YS5lcnJvciA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgIC8vIFN1Y2Nlc3Mgc28gY2FsbCBmdW5jdGlvbiB0byBwcm9jZXNzIHRoZSBmb3JtXHJcbiAgICAgICAgICAgICAgICBmaWxlaWQgPSBkYXRhLmNvbnRlbnQubmFtZTtcclxuICAgICAgICAgICAgICAgIGVsZS52YWx1ZSA9IGRhdGEuY29udGVudC5uYW1lO1xyXG4gICAgICAgICAgICAgICAgJChlbGUpLnRyaWdnZXIoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgICAgICAvLyBzdWJtaXRGb3JtKGV2ZW50LCBkYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBlcnJvcnMgaGVyZVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0VSUk9SUzogJyArIGRhdGEuZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcbiAgICAgICAgICAgIC8vIEhhbmRsZSBlcnJvcnMgaGVyZVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRVJST1JTOiAnICsgdGV4dFN0YXR1cyk7XHJcbiAgICAgICAgICAgIC8vIFNUT1AgTE9BRElORyBTUElOTkVSXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuIiwiLy8gYW5ndWxhci5tb2R1bGUoJ2N0cmxzJylcclxuLy8gICAgIC5jb250cm9sbGVyKCdBbGVydHNDdHJsJywgQWxlcnRzQ3RybCk7XHJcblxyXG4vLyBmdW5jdGlvbiBBbGVydHNDdHJsKCRzY29wZSkge1xyXG4vLyAgICAgJHNjb3BlLmFsZXJ0cyA9IFt7XHJcbi8vICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxyXG4vLyAgICAgICAgIG1zZzogJ1RoYW5rcyBmb3IgdmlzaXRpbmchIEZlZWwgZnJlZSB0byBjcmVhdGUgcHVsbCByZXF1ZXN0cyB0byBpbXByb3ZlIHRoZSBkYXNoYm9hcmQhJ1xyXG4vLyAgICAgfSwge1xyXG4vLyAgICAgICAgICAgICB0eXBlOiAnZGFuZ2VyJyxcclxuLy8gICAgICAgICAgICAgbXNnOiAnRm91bmQgYSBidWc/IENyZWF0ZSBhbiBpc3N1ZSB3aXRoIGFzIG1hbnkgZGV0YWlscyBhcyB5b3UgY2FuLidcclxuLy8gICAgICAgICB9XTtcclxuXHJcbi8vICAgICAkc2NvcGUuYWRkQWxlcnQgPSBmdW5jdGlvbigpIHtcclxuLy8gICAgICAgICAkc2NvcGUuYWxlcnRzLnB1c2goe1xyXG4vLyAgICAgICAgICAgICBtc2c6ICdBbm90aGVyIGFsZXJ0ISdcclxuLy8gICAgICAgICB9KTtcclxuLy8gICAgIH07XHJcblxyXG4vLyAgICAgJHNjb3BlLmNsb3NlQWxlcnQgPSBmdW5jdGlvbihpbmRleCkge1xyXG4vLyAgICAgICAgICRzY29wZS5hbGVydHMuc3BsaWNlKGluZGV4LCAxKTtcclxuLy8gICAgIH07XHJcbi8vIH1cclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdjdHJscycpXHJcbiAgICAgICAgLy8gYW5ndWxhci11aSBNb2RhbFxyXG4gICAgICAgIC5jb250cm9sbGVyKCdNb2RhbERlbW9DdHJsJywgTW9kYWxEZW1vQ3RybCk7XHJcblxyXG4gICAgZnVuY3Rpb24gTW9kYWxEZW1vQ3RybCgkc2NvcGUsICR1aWJNb2RhbCwgJGxvZykge1xyXG4gICAgICAgICRzY29wZS5pdGVtcyA9IFsnaXRlbTEnLCAnaXRlbTInLCAnaXRlbTMnXTtcclxuICAgICAgICAkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICRzY29wZS5vcGVuID0gZnVuY3Rpb24oc2l6ZSkge1xyXG4gICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdteU1vZGFsQ29udGVudC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNb2RhbEluc3RhbmNlQ3RybCcsXHJcbiAgICAgICAgICAgICAgICBzaXplOiBzaXplLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5pdGVtcztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZCA9IHNlbGVjdGVkSXRlbTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmluZm8oJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS50b2dnbGVBbmltYXRpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkID0gISRzY29wZS5hbmltYXRpb25zRW5hYmxlZDtcclxuICAgICAgICB9O1xyXG5cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdjdHJscycpXHJcblxyXG4gICAgICAgIC8vIFBsZWFzZSBub3RlIHRoYXQgJHVpYk1vZGFsSW5zdGFuY2UgcmVwcmVzZW50cyBhIG1vZGFsIHdpbmRvdyAoaW5zdGFuY2UpIGRlcGVuZGVuY3kuXHJcbiAgICAgICAgLy8gSXQgaXMgbm90IHRoZSBzYW1lIGFzIHRoZSAkdWliTW9kYWwgc2VydmljZSB1c2VkIGFib3ZlLlxyXG4gICAgICAgIC8vIGFuZ3VsYXItdWkgTW9kYWxcclxuICAgICAgICAuY29udHJvbGxlcignTW9kYWxJbnN0YW5jZUN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBpdGVtcykge1xyXG4gICAgICAgICAgICAkc2NvcGUuaXRlbXMgPSBpdGVtcztcclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkID0ge1xyXG4gICAgICAgICAgICAgICAgaXRlbTogJHNjb3BlLml0ZW1zWzBdXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUub2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5zZWxlY3RlZC5pdGVtKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pXHJcblxyXG59KSgpOyIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2N0cmxzJylcclxuXHJcbiAgICAgICAgLy8gYW5ndWxhci11aSBwcm9ncmVzc0JhclxyXG4gICAgICAgIC5jb250cm9sbGVyKCdQcm9ncmVzc0RlbW9DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tYXggPSAyMDA7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucmFuZG9tID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAgKyAxKTtcclxuICAgICAgICAgICAgICAgIHZhciB0eXBlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICd3YXJuaW5nJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPCA1MCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSAnaW5mbyc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgNzUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gJ3N1Y2Nlc3MnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gJ3N1Y2Nlc3MnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93V2FybmluZyA9IHR5cGUgPT09ICdkYW5nZXInIHx8IHR5cGUgPT09ICd3YXJuaW5nJztcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZHluYW1pYyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnR5cGUgPSB0eXBlO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnJhbmRvbSgpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnJhbmRvbVN0YWNrZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zdGFja2VkID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgdHlwZXMgPSBbJ3N1Y2Nlc3MnLCAnaW5mbycsICd3YXJuaW5nJywgJ2RhbmdlciddO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNCArIDEpOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN0YWNrZWQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzMCArIDEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlc1tpbmRleF1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5yYW5kb21TdGFja2VkKCk7XHJcbiAgICAgICAgfSlcclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2N0cmxzJylcclxuICAgICAgICAvLyBkYXNoYm9hcmQgU2lkZWJhclxyXG4gICAgICAgIC5jb250cm9sbGVyKFwiTWFzdGVyQ3RybFwiLCBbXCIkc2NvcGVcIiwgXCIkY29va2llc1wiLCBmdW5jdGlvbigkc2NvcGUsICRjb29raWVzKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBTaWRlYmFyIFRvZ2dsZSAmIENvb2tpZXMgQ29udHJvbFxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgdmFyIG1vYmlsZVZpZXcgPSA5OTI7XHJcbiAgICAgICAgICAgICRzY29wZS5nZXRXaWR0aCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCRzY29wZS5nZXRXaWR0aCwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgPj0gbW9iaWxlVmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCgkY29va2llcy5nZXQoJ3RvZ2dsZScpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG9nZ2xlID0gISRjb29raWVzLmdldCgndG9nZ2xlJykgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlU2lkZWJhciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZSA9ICEkc2NvcGUudG9nZ2xlO1xyXG4gICAgICAgICAgICAgICAgJGNvb2tpZXMucHV0KCd0b2dnbGUnLCAkc2NvcGUudG9nZ2xlKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgd2luZG93Lm9ucmVzaXplID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfV0pXHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbn0pKCk7IiwiLyoqXHJcbiAqIEBhdXRob3IgU2hhd25cclxuICogQGRlc2MgQ29udHJvbGxlcnMgb2YgdGhlIG1haW5BUFBcclxuICovXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnY3RybHMnLCBbXSlcclxuXHJcbiAgICAgICAgLy8gUGFyZW50L01haW4gQ29udHJvbGxlclxyXG4gICAgICAgIC5jb250cm9sbGVyKCdtYWluQ3RybCcsIFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgJ0FVVEhfRVZFTlRTJywgJ0NvbW1vblNlcnZpY2UnLCAnU2Vzc2lvbicsICdnb2xkU2VydmljZScsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSwgQVVUSF9FVkVOVFMsIENvbW1vblNlcnZpY2UsIFNlc3Npb24sIGdvbGRTZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gZm9yIHRlc3RcclxuICAgICAgICAgICAgICAgICRzY29wZS50b2dnbGVNTyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJhbFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMpXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLm1vLWxpc3QnKS5hbmltYXRlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICd0b2dnbGUnXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzUwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS5vcmRlckl0ZW1zID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDMwOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUub3JkZXJJdGVtc1tpXSA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5zZXRDdXJyZW50VXNlciA9IGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTG9nIG91dFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFNlc3Npb24uZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ291dCgpLnRoZW4oZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChDb21tb25TZXJ2aWNlLmlzUmVxU3VjY2VzcyhyZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoQVVUSF9FVkVOVFMubG9nb3V0U3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn55m75Ye65oiQ5YqfJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb21tb25TZXJ2aWNlLmhhbmRsZVJlc0VycihyZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIENvbW1vblNlcnZpY2UuaGFuZGxlSHR0cEVycihyZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIExpc3RlbmluZ1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbihBVVRIX0VWRU5UUy5sb2dpblN1Y2Nlc3MsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2dpbiBzdWNjZXNzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKEFVVEhfRVZFTlRTLnBhZ2VOb3RGb3VuZCwgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnNDA0IGVycm9yJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKEFVVEhfRVZFTlRTLnNlcnZlckVycm9yLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCc1MDAgZXJyb3InKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF0pXHJcblxyXG5cclxuICAgICAgICAvLyBSZWdpc3RlciBDb250cm9sbGVyXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3JlZ2lzdGVyQ3RybCcsIFsnJHNjb3BlJywgJyRsb2NhdGlvbicsICdyZWdpc3RlclNlcnZpY2UnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgcmVnaXN0ZXJTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIC8vIElmIHN1Y2Nlc3MganVtcCB0byBMb2dpbiBwYWdlXHJcbiAgICAgICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgICAgIHJlZ2lzdGVyU2VydmljZS5yZWdpc3Rlcih1c2VyKS50aGVuKGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChDb21tb25TZXJ2aWNlLmlzUmVxU3VjY2VzcyhyZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdyZWdpc3RlcuaIkOWKnycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9sb2dpblwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBDb21tb25TZXJ2aWNlLmhhbmRsZVJlc0VycihyZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdyZWdpc3RlcuWksei0pScpO1xyXG4gICAgICAgICAgICAgICAgICAgIENvbW1vblNlcnZpY2UuaGFuZGxlSHR0cEVycihyZXMpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1dKVxyXG5cclxuXHJcbiAgICAgICAgLy8gVXNlciBDb250cm9sbGVyXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3VzZXJDdHJsJywgWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnU2Vzc2lvbicsICdBVVRIX0VWRU5UUycsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBTZXNzaW9uLCBBVVRIX0VWRU5UUywgQXV0aFNlcnZpY2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLiRvbihBVVRIX0VWRU5UUy5sb2dvdXRTdWNjZXNzLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICghQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidXNlciBuZWVkIGxvZ2luXCIpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfV0pXHJcblxyXG5cclxuXHJcbiAgICAgICAgLy8gRm9yIHRlc3RcclxuICAgICAgICAuY29udHJvbGxlcigndGVzdEN0cmwnLCBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckaHR0cCcsICdBVVRIX0VWRU5UUycsICdBdXRoU2VydmljZScsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkaHR0cCwgQVVUSF9FVkVOVFMsIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub2JqID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJ1c2VyL2xvZ2luLmRvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBcIlwiXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRlc3QgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWEgPSAoSlNPTi5wYXJzZShvYmouZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdDogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtc2c6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBvYmoudXJsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IG9iai5tZXRob2QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHNlcmlhbGl6ZURhdGEoYWEpXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc3VsdC5yZXN1bHQgPSBcIlJlcSBTdWNjZXNzXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSByZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSByZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQucmVzdWx0ID0gXCJSZXEgRmFpbFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXSlcclxuXHJcbn0pKCk7IiwiLyoqXHJcbiAqIEBhdXRob3IgU2hhd25cclxuICogQGRlc2MgU2VydmljZXMgb2YgdGhlIG1haW5BUFBcclxuICovXHJcblxyXG4vLyBGb3IgdGVzdFxyXG52YXIgY29tbW9uVGVzdCA9IGZhbHNlO1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdzZXJ2aWNlcycsIFtdKVxyXG5cclxuICAgICAgICAvLyBCcm9hZGNhc3QgdGhlIHJlc3VsdCBvZiBVc2VyIHN0YXR1c1xyXG4gICAgICAgIC5mYWN0b3J5KCdBdXRoSW50ZXJjZXB0b3InLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkcSwgQVVUSF9FVkVOVFMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDQwMTogQVVUSF9FVkVOVFMubm90QXV0aGVudGljYXRlZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgNDAzOiBBVVRIX0VWRU5UUy5ub3RBdXRob3JpemVkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA0MTk6IEFVVEhfRVZFTlRTLnNlc3Npb25UaW1lb3V0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA0NDA6IEFVVEhfRVZFTlRTLnNlc3Npb25UaW1lb3V0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA0MDQ6IEFVVEhfRVZFTlRTLnBhZ2VOb3RGb3VuZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgNTAwOiBBVVRIX0VWRU5UUy5zZXJ2ZXJFcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIH1bcmVzcG9uc2Uuc3RhdHVzXSwgcmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vIFNlc3Npb24gbWFuaXB1bGF0ZVxyXG4gICAgICAgIC5mYWN0b3J5KCdTZXNzaW9uJywgZnVuY3Rpb24oJGNvb2tpZXMpIHtcclxuICAgICAgICAgICAgdmFyIGFOYW1lID0gXCJVU0VSSURcIjtcclxuICAgICAgICAgICAgdmFyIGJOYW1lID0gXCJTSURcIjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlID0gZnVuY3Rpb24oc2Vzc2lvbklkLCB1c2VySWQpIHtcclxuICAgICAgICAgICAgICAgICRjb29raWVzLnB1dChhTmFtZSwgdXNlcklkKTtcclxuICAgICAgICAgICAgICAgICRjb29raWVzLnB1dChiTmFtZSwgc2Vzc2lvbklkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKHNlc3Npb25JZCwgdXNlcklkKSB7XHJcbiAgICAgICAgICAgIC8vICAgICBkb2N1bWVudC5jb29raWUgPSBhTmFtZSArICc9JyArIHVzZXJJZDtcclxuICAgICAgICAgICAgLy8gICAgIGRvY3VtZW50LmNvb2tpZSA9IGJOYW1lICsgJz0nICsgc2Vzc2lvbklkO1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5pZCA9IHNlc3Npb25JZDtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMudXNlcklkID0gdXNlcklkO1xyXG4gICAgICAgICAgICAvLyB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5nZXQgPSBmdW5jdGlvbihuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGNvb2tpZXMuZ2V0T2JqZWN0KG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgKGRvY3VtZW50LmNvb2tpZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdmFyIHN0YXJ0ID0gZG9jdW1lbnQuY29va2llLmluZGV4T2YobmFtZSArIFwiPVwiKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICBpZiAoc3RhcnQgIT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgc3RhcnQgPSBzdGFydCArIG5hbWUubGVuZ3RoICsgMTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgdmFyIGVuZCA9IGRvY3VtZW50LmNvb2tpZS5pbmRleE9mKFwiO1wiLCBzdGFydCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIGlmIChlbmQgPT0gLTEpIGVuZCA9IGRvY3VtZW50LmNvb2tpZS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiB1bmVzY2FwZShkb2N1bWVudC5jb29raWUuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gXCJcIjtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRVc2VyTmFtZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KGFOYW1lKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRTZXNzaW9uSWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChiTmFtZSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0T2JqID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICdhY2NvdW50bmFtZSc6IHRoaXMuZ2V0KGFOYW1lKSxcclxuICAgICAgICAgICAgICAgICAgICAnc2Vzc2lvbmlkJzogdGhpcy5nZXQoYk5hbWUpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0gYU5hbWUgKyAnPSc7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBiTmFtZSArICc9JztcclxuICAgICAgICAgICAgICAgIHRoaXMuaWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51c2VySWQgPSBudWxsO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAvLyBHbG9iYWwgU2VydmljZXNcclxuICAgICAgICAuZmFjdG9yeSgnQ29tbW9uU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCBTZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIC8vIFNldCBDb250ZW50LVR5cGUgdG8gZm9ybS1kYXRhIHdoaWNoIGJhY2stZW5kIGNhbiBhY2NlcHRcclxuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5wb3N0WydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD11dGYtOCc7XHJcblxyXG4gICAgICAgICAgICB2YXIgdXJsQmFja0VuZCA9ICdodHRwOi8vbG9jYWxob3N0OjgwODAvdGVzdC1kYXRhLyc7XHJcbiAgICAgICAgICAgIHZhciB1cmxNaWRkbGVFbmQgPSAnaHR0cHM6Ly9FeGFtcGxlVVJMLjkyLyc7XHJcblxyXG4gICAgICAgICAgICAvLyByZXF1ZXN0cyBzdGF0dXMgaGFuZGxlXHJcbiAgICAgICAgICAgIHRoaXMuaXNSZXFTdWNjZXNzID0gZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5kYXRhLmVyckNvZGUgPT0gMCA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vIGhhbmRsZSBIdHRwIGVycm9yXHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlSHR0cEVyciA9IGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlcSBFcnJvcicsIHJlcyk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvLyBoYW5kbGUgcmVzcG9uc2UgZXJyb3IgKGJhc2Ugb24gQVBJKVxyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVJlc0VyciA9IGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5lcnJEZXNjID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciB3aXRob3V0IGRpc2NyaXB0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ21zZzogJyArIHJlcy5lcnJEZXNjKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQocmVzLmRhdGEuZXJyRGVzYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy8gcG9zdCBzaW5nbGUgY29tbWFuZCB0byBiYWNrLWVuZCBzZXJ2ZXJcclxuICAgICAgICAgICAgdGhpcy5wb3N0ID0gZnVuY3Rpb24oY29tbWFuZCwgcmVxKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZXF1ZXN0IHBhcmFtZXRlcnMgc3RydWN0dXJlXHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9ICQuZXh0ZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBcImNvbW1hbmRcIjogY29tbWFuZFxyXG4gICAgICAgICAgICAgICAgfSwgU2Vzc2lvbi5nZXRPYmooKSwgcmVxKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhhbmd1bGFyLnRvSnNvbihkYXRhKSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tbW9uVGVzdCA/ICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICd0ZXN0LWRhdGEvJyArIGNvbW1hbmQsXHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJ1xyXG4gICAgICAgICAgICAgICAgfSkgOiAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmxCYWNrRW5kICsgY29tbWFuZCxcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBcIkpzb25TdHI9XCIgKyBhbmd1bGFyLnRvSnNvbihkYXRhKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vIHBvc3Qgc2luZ2xlIGNvbW1hbmQgdG8gYmFjay1lbmQgc2VydmVyXHJcbiAgICAgICAgICAgIC8vIG5hbWVzcGFjZTogdXNlci9nb2xkdXNlcnJlY2hhcmdlLmFjdGlvblxyXG4gICAgICAgICAgICB0aGlzLnBvc3RNaWRkbGVFbmQgPSBmdW5jdGlvbihuYW1lc3BhY2UsIGNvbW1hbmQsIHJlcSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkLmV4dGVuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJjb21tYW5kXCI6IGNvbW1hbmRcclxuICAgICAgICAgICAgICAgIH0sIHJlcSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybE1pZGRsZUVuZCArIG5hbWVzcGFjZSxcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBcIkpzb25TdHI9XCIgKyBhbmd1bGFyLnRvSnNvbihkYXRhKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gcG9zdCBtdWx0aSBjb21tYW5kcyB0byBzZXJ2ZXJcclxuICAgICAgICAgICAgdGhpcy5wb3N0TXVsdGkgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAvLyBBdXRoXHJcbiAgICAgICAgLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsICRyb290U2NvcGUsIEFVVEhfRVZFTlRTLCBTZXNzaW9uLCBDb21tb25TZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luID0gZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vblNlcnZpY2UucG9zdChcImxvZ2luXCIsIHVzZXIpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgYXV0aFNlcnZpY2UubG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uU2VydmljZS5wb3N0KFwibG9nb3V0XCIpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy8gaXMgc2Vzc2lvbiBhdmFsaWRcclxuICAgICAgICAgICAgYXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaXNBdXRoZW50aWNhdGVkOiAnICsgISFTZXNzaW9uLmdldCgnVVNFUklEJykpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICEhU2Vzc2lvbi5nZXQoJ1VTRVJJRCcpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vIHJlZ2lzdGVyXHJcbiAgICAgICAgLmZhY3RvcnkoJ3JlZ2lzdGVyU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCAkcm9vdFNjb3BlLCBDb21tb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLnJlZ2lzdGVyID0gZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vblNlcnZpY2UucG9zdChcInVzZXIvcmVnaXN0ZXIuZG9cIiwgdXNlcik7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAvLyBVc2VyXHJcbiAgICAgICAgLmZhY3RvcnkoJ3VzZXJTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsICRyb290U2NvcGUsIFNlc3Npb24sIENvbW1vblNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vIEV4YW1wbGVcclxuICAgICAgICAuZmFjdG9yeSgnZ29sZFNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgJHJvb3RTY29wZSwgU2Vzc2lvbiwgQ29tbW9uU2VydmljZSkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgICAgICAgIC8vIDFcclxuICAgICAgICAgICAgc2VydmljZS5xdWVyeWdvbGRwcmljZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vblNlcnZpY2UucG9zdChcImdvbGQvcXVlcnlnb2xkcHJpY2VcIik7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIDNcclxuICAgICAgICAgICAgc2VydmljZS5xdWVyeXByb2plY3RkZXRhaWwgPSBmdW5jdGlvbihyZXEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25TZXJ2aWNlLnBvc3QoXCJnb2xkL3F1ZXJ5cHJvamVjdGRldGFpbFwiLCByZXEpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vIEV4YW1wbGVcclxuICAgICAgICAuZmFjdG9yeSgnbWlkZGxlRW5kU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCAkcm9vdFNjb3BlLCBTZXNzaW9uLCBDb21tb25TZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2VydmljZSA9IHt9O1xyXG5cclxuICAgICAgICAgICAgLy8gMVxyXG4gICAgICAgICAgICBzZXJ2aWNlLmNoYXJnZSA9IGZ1bmN0aW9uKHJlcSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbW1vblNlcnZpY2UucG9zdE1pZGRsZUVuZCgndXNlci9nb2xkdXNlcnJlY2hhcmdlLmFjdGlvbicsICdwb3N0ZGF0YScsIHJlcSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIDJcclxuICAgICAgICAgICAgc2VydmljZS5xdWVyeXByb2plY3RsaXN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29tbW9uU2VydmljZS5wb3N0KFwiZ29sZC9xdWVyeXByb2plY3RsaXN0XCIpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS5xdWVyeW15Zml4ZWRnb2xkaW50ZXJlc3RkZXRhaWwgPSBmdW5jdGlvbihyZXEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBDb21tb25TZXJ2aWNlLnBvc3QoXCJnb2xkL215YWNjb3VudC9xdWVyeW15Zml4ZWRnb2xkaW50ZXJlc3RkZXRhaWxcIiwgcmVxKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgICAgIH0pXHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgZnVuY3Rpb24gcmRMb2FkaW5nKCkge1xyXG4gICAgICAgIHZhciBkID0ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBRVwiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJsb2FkaW5nXCI+PGRpdiBjbGFzcz1cImRvdWJsZS1ib3VuY2UxXCI+PC9kaXY+PGRpdiBjbGFzcz1cImRvdWJsZS1ib3VuY2UyXCI+PC9kaXY+PC9kaXY+J1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZFdpZGdldEJvZHkoKSB7XHJcbiAgICAgICAgdmFyIGQgPSB7XHJcbiAgICAgICAgICAgIHJlcXVpcmVzOiBcIl5yZFdpZGdldFwiLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgbG9hZGluZzogXCJAP1wiLFxyXG4gICAgICAgICAgICAgICAgY2xhc3NlczogXCJAP1wiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6ICEwLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ3aWRnZXQtYm9keVwiIG5nLWNsYXNzPVwiY2xhc3Nlc1wiPjxyZC1sb2FkaW5nIG5nLXNob3c9XCJsb2FkaW5nXCI+PC9yZC1sb2FkaW5nPjxkaXYgbmctaGlkZT1cImxvYWRpbmdcIiBjbGFzcz1cIndpZGdldC1jb250ZW50XCIgbmctdHJhbnNjbHVkZT48L2Rpdj48L2Rpdj4nLFxyXG4gICAgICAgICAgICByZXN0cmljdDogXCJFXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcmRXaWRnZXQoKSB7XHJcbiAgICAgICAgdmFyIGQgPSB7XHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6ICEwLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ3aWRnZXRcIiBuZy10cmFuc2NsdWRlPjwvZGl2PicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVBXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcmRXaWRnZXRUaXRsZSgpIHtcclxuICAgICAgICB2YXIgZSA9IHtcclxuICAgICAgICAgICAgcmVxdWlyZXM6IFwiXnJkV2lkZ2V0XCIsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJAXCIsXHJcbiAgICAgICAgICAgICAgICBpY29uOiBcIkBcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiAhMCxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwid2lkZ2V0LWhlYWRlclwiPjxpIGNsYXNzPVwiZmFcIiBuZy1jbGFzcz1cImljb25cIj48L2k+IHt7dGl0bGV9fSA8ZGl2IGNsYXNzPVwicHVsbC1yaWdodFwiIG5nLXRyYW5zY2x1ZGU+PC9kaXY+PC9kaXY+JyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiRVwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBmdW5jdGlvbiByZFdpZGdldEZvb3RlcigpIHtcclxuICAgICAgICB2YXIgZSA9IHtcclxuICAgICAgICAgICAgcmVxdWlyZXM6IFwiXnJkV2lkZ2V0XCIsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6ICEwLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ3aWRnZXQtZm9vdGVyXCIgbmctdHJhbnNjbHVkZT48L2Rpdj4nLFxyXG4gICAgICAgICAgICByZXN0cmljdDogXCJFXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBlXHJcbiAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2RpcmVjdGl2ZXMnLCBbXSlcclxuXHJcbiAgICAuZGlyZWN0aXZlKFwicmRMb2FkaW5nXCIsIHJkTG9hZGluZylcclxuXHJcbiAgICAuZGlyZWN0aXZlKFwicmRXaWRnZXRCb2R5XCIsIHJkV2lkZ2V0Qm9keSlcclxuXHJcbiAgICAuZGlyZWN0aXZlKFwicmRXaWRnZXRGb290ZXJcIiwgcmRXaWRnZXRGb290ZXIpXHJcblxyXG4gICAgLmRpcmVjdGl2ZShcInJkV2lkZ2V0SGVhZGVyXCIsIHJkV2lkZ2V0VGl0bGUpXHJcblxyXG4gICAgLmRpcmVjdGl2ZShcInJkV2lkZ2V0XCIsIHJkV2lkZ2V0KVxyXG5cclxuXHJcblxyXG59KSgpO1xyXG4iLCIvKipcclxuICogQGF1dGhvciBTaGF3blxyXG4gKiBAZGVzYyBtYWluQVBQXHJcbiAqL1xyXG5jb25zdCBQUk9KRUNUU1RBVFVTID0ge1xyXG4gICAgMDogXCLnp5HmioBcIixcclxuICAgIDE6IFwi6Im65pyvXCIsXHJcbiAgICAyOiBcIuWoseS5kFwiLFxyXG4gICAgMzogXCLlhpzkuJpcIixcclxuICAgIDQ6IFwi5Zyw5LqnXCIsXHJcbiAgICA1OiBcIuWFrOebilwiLFxyXG4gICAgNjogXCLlhbbku5ZcIlxyXG59O1xyXG5cclxuLy8g6aG555uu5a6h5qC454q25oCBXHJcbmNvbnN0IEFVRElUU1RBVFVTID0ge1xyXG4gICAgMDogXCLmnKrmj5DkuqRcIixcclxuICAgIDEwOiBcIuacquWuoeaguFwiLFxyXG4gICAgMjA6IFwi5a6h5qC45pyq6YCa6L+HXCIsXHJcbiAgICAzMDogXCLpooTng63kuK1cIixcclxuICAgIDQwOiBcIuS4rVwiLFxyXG4gICAgNTA6IFwi5Y2z5bCG57uT5p2fXCIsXHJcbiAgICA2MDogXCLlt7LmiJDlip9cIixcclxuICAgIDcwOiBcIuW3suWksei0pVwiXHJcbn07XHJcblxyXG4vLyDpobnnm67miYDlpITpmLbmrrVcclxuY29uc3QgUFJPSkVDVFBIQVNFID0ge1xyXG4gICAgMDogXCLnoJTlj5HkuK1cIixcclxuICAgIDE6IFwi5bey5q2j5byP5Y+R5biDXCIsXHJcbiAgICAyOiBcIuW3suacieaUtuWFpVwiLFxyXG4gICAgMzogXCLlt7Lnm4jliKlcIlxyXG59XHJcbmNvbnN0IEJVSUxEQ09NUEFOWSA9IHtcclxuICAgIDA6IFwi5pyq5oiQ56uLXCIsXHJcbiAgICAxOiBcIuW3suaIkOeri1wiXHJcbn07XHJcbmNvbnN0IENBVEVHT1JZID0ge1xyXG4gICAgMDogXCLnp5HmioBcIixcclxuICAgIDE6IFwi6Im65pyvXCIsXHJcbiAgICAyOiBcIuWoseS5kFwiLFxyXG4gICAgMzogXCLlhpzkuJpcIixcclxuICAgIDQ6IFwi5Zyw5LqnXCIsXHJcbiAgICA1OiBcIuWFrOebilwiLFxyXG4gICAgNjogXCLlhbbku5ZcIlxyXG59O1xyXG5cclxuLyogZmlsdGVycyAqL1xyXG52YXIgZmlsdGVycyA9IGFuZ3VsYXIubW9kdWxlKCdmaWx0ZXJzJywgW10pXHJcblxyXG4vLyDlvIDlhbPov4fmu6TlmajvvIww5YiZ5pi+56S65YWz6Zet77yMMeWImeaYvuekuuW8gOWQr1xyXG4uZmlsdGVyKCdzd2l0Y2gnLCBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbihwYXJhbSkge1xyXG4gICAgICAgIGlmIChwYXJhbSA9PSAxIHx8IHBhcmFtID09ICcxJykge1xyXG4gICAgICAgICAgICByZXR1cm4gJ+W8gOWQryc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICflhbPpl60nO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSlcclxuXHJcbi8vIOeZvuWIhuavlCzpobXpnaLkuIDoiKzmnInpop3lpJbnmb7liIblj7fvvIzkvKDlhaUqMTAw55qE5pWw5YC877yM6L6T5Ye65bCP5pWwXHJcbi5maWx0ZXIoJ3BlcmNlbnQnLCBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbihwYXJhbSkge1xyXG4gICAgICAgIGlmIChwYXJhbSAhPSB1bmRlZmluZWQgJiYgaXNOYU4ocGFyYW0pID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJhbSAqIDEwMDAgLyAxMDAwMDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSlcclxuXHJcbi5maWx0ZXIoJ2NhdGVnb3J5JywgZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgb2JqID0gQ0FURUdPUlk7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24ocGFyYW0pIHtcclxuICAgICAgICByZXR1cm4gb2JqW3BhcmFtXSAhPSB1bmRlZmluZWQgPyBvYmpbcGFyYW1dIDogXCJcIjtcclxuICAgIH1cclxufSlcclxuXHJcbi5maWx0ZXIoJ2J1aWxkY29tcGFueScsIGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIG9iaiA9IEJVSUxEQ09NUEFOWTtcclxuICAgIHJldHVybiBmdW5jdGlvbihwYXJhbSkge1xyXG4gICAgICAgIHJldHVybiBvYmpbcGFyYW1dICE9IHVuZGVmaW5lZCA/IG9ialtwYXJhbV0gOiBcIlwiO1xyXG4gICAgfVxyXG59KVxyXG5cclxuLmZpbHRlcigncHJvamVjdHBoYXNlJywgZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgb2JqID0gUFJPSkVDVFBIQVNFO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKHBhcmFtKSB7XHJcbiAgICAgICAgcmV0dXJuIG9ialtwYXJhbV0gIT0gdW5kZWZpbmVkID8gb2JqW3BhcmFtXSA6IFwiXCI7XHJcbiAgICB9XHJcbn0pXHJcblxyXG4uZmlsdGVyKCdhdWRpdHN0YXR1cycsIGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIG9iaiA9IEFVRElUU1RBVFVTO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKHBhcmFtKSB7XHJcbiAgICAgICAgcmV0dXJuIG9ialtwYXJhbV0gIT0gdW5kZWZpbmVkID8gb2JqW3BhcmFtXSA6IFwiXCI7XHJcbiAgICB9XHJcbn0pXHJcblxyXG4uZmlsdGVyKCdwcm9qZWN0c3RhdHVzJywgZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgb2JqID0gUFJPSkVDVFNUQVRVUztcclxuICAgIHJldHVybiBmdW5jdGlvbihwYXJhbSkge1xyXG4gICAgICAgIHJldHVybiBvYmpbcGFyYW1dICE9IHVuZGVmaW5lZCA/IG9ialtwYXJhbV0gOiBcIlwiO1xyXG4gICAgfVxyXG59KVxyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdkaXJlY3RpdmVzJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdtYXJrZXRPcmRlckxpc3QnLCBtYXJrZXRPcmRlckxpc3QpO1xyXG4gICAgZnVuY3Rpb24gbWFya2V0T3JkZXJMaXN0KCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBpY29uOiBcIkBcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3B1YmxpYy9qcy9jb21wb25lbnRzL21hcmtldC1vcmRlci1saXN0L21hcmtldC1vcmRlci1saXN0Lmh0bWwnLFxyXG4gICAgICAgICAgICByZXN0cmljdDogXCJFXCJcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuXHJcbn0pKCk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKCdjdHJscycpXHJcbiAgICAvLyBhbmd1bGFyLXVpIE1vZGFsXHJcbiAgICAuY29udHJvbGxlcignTG9naW5DdHJsJywgTG9naW5DdHJsKTtcclxuXHJcblxyXG4vLyBMb2dpbiBDb250cm9sbGVyXHJcbmZ1bmN0aW9uIExvZ2luQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJGh0dHAsICRjb29raWVzLCAkc3RhdGUsIEFVVEhfRVZFTlRTLCBDb21tb25TZXJ2aWNlLCBTZXNzaW9uLCBBdXRoU2VydmljZSkge1xyXG5cclxuICAgIC8vIGlmICghISRyb290U2NvcGUuY3VycmVudFVzZXIpIHtcclxuICAgIC8vICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgIC8vIH1cclxuXHJcbiAgICAkc2NvcGUudXNlciA9IHt9O1xyXG4gICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24odXNlcikge1xyXG5cclxuICAgICAgICBBdXRoU2VydmljZS5sb2dpbih1c2VyKS50aGVuKGZ1bmN0aW9uKHJlcykge1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgICAgaWYgKENvbW1vblNlcnZpY2UuaXNSZXFTdWNjZXNzKHJlcykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2dpbiBzdWNjZXNzJyk7XHJcbiAgICAgICAgICAgICAgICAvLyAkY29va2llcy5wdXQocmVzLmRhdGEuc2Vzc2lvbmlkLCB1c2VyLmFjY291bnRuYW1lKTtcclxuICAgICAgICAgICAgICAgIFNlc3Npb24uY3JlYXRlKHJlcy5kYXRhLnNlc3Npb25pZCwgdXNlci5hY2NvdW50bmFtZSk7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoQVVUSF9FVkVOVFMubG9naW5TdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZS5vcmRlcicpO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5zZXRDdXJyZW50VXNlcih1c2VyLmFjY291bnRuYW1lKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIENvbW1vblNlcnZpY2UuaGFuZGxlUmVzRXJyKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoQVVUSF9FVkVOVFMubG9naW5GYWlsZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgIENvbW1vblNlcnZpY2UuaGFuZGxlSHR0cEVycihyZXMpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoQVVUSF9FVkVOVFMubG9naW5GYWlsZWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHVzZXIpO1xyXG4gICAgfVxyXG59XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2RpcmVjdGl2ZXMnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2xvZ2luJywgbG9naW4pO1xyXG5cclxuICAgIGZ1bmN0aW9uIGxvZ2luKCRjb21waWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6ICdAJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwdWJsaWMvanMvY29tcG9uZW50cy9sb2dpbi1wYW5lbC9sb2dpbi1wYW5lbC5odG1sJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHNjb3BlLm5hbWUgPSBcImhlbFwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnZGlyZWN0aXZlcycpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnbWFya2V0T3JkZXJMaXN0JywgbWFya2V0T3JkZXJMaXN0KTtcclxuICAgIGZ1bmN0aW9uIG1hcmtldE9yZGVyTGlzdCgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgaWNvbjogXCJAXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwdWJsaWMvanMvY29tcG9uZW50cy9tYXJrZXQtb3JkZXItbGlzdC9tYXJrZXQtb3JkZXItbGlzdC5odG1sJyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiRVwiXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcblxyXG59KSgpO1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
